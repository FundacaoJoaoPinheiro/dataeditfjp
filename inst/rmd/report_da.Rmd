---
title: "FJP Dados"
subtitle: "Demografia"
author:
  - name: "Coordenação de Indicadores Sociais (CIS)"
    affiliation: "Diretoria de Estatística e Informações (Direi)"
    address: "Alameda das Acácias, 70 - São Luiz"
    city: "Belo Horizonte"
    state: "Minas Gerais"
    postal_code: "31.275-150"
    url: "https://fjp.mg.gov.br/"
lang: pt
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
description: "Relatório contendo uma análise descritiva e os resultados das regras de crítica dos dados da dimensão."
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: false
    df_print: kable
    fig_caption: true
    table_caption: true
    embed-resources: true
    smooth-scroll: true
    toc-location: left
    toc-title: MENU
    theme: journal
editor: visual
execute:
  echo: false
  warning: false
  error: false
  message: false
params:
  data: file.xlsx
output-file: "relatorio_da.html"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r set_param_global}
k <- 1.5 
```

```{r import_data}
data <- openxlsx::read.xlsx(params$data)
data$ANO <- as.character(data$ANO)
```


```{r get_var_numeric}

# Obter as siglas das variáveis do tipo numérico
var_numeric <- data |> 
  dplyr::select(
    !c("CHAVE", "IBGE6", "IBGE7", "ANO", "DA_AREA") & dplyr::where(is.numeric)
  ) |> 
  colnames() |> 
  unlist()
```

```{r get_var_character}

# Obter as siglas variáveis do tipo string
var_char <- data |> 
  dplyr::select(
    !c("CHAVE", "IBGE6", "IBGE7", "ANO", "DA_AREA") & dplyr::where(is.character)
  ) |> 
  colnames() |> 
  unlist()
```

# Introdução

A **crítica de dados** refere-se ao processo de verificação e validação da integridade dos dados. Esse processo é crucial para garantir a qualidade dos dados antes de serem utilizados para análises ou publicizados. A importância da crítica de dados reside na sua capacidade de identificar valores suspeitos ou inconsistências que poderiam comprometer a confiabilidade dos resultados obtidos a partir desses dados.

# Regras de crítica

As **regras de crítica** são diretrizes ou critérios específicos estabelecidos para avaliar se os dados atendem aos padrões de qualidade desejados. Essas regras podem incluir a verificação de intervalos de valores aceitáveis, a consistência lógica entre diferentes variáveis, e a detecção de valores ausentes, entre outras. Aplicar essas regras de maneira sistemática ajuda a assegurar que os dados sejam precisos, completos e adequados para seu propósito, promovendo a confiança nas análises e nas decisões baseadas em dados. A padronização dos nomes permite que seja possível a identificação da classificação da regra e a presença do atributo de flexibilidade. Define-se a seguinte proposta de nomenclatura para as regras de crítica:

*1 carácter indicando finalidade + 1 carácter indicando flexibilidade + Sigla da variável*

**Classificação por finalidade**

Tipo (T): refere-se a classe da variável, são realizadas verificações no sentido de identificar se os dados são numéricos, caracteres, lógicos, entre outros.

-   **TI\_**[...]: tipo do dado está de acordo com o esperado (numérico, textual ou categórico).

Validade ou Intervalo (V): refere-se aos intervalos estabelecidos matematicamente para um dado ou indicador. Verificações de valores positivos, intervalos entre 0 e 1, são exemplos de verificação de validades, além da verificação de valores ausentes;

-   **VI_NA\_**[...]: dado não tem valor ausente/*missing*;

-   **VI\_**[...]: dado é não negativo, está devidamente categorizado ou está entre o intervalo esperado (ex.: 0% e 100%).

Consistência (C): refere-se aos casos em que se verificam as relações matemáticas com outras variáveis, por exemplo, parcelas de um total não podem ser maiores do que o próprio total.

-   **CF\_[...]\_total_year**: a soma da proporção anual é igual a $\approx$ 100%.

Distribuição (D): regras de distribuição estabelecem parâmetros esperados para as estatísticas descritivas da variável como média, mediana, máximo, mínimo e regras de identificação de *outliers*;

-   **DF\_[...]\_hampel_munic**: método de identificação de um possível valor *outlier* na série histórica;

-   **DF\_[...]\_out_munic**: segundo método de identificação de um possível valor *outlier* na série histórica;

-   **DF\_[...]\_min_munic**: o valor mais recente é maior ou igual ao menor valor da série histórica;

-   **DF\_[...]\_max_munic**: o valor mais recente é menor ou igual ao maior valor da série histórica;

-   **DF\_[...]\_min_k_munic**: o valor mais recente é maior ou igual ao $\dfrac{menor}{k}$ valor da série histórica;

-   **DF\_[...]\_max_k_munic**: o valor mais recente é menor ou igual ao $maior \times k$ valor da série histórica;

-   **DF\_[...]\_med_mov_munic**: o valor atual é menor ou igual a $mediana ~móvel \times k$;

-   **DF\_[...]\_dif_munic**: o valor mais recente da primeira diferença é menor ou igual ao maior valor da primeira diferença da série histórica;


**Classificação por flexibilidade (F ou I)**

-   Flexível (F): construída com parâmetros esperados, mas caso algum caso falhe a regra, precisa ser investigado o motivo, identificando se é o caso de um valor atípico explicado por alguma situação.

-   Inflexível (I): necessariamente precisa ser seguida, uma regra inflexível é rígida e não existe exceção a sua condição estipulada.

```{r set_year}

# Inserir aqui apenas aquelas variáveis que possuem alguma restrição 
# no ano inicial de análise devido a fatores como mudança de metodologia
# ano_base_alter <- c(
#   "MA_ICMSECOLOG" = 2010
# )

# Remover os comentários para utilizar este trecho caso não haja nenhuma restrição
# para nenhuma variável
ano_base_alter <- c(
  "NA" = NA_integer_
)

# exclusions_years <- c(
#   "EO_IDEBFU6A9"       = c(2006, 2008, 2010, 2012, 2014, 2016, 2018, 2020, 2022),
#   "EO_TXAPROV6A9"      = c(2006,2008)
#   )
```


```{r map_valid_desc}

# Mapear variável e descrição de sua respectiva regra de validade para ser apresentado na tabela.
desc_regra_valid <- c(
  # Casos mais comuns
  `1` = "Valor é ≥ 0",
  `2` = "Valor está dentro da categoria esperada",
  `3` = "Valor está dentro da faixa esperada (0 a 100)",
  `4` = "Valor está dentro da faixa esperada (0 a 1000)",
  `5` = "Valor está dentro da faixa esperada (0 a 10000)",
  `6` = "Valor está dentro da faixa esperada (0 a 100000)",
  # Casos especiais
  `7` = "Valor é ≥ 1", # SP_PM e SP_PMPC
  `8` = "Valor é ≥ 8", # SP_PM1
  `9`  = "Valor está dentro da faixa esperada (0 a 0,33)", # HS_POLITICA e HS_PLANOSAN
  `10` = "Valor está dentro da faixa esperada (0 a 0,34)", # HS_CONSELHO
  `11` = "Valor está dentro da faixa esperada (0 a 1)"     # HS_GESTAO
)

# df com o nome da regra e a respectiva descrição
desc_regra_valid_var <- data.frame(
  Regra = c(
  #  "VI_DA_POPT",
    "VI_DA_POPTA",
    "VI_DA_POPP0",
    "VI_DA_POPP1A4",
    "VI_DA_POPP4",
    "VI_DA_POPP5",
    "VI_DA_POPP4E5",
    "VI_DA_POPP5A9",
    "VI_DA_POPP6A14",
    "VI_DA_POPP10A14",
    "VI_DA_POPP15",
    "VI_DA_POPP15A17",
    "VI_DA_POPP15A19",
    "VI_DA_POPP15M",
    "VI_DA_POPP16A19",
    "VI_DA_POPP16A64",
    "VI_DA_POPP18M",
    "VI_DA_POPP20A24",
    "VI_DA_POPP25A29",
    "VI_DA_POPP30A34",
    "VI_DA_POPP35A39",
    "VI_DA_POPP40A44",
    "VI_DA_POPP45A49",
    "VI_DA_POPP50A54",
    "VI_DA_POPP55A59",
    "VI_DA_POPP60A64",
    "VI_DA_POPP65A69",
    "VI_DA_POPP70A74",
    "VI_DA_POPP75A79",
    "VI_DA_POPP80M",
    "VI_DA_DENSP",
    "VI_DA_PROPP4E5",
    "VI_DA_PROPP0A5",
    "VI_DA_PROPP6A17",
    "VI_DA_RDEPP",
    "VI_DA_PROPP15N",
    "VI_DA_PROPP65M",
    "VI_DA_INDENVE",
  #  "VI_DA_POPPURB",
  #  "VI_DA_TFT",
  #  "VI_DA_TMI",
  #  "VI_DA_ESPVIDA",
  #  "VI_DA_TBM",
  #  "VI_DA_TBN",
  #  "VI_DA_TCV",
  #  "VI_DA_TLM",
  #  "VI_DA_TCD",
  #  "VI_DA_EMIGRA",
  #  "VI_DA_IMIGRA",
    "VI_DA_HOMEM0A4",
    "VI_DA_HOMEM5A9",
    "VI_DA_HOMEM10A14",
    "VI_DA_HOMEM15A19",
    "VI_DA_HOMEM20A24",
    "VI_DA_HOMEM25A29",
    "VI_DA_HOMEM30A34",
    "VI_DA_HOMEM35A39",
    "VI_DA_HOMEM40A44",
    "VI_DA_HOMEM45A49",
    "VI_DA_HOMEM50A54",
    "VI_DA_HOMEM55A59",
    "VI_DA_HOMEM60A64",
    "VI_DA_HOMEM65A69",
    "VI_DA_HOMEM70A74",
    "VI_DA_HOMEM75A79",
    "VI_DA_HOMEM80",
    "VI_DA_MULH0A4",
    "VI_DA_MULH5A9",
    "VI_DA_MULH10A14",
    "VI_DA_MULH15A19",
    "VI_DA_MULH20A24",
    "VI_DA_MULH25A29",
    "VI_DA_MULH30A34",
    "VI_DA_MULH35A39",
    "VI_DA_MULH40A44",
    "VI_DA_MULH45A49",
    "VI_DA_MULH50A54",
    "VI_DA_MULH55A59",
    "VI_DA_MULH60A64",
    "VI_DA_MULH65A69",
    "VI_DA_MULH70A74",
    "VI_DA_MULH75A79",
    "VI_DA_MULHER80",
    "VI_DA_HOMEMTOT",
    "VI_DA_MULHERTOT"
  )
) |> 
  dplyr::mutate(
    `Descrição` = dplyr::case_match(
      Regra,
  #  "VI_DA_POPT"       ~ desc_regra_valid[1],
    "VI_DA_POPTA"      ~ desc_regra_valid[1],
    "VI_DA_POPP0"      ~ desc_regra_valid[1],
    "VI_DA_POPP1A4"    ~ desc_regra_valid[1],
    "VI_DA_POPP4"      ~ desc_regra_valid[1],
    "VI_DA_POPP5"      ~ desc_regra_valid[1],
    "VI_DA_POPP4E5"    ~ desc_regra_valid[1],
    "VI_DA_POPP5A9"    ~ desc_regra_valid[1],
    "VI_DA_POPP6A14"   ~ desc_regra_valid[1],
    "VI_DA_POPP10A14"  ~ desc_regra_valid[1],
    "VI_DA_POPP15"     ~ desc_regra_valid[1],
    "VI_DA_POPP15A17"  ~ desc_regra_valid[1],
    "VI_DA_POPP15A19"  ~ desc_regra_valid[1],
    "VI_DA_POPP15M"    ~ desc_regra_valid[1],
    "VI_DA_POPP16A19"  ~ desc_regra_valid[1],
    "VI_DA_POPP16A64"  ~ desc_regra_valid[1],
    "VI_DA_POPP18M"    ~ desc_regra_valid[1],
    "VI_DA_POPP20A24"  ~ desc_regra_valid[1],
    "VI_DA_POPP25A29"  ~ desc_regra_valid[1],
    "VI_DA_POPP30A34"  ~ desc_regra_valid[1],
    "VI_DA_POPP35A39"  ~ desc_regra_valid[1],
    "VI_DA_POPP40A44"  ~ desc_regra_valid[1],
    "VI_DA_POPP45A49"  ~ desc_regra_valid[1],
    "VI_DA_POPP50A54"  ~ desc_regra_valid[1],
    "VI_DA_POPP55A59"  ~ desc_regra_valid[1],
    "VI_DA_POPP60A64"  ~ desc_regra_valid[1],
    "VI_DA_POPP65A69"  ~ desc_regra_valid[1],
    "VI_DA_POPP70A74"  ~ desc_regra_valid[1],
    "VI_DA_POPP75A79"  ~ desc_regra_valid[1],
    "VI_DA_POPP80M"    ~ desc_regra_valid[1],
    "VI_DA_DENSP"      ~ desc_regra_valid[1],
    "VI_DA_PROPP4E5"   ~ desc_regra_valid[3],
    "VI_DA_PROPP0A5"   ~ desc_regra_valid[3],
    "VI_DA_PROPP6A17"  ~ desc_regra_valid[3],
    "VI_DA_RDEPP"      ~ desc_regra_valid[3],
    "VI_DA_PROPP15N"   ~ desc_regra_valid[3],
    "VI_DA_PROPP65M"   ~ desc_regra_valid[3],
    "VI_DA_INDENVE"    ~ desc_regra_valid[3],
  #  "VI_DA_POPPURB"    ~ desc_regra_valid[3],
  #  "VI_DA_TFT"        ~ desc_regra_valid[1],
  #  "VI_DA_TMI"        ~ desc_regra_valid[4],
  #  "VI_DA_ESPVIDA"    ~ desc_regra_valid[1],
  #  "VI_DA_TBM"        ~ desc_regra_valid[4],
  #  "VI_DA_TBN"        ~ desc_regra_valid[4],
  #  "VI_DA_TCV"        ~ desc_regra_valid[1],
  #  "VI_DA_TLM"        ~ desc_regra_valid[4],
  #  "VI_DA_TCD"        ~ desc_regra_valid[1],
  #  "VI_DA_EMIGRA"     ~ desc_regra_valid[1],
  #  "VI_DA_IMIGRA"     ~ desc_regra_valid[1],
    "VI_DA_HOMEM0A4"   ~ desc_regra_valid[1],
    "VI_DA_HOMEM5A9"   ~ desc_regra_valid[1],
    "VI_DA_HOMEM10A14" ~ desc_regra_valid[1],
    "VI_DA_HOMEM15A19" ~ desc_regra_valid[1],
    "VI_DA_HOMEM20A24" ~ desc_regra_valid[1],
    "VI_DA_HOMEM25A29" ~ desc_regra_valid[1],
    "VI_DA_HOMEM30A34" ~ desc_regra_valid[1],
    "VI_DA_HOMEM35A39" ~ desc_regra_valid[1],
    "VI_DA_HOMEM40A44" ~ desc_regra_valid[1],
    "VI_DA_HOMEM45A49" ~ desc_regra_valid[1],
    "VI_DA_HOMEM50A54" ~ desc_regra_valid[1],
    "VI_DA_HOMEM55A59" ~ desc_regra_valid[1],
    "VI_DA_HOMEM60A64" ~ desc_regra_valid[1],
    "VI_DA_HOMEM65A69" ~ desc_regra_valid[1],
    "VI_DA_HOMEM70A74" ~ desc_regra_valid[1],
    "VI_DA_HOMEM75A79" ~ desc_regra_valid[1],
    "VI_DA_HOMEM80"    ~ desc_regra_valid[1],
    "VI_DA_MULH0A4"    ~ desc_regra_valid[1],
    "VI_DA_MULH5A9"    ~ desc_regra_valid[1],
    "VI_DA_MULH10A14"  ~ desc_regra_valid[1],
    "VI_DA_MULH15A19"  ~ desc_regra_valid[1],
    "VI_DA_MULH20A24"  ~ desc_regra_valid[1],
    "VI_DA_MULH25A29"  ~ desc_regra_valid[1],
    "VI_DA_MULH30A34"  ~ desc_regra_valid[1],
    "VI_DA_MULH35A39"  ~ desc_regra_valid[1],
    "VI_DA_MULH40A44"  ~ desc_regra_valid[1],
    "VI_DA_MULH45A49"  ~ desc_regra_valid[1],
    "VI_DA_MULH50A54"  ~ desc_regra_valid[1],
    "VI_DA_MULH55A59"  ~ desc_regra_valid[1],
    "VI_DA_MULH60A64"  ~ desc_regra_valid[1],
    "VI_DA_MULH65A69"  ~ desc_regra_valid[1],
    "VI_DA_MULH70A74"  ~ desc_regra_valid[1],
    "VI_DA_MULH75A79"  ~ desc_regra_valid[1],
    "VI_DA_MULHER80"   ~ desc_regra_valid[1],
    "VI_DA_HOMEMTOT"   ~ desc_regra_valid[1],
    "VI_DA_MULHERTOT"  ~ desc_regra_valid[1]
    )
  )
```

## Tipo

### Todos os indicadores

```{r rules_type}
  
rules_type <- validate::validator(
# TI_DA_POPT       = is.numeric(DA_POPT),
 TI_DA_POPTA      = is.numeric(DA_POPTA),
 TI_DA_POPP0      = is.numeric(DA_POPP0),
 TI_DA_POPP1A4    = is.numeric(DA_POPP1A4),
 TI_DA_POPP4      = is.numeric(DA_POPP4),
 TI_DA_POPP5      = is.numeric(DA_POPP5),
 TI_DA_POPP4E5    = is.numeric(DA_POPP4E5),
 TI_DA_POPP5A9    = is.numeric(DA_POPP5A9),
 TI_DA_POPP6A14   = is.numeric(DA_POPP6A14),
 TI_DA_POPP10A14  = is.numeric(DA_POPP10A14),
 TI_DA_POPP15     = is.numeric(DA_POPP15),
 TI_DA_POPP15A17  = is.numeric(DA_POPP15A17),
 TI_DA_POPP15A19  = is.numeric(DA_POPP15A19),
 TI_DA_POPP15M    = is.numeric(DA_POPP15M),
 TI_DA_POPP16A19  = is.numeric(DA_POPP16A19),
 TI_DA_POPP16A64  = is.numeric(DA_POPP16A64),
 TI_DA_POPP18M    = is.numeric(DA_POPP18M),
 TI_DA_POPP20A24  = is.numeric(DA_POPP20A24),
 TI_DA_POPP25A29  = is.numeric(DA_POPP25A29),
 TI_DA_POPP30A34  = is.numeric(DA_POPP30A34),
 TI_DA_POPP35A39  = is.numeric(DA_POPP35A39),
 TI_DA_POPP40A44  = is.numeric(DA_POPP40A44),
 TI_DA_POPP45A49  = is.numeric(DA_POPP45A49),
 TI_DA_POPP50A54  = is.numeric(DA_POPP50A54),
 TI_DA_POPP55A59  = is.numeric(DA_POPP55A59),
 TI_DA_POPP60A64  = is.numeric(DA_POPP60A64),
 TI_DA_POPP65A69  = is.numeric(DA_POPP65A69),
 TI_DA_POPP70A74  = is.numeric(DA_POPP70A74),
 TI_DA_POPP75A79  = is.numeric(DA_POPP75A79),
 TI_DA_POPP80M    = is.numeric(DA_POPP80M),
 TI_DA_DENSP      = is.numeric(DA_DENSP),
 TI_DA_PROPP4E5   = is.numeric(DA_PROPP4E5),
 TI_DA_PROPP0A5   = is.numeric(DA_PROPP0A5),
 TI_DA_PROPP6A17  = is.numeric(DA_PROPP6A17),
 TI_DA_RDEPP      = is.numeric(DA_RDEPP),
 TI_DA_PROPP15N   = is.numeric(DA_PROPP15N),
 TI_DA_PROPP65M   = is.numeric(DA_PROPP65M),
 TI_DA_INDENVE    = is.numeric(DA_INDENVE),
# TI_DA_POPPURB    = is.numeric(DA_POPPURB),
# TI_DA_TFT        = is.numeric(DA_TFT),
# TI_DA_TMI        = is.numeric(DA_TMI),
# TI_DA_ESPVIDA    = is.numeric(DA_ESPVIDA),
# TI_DA_TBM        = is.numeric(DA_TBM),
# TI_DA_TBN        = is.numeric(DA_TBN),
# TI_DA_TCV        = is.numeric(DA_TCV),
# TI_DA_TLM        = is.numeric(DA_TLM),
# TI_DA_TCD        = is.numeric(DA_TCD),
# TI_DA_EMIGRA     = is.numeric(DA_EMIGRA),
# TI_DA_IMIGRA     = is.numeric(DA_IMIGRA),
 TI_DA_HOMEM0A4   = is.numeric(DA_HOMEM0A4),
 TI_DA_HOMEM5A9   = is.numeric(DA_HOMEM5A9),
 TI_DA_HOMEM10A14 = is.numeric(DA_HOMEM10A14),
 TI_DA_HOMEM15A19 = is.numeric(DA_HOMEM15A19),
 TI_DA_HOMEM20A24 = is.numeric(DA_HOMEM20A24),
 TI_DA_HOMEM25A29 = is.numeric(DA_HOMEM25A29),
 TI_DA_HOMEM30A34 = is.numeric(DA_HOMEM30A34),
 TI_DA_HOMEM35A39 = is.numeric(DA_HOMEM35A39),
 TI_DA_HOMEM40A44 = is.numeric(DA_HOMEM40A44),
 TI_DA_HOMEM45A49 = is.numeric(DA_HOMEM45A49),
 TI_DA_HOMEM50A54 = is.numeric(DA_HOMEM50A54),
 TI_DA_HOMEM55A59 = is.numeric(DA_HOMEM55A59),
 TI_DA_HOMEM60A64 = is.numeric(DA_HOMEM60A64),
 TI_DA_HOMEM65A69 = is.numeric(DA_HOMEM65A69),
 TI_DA_HOMEM70A74 = is.numeric(DA_HOMEM70A74),
 TI_DA_HOMEM75A79 = is.numeric(DA_HOMEM75A79),
 TI_DA_HOMEM80    = is.numeric(DA_HOMEM80),
 TI_DA_MULH0A4    = is.numeric(DA_MULH0A4),
 TI_DA_MULH5A9    = is.numeric(DA_MULH5A9),
 TI_DA_MULH10A14  = is.numeric(DA_MULH10A14),
 TI_DA_MULH15A19  = is.numeric(DA_MULH15A19),
 TI_DA_MULH20A24  = is.numeric(DA_MULH20A24),
 TI_DA_MULH25A29  = is.numeric(DA_MULH25A29),
 TI_DA_MULH30A34  = is.numeric(DA_MULH30A34),
 TI_DA_MULH35A39  = is.numeric(DA_MULH35A39),
 TI_DA_MULH40A44  = is.numeric(DA_MULH40A44),
 TI_DA_MULH45A49  = is.numeric(DA_MULH45A49),
 TI_DA_MULH50A54  = is.numeric(DA_MULH50A54),
 TI_DA_MULH55A59  = is.numeric(DA_MULH55A59),
 TI_DA_MULH60A64  = is.numeric(DA_MULH60A64),
 TI_DA_MULH65A69  = is.numeric(DA_MULH65A69),
 TI_DA_MULH70A74  = is.numeric(DA_MULH70A74),
 TI_DA_MULH75A79  = is.numeric(DA_MULH75A79),
 TI_DA_MULHER80   = is.numeric(DA_MULHER80),
 TI_DA_HOMEMTOT   = is.numeric(DA_HOMEMTOT),
 TI_DA_MULHERTOT  = is.numeric(DA_MULHERTOT)
)
```

```{r confront_type}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_type <- validate::confront(data, rules_type)

validate::summary(check_type) |> 
  dplyr::select(
    Regra    = name,
    Validada = passes
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |>
  kableExtra::kable_paper("hover", full_width = F)
```

## Validade

```{r data_rules_valid_da_all}

## df com o resultado das aplicações das regras
df_rules_valid_da_all <- data |> 
  dplyr::select(
    Ano   = ANO, 
    ibge7 = IBGE7, 
    dplyr::starts_with("DA_")
  ) |> 
  dplyr::mutate(
    # Missing
  #  VI_NA_DA_POPT       = dplyr::if_else(!is.na(DA_POPT), F, NA),
    VI_NA_DA_POPTA      = dplyr::if_else(!is.na(DA_POPTA), F, NA),
    VI_NA_DA_POPP0      = dplyr::if_else(!is.na(DA_POPP0), F, NA),
    VI_NA_DA_POPP1A4    = dplyr::if_else(!is.na(DA_POPP1A4), F, NA),
    VI_NA_DA_POPP4      = dplyr::if_else(!is.na(DA_POPP4), F, NA),
    VI_NA_DA_POPP5      = dplyr::if_else(!is.na(DA_POPP5), F, NA),
    VI_NA_DA_POPP4E5    = dplyr::if_else(!is.na(DA_POPP4E5), F, NA),
    VI_NA_DA_POPP5A9    = dplyr::if_else(!is.na(DA_POPP5A9), F, NA),
    VI_NA_DA_POPP6A14   = dplyr::if_else(!is.na(DA_POPP6A14), F, NA),
    VI_NA_DA_POPP10A14  = dplyr::if_else(!is.na(DA_POPP10A14), F, NA),
    VI_NA_DA_POPP15     = dplyr::if_else(!is.na(DA_POPP15), F, NA),
    VI_NA_DA_POPP15A17  = dplyr::if_else(!is.na(DA_POPP15A17), F, NA),
    VI_NA_DA_POPP15A19  = dplyr::if_else(!is.na(DA_POPP15A19), F, NA),
    VI_NA_DA_POPP15M    = dplyr::if_else(!is.na(DA_POPP15M), F, NA),
    VI_NA_DA_POPP16A19  = dplyr::if_else(!is.na(DA_POPP16A19), F, NA),
    VI_NA_DA_POPP16A64  = dplyr::if_else(!is.na(DA_POPP16A64), F, NA),
    VI_NA_DA_POPP18M    = dplyr::if_else(!is.na(DA_POPP18M), F, NA),
    VI_NA_DA_POPP20A24  = dplyr::if_else(!is.na(DA_POPP20A24), F, NA),
    VI_NA_DA_POPP25A29  = dplyr::if_else(!is.na(DA_POPP25A29), F, NA),
    VI_NA_DA_POPP30A34  = dplyr::if_else(!is.na(DA_POPP30A34), F, NA),
    VI_NA_DA_POPP35A39  = dplyr::if_else(!is.na(DA_POPP35A39), F, NA),
    VI_NA_DA_POPP40A44  = dplyr::if_else(!is.na(DA_POPP40A44), F, NA),
    VI_NA_DA_POPP45A49  = dplyr::if_else(!is.na(DA_POPP45A49), F, NA),
    VI_NA_DA_POPP50A54  = dplyr::if_else(!is.na(DA_POPP50A54), F, NA),
    VI_NA_DA_POPP55A59  = dplyr::if_else(!is.na(DA_POPP55A59), F, NA),
    VI_NA_DA_POPP60A64  = dplyr::if_else(!is.na(DA_POPP60A64), F, NA),
    VI_NA_DA_POPP65A69  = dplyr::if_else(!is.na(DA_POPP65A69), F, NA),
    VI_NA_DA_POPP70A74  = dplyr::if_else(!is.na(DA_POPP70A74), F, NA),
    VI_NA_DA_POPP75A79  = dplyr::if_else(!is.na(DA_POPP75A79), F, NA),
    VI_NA_DA_POPP80M    = dplyr::if_else(!is.na(DA_POPP80M), F, NA),
    VI_NA_DA_DENSP      = dplyr::if_else(!is.na(DA_DENSP), F, NA),
    VI_NA_DA_PROPP4E5   = dplyr::if_else(!is.na(DA_PROPP4E5), F, NA),
    VI_NA_DA_PROPP0A5   = dplyr::if_else(!is.na(DA_PROPP0A5), F, NA),
    VI_NA_DA_PROPP6A17  = dplyr::if_else(!is.na(DA_PROPP6A17), F, NA),
    VI_NA_DA_RDEPP      = dplyr::if_else(!is.na(DA_RDEPP), F, NA),
    VI_NA_DA_PROPP15N   = dplyr::if_else(!is.na(DA_PROPP15N), F, NA),
    VI_NA_DA_PROPP65M   = dplyr::if_else(!is.na(DA_PROPP65M), F, NA),
    VI_NA_DA_INDENVE    = dplyr::if_else(!is.na(DA_INDENVE), F, NA),
  #  VI_NA_DA_POPPURB    = dplyr::if_else(!is.na(DA_POPPURB), F, NA),
  #  VI_NA_DA_TFT        = dplyr::if_else(!is.na(DA_TFT), F, NA),
  #  VI_NA_DA_TMI        = dplyr::if_else(!is.na(DA_TMI), F, NA),
  #  VI_NA_DA_ESPVIDA    = dplyr::if_else(!is.na(DA_ESPVIDA), F, NA),
  #  VI_NA_DA_TBM        = dplyr::if_else(!is.na(DA_TBM), F, NA),
  #  VI_NA_DA_TBN        = dplyr::if_else(!is.na(DA_TBN), F, NA),
  #  VI_NA_DA_TCV        = dplyr::if_else(!is.na(DA_TCV), F, NA),
  #  VI_NA_DA_TLM        = dplyr::if_else(!is.na(DA_TLM), F, NA),
  #  VI_NA_DA_TCD        = dplyr::if_else(!is.na(DA_TCD), F, NA),
  #  VI_NA_DA_EMIGRA     = dplyr::if_else(!is.na(DA_EMIGRA), F, NA),
  #  VI_NA_DA_IMIGRA     = dplyr::if_else(!is.na(DA_IMIGRA), F, NA),
    VI_NA_DA_HOMEM0A4   = dplyr::if_else(!is.na(DA_HOMEM0A4), F, NA),
    VI_NA_DA_HOMEM5A9   = dplyr::if_else(!is.na(DA_HOMEM5A9), F, NA),
    VI_NA_DA_HOMEM10A14 = dplyr::if_else(!is.na(DA_HOMEM10A14), F, NA),
    VI_NA_DA_HOMEM15A19 = dplyr::if_else(!is.na(DA_HOMEM15A19), F, NA),
    VI_NA_DA_HOMEM20A24 = dplyr::if_else(!is.na(DA_HOMEM20A24), F, NA),
    VI_NA_DA_HOMEM25A29 = dplyr::if_else(!is.na(DA_HOMEM25A29), F, NA),
    VI_NA_DA_HOMEM30A34 = dplyr::if_else(!is.na(DA_HOMEM30A34), F, NA),
    VI_NA_DA_HOMEM35A39 = dplyr::if_else(!is.na(DA_HOMEM35A39), F, NA),
    VI_NA_DA_HOMEM40A44 = dplyr::if_else(!is.na(DA_HOMEM40A44), F, NA),
    VI_NA_DA_HOMEM45A49 = dplyr::if_else(!is.na(DA_HOMEM45A49), F, NA),
    VI_NA_DA_HOMEM50A54 = dplyr::if_else(!is.na(DA_HOMEM50A54), F, NA),
    VI_NA_DA_HOMEM55A59 = dplyr::if_else(!is.na(DA_HOMEM55A59), F, NA),
    VI_NA_DA_HOMEM60A64 = dplyr::if_else(!is.na(DA_HOMEM60A64), F, NA),
    VI_NA_DA_HOMEM65A69 = dplyr::if_else(!is.na(DA_HOMEM65A69), F, NA),
    VI_NA_DA_HOMEM70A74 = dplyr::if_else(!is.na(DA_HOMEM70A74), F, NA),
    VI_NA_DA_HOMEM75A79 = dplyr::if_else(!is.na(DA_HOMEM75A79), F, NA),
    VI_NA_DA_HOMEM80    = dplyr::if_else(!is.na(DA_HOMEM80), F, NA),
    VI_NA_DA_MULH0A4    = dplyr::if_else(!is.na(DA_MULH0A4), F, NA),
    VI_NA_DA_MULH5A9    = dplyr::if_else(!is.na(DA_MULH5A9), F, NA),
    VI_NA_DA_MULH10A14  = dplyr::if_else(!is.na(DA_MULH10A14), F, NA),
    VI_NA_DA_MULH15A19  = dplyr::if_else(!is.na(DA_MULH15A19), F, NA),
    VI_NA_DA_MULH20A24  = dplyr::if_else(!is.na(DA_MULH20A24), F, NA),
    VI_NA_DA_MULH25A29  = dplyr::if_else(!is.na(DA_MULH25A29), F, NA),
    VI_NA_DA_MULH30A34  = dplyr::if_else(!is.na(DA_MULH30A34), F, NA),
    VI_NA_DA_MULH35A39  = dplyr::if_else(!is.na(DA_MULH35A39), F, NA),
    VI_NA_DA_MULH40A44  = dplyr::if_else(!is.na(DA_MULH40A44), F, NA),
    VI_NA_DA_MULH45A49  = dplyr::if_else(!is.na(DA_MULH45A49), F, NA),
    VI_NA_DA_MULH50A54  = dplyr::if_else(!is.na(DA_MULH50A54), F, NA),
    VI_NA_DA_MULH55A59  = dplyr::if_else(!is.na(DA_MULH55A59), F, NA),
    VI_NA_DA_MULH60A64  = dplyr::if_else(!is.na(DA_MULH60A64), F, NA),
    VI_NA_DA_MULH65A69  = dplyr::if_else(!is.na(DA_MULH65A69), F, NA),
    VI_NA_DA_MULH70A74  = dplyr::if_else(!is.na(DA_MULH70A74), F, NA),
    VI_NA_DA_MULH75A79  = dplyr::if_else(!is.na(DA_MULH75A79), F, NA),
    VI_NA_DA_MULHER80   = dplyr::if_else(!is.na(DA_MULHER80), F, NA),
    VI_NA_DA_HOMEMTOT   = dplyr::if_else(!is.na(DA_HOMEMTOT), F, NA),
    VI_NA_DA_MULHERTOT  = dplyr::if_else(!is.na(DA_MULHERTOT), F, NA),
    # Others
  #  VI_DA_POPT       = dplyr::if_else(DA_POPT >= 0, F, T),
    VI_DA_POPTA      = dplyr::if_else(DA_POPTA >= 0, F, T),
    VI_DA_POPP0      = dplyr::if_else(DA_POPP0 >= 0, F, T),
    VI_DA_POPP1A4    = dplyr::if_else(DA_POPP1A4 >= 0, F, T),
    VI_DA_POPP4      = dplyr::if_else(DA_POPP4 >= 0, F, T),
    VI_DA_POPP5      = dplyr::if_else(DA_POPP5 >= 0, F, T),
    VI_DA_POPP4E5    = dplyr::if_else(DA_POPP4E5 >= 0, F, T),
    VI_DA_POPP5A9    = dplyr::if_else(DA_POPP5A9 >= 0, F, T),
    VI_DA_POPP6A14   = dplyr::if_else(DA_POPP6A14 >= 0, F, T),
    VI_DA_POPP10A14  = dplyr::if_else(DA_POPP10A14 >= 0, F, T),
    VI_DA_POPP15     = dplyr::if_else(DA_POPP15 >= 0, F, T),
    VI_DA_POPP15A17  = dplyr::if_else(DA_POPP15A17 >= 0, F, T),
    VI_DA_POPP15A19  = dplyr::if_else(DA_POPP15A19 >= 0, F, T),
    VI_DA_POPP15M    = dplyr::if_else(DA_POPP15M >= 0, F, T),
    VI_DA_POPP16A19  = dplyr::if_else(DA_POPP16A19 >= 0, F, T),
    VI_DA_POPP16A64  = dplyr::if_else(DA_POPP16A64 >= 0, F, T),
    VI_DA_POPP18M    = dplyr::if_else(DA_POPP18M >= 0, F, T),
    VI_DA_POPP20A24  = dplyr::if_else(DA_POPP20A24 >= 0, F, T),
    VI_DA_POPP25A29  = dplyr::if_else(DA_POPP25A29 >= 0, F, T),
    VI_DA_POPP30A34  = dplyr::if_else(DA_POPP30A34 >= 0, F, T),
    VI_DA_POPP35A39  = dplyr::if_else(DA_POPP35A39 >= 0, F, T),
    VI_DA_POPP40A44  = dplyr::if_else(DA_POPP40A44 >= 0, F, T),
    VI_DA_POPP45A49  = dplyr::if_else(DA_POPP45A49 >= 0, F, T),
    VI_DA_POPP50A54  = dplyr::if_else(DA_POPP50A54 >= 0, F, T),
    VI_DA_POPP55A59  = dplyr::if_else(DA_POPP55A59 >= 0, F, T),
    VI_DA_POPP60A64  = dplyr::if_else(DA_POPP60A64 >= 0, F, T),
    VI_DA_POPP65A69  = dplyr::if_else(DA_POPP65A69 >= 0, F, T),
    VI_DA_POPP70A74  = dplyr::if_else(DA_POPP70A74 >= 0, F, T),
    VI_DA_POPP75A79  = dplyr::if_else(DA_POPP75A79 >= 0, F, T),
    VI_DA_POPP80M    = dplyr::if_else(DA_POPP80M >= 0, F, T),
    VI_DA_DENSP      = dplyr::if_else(DA_DENSP >= 0, F, T),
    VI_DA_PROPP4E5   = dplyr::if_else(dplyr::between(DA_PROPP4E5, 0, 100), F, T),
    VI_DA_PROPP0A5   = dplyr::if_else(dplyr::between(DA_PROPP0A5, 0, 100), F, T),
    VI_DA_PROPP6A17  = dplyr::if_else(dplyr::between(DA_PROPP6A17, 0, 100), F, T),
    VI_DA_RDEPP      = dplyr::if_else(dplyr::between(DA_RDEPP, 0, 100), F, T),
    VI_DA_PROPP15N   = dplyr::if_else(dplyr::between(DA_PROPP15N, 0, 100), F, T),
    VI_DA_PROPP65M   = dplyr::if_else(dplyr::between(DA_PROPP65M, 0, 100), F, T),
    VI_DA_INDENVE    = dplyr::if_else(dplyr::between(DA_INDENVE, 0, 100), F, T),
  #  VI_DA_POPPURB    = dplyr::if_else(dplyr::between(DA_POPPURB, 0, 100), F, T),
  #  VI_DA_TFT        = dplyr::if_else(DA_TFT >= 0, F, T),
  #  VI_DA_TMI        = dplyr::if_else(dplyr::between(DA_TMI, 0, 1000), F, T),
  #  VI_DA_ESPVIDA    = dplyr::if_else(DA_ESPVIDA >= 0, F, T),
  #  VI_DA_TBM        = dplyr::if_else(dplyr::between(DA_TBM, 0, 1000), F, T),
  #  VI_DA_TBN        = dplyr::if_else(dplyr::between(DA_TBN, 0, 1000), F, T),
  #  VI_DA_TCV        = dplyr::if_else(DA_TCV >= 0, F, T),
  #  VI_DA_TLM        = dplyr::if_else(dplyr::between(DA_TLM, 0, 1000), F, T),
  #  VI_DA_TCD        = dplyr::if_else(DA_TCD >= 0, F, T),
  #  VI_DA_EMIGRA     = dplyr::if_else(DA_EMIGRA >= 0, F, T),
  #  VI_DA_IMIGRA     = dplyr::if_else(DA_IMIGRA >= 0, F, T),
    VI_DA_HOMEM0A4   = dplyr::if_else(DA_HOMEM0A4 >= 0, F, T),
    VI_DA_HOMEM5A9   = dplyr::if_else(DA_HOMEM5A9 >= 0, F, T),
    VI_DA_HOMEM10A14 = dplyr::if_else(DA_HOMEM10A14 >= 0, F, T),
    VI_DA_HOMEM15A19 = dplyr::if_else(DA_HOMEM15A19 >= 0, F, T),
    VI_DA_HOMEM20A24 = dplyr::if_else(DA_HOMEM20A24 >= 0, F, T),
    VI_DA_HOMEM25A29 = dplyr::if_else(DA_HOMEM25A29 >= 0, F, T),
    VI_DA_HOMEM30A34 = dplyr::if_else(DA_HOMEM30A34 >= 0, F, T),
    VI_DA_HOMEM35A39 = dplyr::if_else(DA_HOMEM35A39 >= 0, F, T),
    VI_DA_HOMEM40A44 = dplyr::if_else(DA_HOMEM40A44 >= 0, F, T),
    VI_DA_HOMEM45A49 = dplyr::if_else(DA_HOMEM45A49 >= 0, F, T),
    VI_DA_HOMEM50A54 = dplyr::if_else(DA_HOMEM50A54 >= 0, F, T),
    VI_DA_HOMEM55A59 = dplyr::if_else(DA_HOMEM55A59 >= 0, F, T),
    VI_DA_HOMEM60A64 = dplyr::if_else(DA_HOMEM60A64 >= 0, F, T),
    VI_DA_HOMEM65A69 = dplyr::if_else(DA_HOMEM65A69 >= 0, F, T),
    VI_DA_HOMEM70A74 = dplyr::if_else(DA_HOMEM70A74 >= 0, F, T),
    VI_DA_HOMEM75A79 = dplyr::if_else(DA_HOMEM75A79 >= 0, F, T),
    VI_DA_HOMEM80    = dplyr::if_else(DA_HOMEM80 >= 0, F, T),
    VI_DA_MULH0A4    = dplyr::if_else(DA_MULH0A4 >= 0, F, T),
    VI_DA_MULH5A9    = dplyr::if_else(DA_MULH5A9 >= 0, F, T),
    VI_DA_MULH10A14  = dplyr::if_else(DA_MULH10A14 >= 0, F, T),
    VI_DA_MULH15A19  = dplyr::if_else(DA_MULH15A19 >= 0, F, T),
    VI_DA_MULH20A24  = dplyr::if_else(DA_MULH20A24 >= 0, F, T),
    VI_DA_MULH25A29  = dplyr::if_else(DA_MULH25A29 >= 0, F, T),
    VI_DA_MULH30A34  = dplyr::if_else(DA_MULH30A34 >= 0, F, T),
    VI_DA_MULH35A39  = dplyr::if_else(DA_MULH35A39 >= 0, F, T),
    VI_DA_MULH40A44  = dplyr::if_else(DA_MULH40A44 >= 0, F, T),
    VI_DA_MULH45A49  = dplyr::if_else(DA_MULH45A49 >= 0, F, T),
    VI_DA_MULH50A54  = dplyr::if_else(DA_MULH50A54 >= 0, F, T),
    VI_DA_MULH55A59  = dplyr::if_else(DA_MULH55A59 >= 0, F, T),
    VI_DA_MULH60A64  = dplyr::if_else(DA_MULH60A64 >= 0, F, T),
    VI_DA_MULH65A69  = dplyr::if_else(DA_MULH65A69 >= 0, F, T),
    VI_DA_MULH70A74  = dplyr::if_else(DA_MULH70A74 >= 0, F, T),
    VI_DA_MULH75A79  = dplyr::if_else(DA_MULH75A79 >= 0, F, T),
    VI_DA_MULHER80   = dplyr::if_else(DA_MULHER80 >= 0, F, T),
    VI_DA_HOMEMTOT   = dplyr::if_else(DA_HOMEMTOT >= 0, F, T),
    VI_DA_MULHERTOT  = dplyr::if_else(DA_MULHERTOT >= 0, F, T)
  )
```

```{r data_wrangling_valid_da_all}

## Transformação dos resultados
df_sumario_valid_da <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano, 
    ibge7, 
    dplyr::starts_with(c("VI_DA", "VI_NA"))
  ) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_valid_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(resultado),
    `% Validada` = round(Validada / (Total - Ausente) * 100, 2),
    `% Suspeita` = round((Suspeita / (Total - Ausente)) * 100, 2),
    `% Ausente`  = round((Ausente / Total) * 100, 2)
  ) |> 
  dplyr::ungroup()

```

### Todos os indicadores - Valores ausentes

```{r table_valid_da_na_all}
df_sumario |>
  dplyr::select(Ano, Regra, Total, contains("Suspeita")) |>
  dplyr::filter(
    Ano == max(Ano) & 
    stringr::str_detect(Regra, "_NA_",)
  ) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  dplyr::rename(Ausente = Suspeita, `% Ausente` = `% Suspeita`) |>
  dplyr::mutate(`% Ausente` = ifelse(is.infinite(`% Ausente`),100,`% Ausente`)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)

```

### Todos os indicadores - Demais regras

```{r table_valid_da_all}
#| column: screen-inset-right

df_sumario |>
  dplyr::filter(
    Ano == max(Ano) & 
    stringr::str_detect(Regra, "_NA_", negate = T)
  ) |>
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  dplyr::left_join(desc_regra_valid_var, by = dplyr::join_by(Regra)) |>  # Introdução coluna descrição
  unique() |> 
  dplyr::select(-c(Ausente,`% Ausente`))|> 
  dplyr::mutate( `% Suspeita`= ifelse(is.na(`% Suspeita`),0,`% Suspeita`),
                  aux = ifelse(Validada==Total, 1, 0),
                 `% Validada` = ifelse(aux == 1, `% Validada`, round((Validada / Total) * 100, 2) 
                 ) )|> 
  dplyr::select(-aux)|>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)

```


## Distribuição

### DA_POPTA

```{r rules_dist_da_popta}

## df com o resultado das aplicações das regras
df_rules_dist_da_popta <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPTA" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPTA"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPTA) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPTA_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPTA), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_out_munic     = dplyr::if_else(!outlier_function(DA_POPTA), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_min_munic     = dplyr::if_else(DA_POPTA >= (min(dplyr::lag(DA_POPTA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_max_munic     = dplyr::if_else(DA_POPTA <= (max(dplyr::lag(DA_POPTA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_min_k_munic   = dplyr::if_else(DA_POPTA >= (min(dplyr::lag(DA_POPTA), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_max_k_munic   = dplyr::if_else(DA_POPTA <= (k * max(dplyr::lag(DA_POPTA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_med_mov_munic = dplyr::if_else(DA_POPTA <= (k * zoo::rollmedian(DA_POPTA, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPTA), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popta}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popta |> 
  dplyr::select(!DA_POPTA) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popta}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popta}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP0

```{r rules_dist_da_popp0}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp0 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP0" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP0"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP0) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP0_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP0), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_out_munic     = dplyr::if_else(!outlier_function(DA_POPP0), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_min_munic     = dplyr::if_else(DA_POPP0 >= (min(dplyr::lag(DA_POPP0), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_max_munic     = dplyr::if_else(DA_POPP0 <= (max(dplyr::lag(DA_POPP0), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_min_k_munic   = dplyr::if_else(DA_POPP0 >= (min(dplyr::lag(DA_POPP0), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_max_k_munic   = dplyr::if_else(DA_POPP0 <= (k * max(dplyr::lag(DA_POPP0), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_med_mov_munic = dplyr::if_else(DA_POPP0 <= (k * zoo::rollmedian(DA_POPP0, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP0), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp0}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp0 |> 
  dplyr::select(!DA_POPP0) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp0}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp0}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP1A4

```{r rules_dist_da_popp1a4}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp1a4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP1A4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP1A4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP1A4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP1A4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP1A4), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_out_munic     = dplyr::if_else(!outlier_function(DA_POPP1A4), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_min_munic     = dplyr::if_else(DA_POPP1A4 >= (min(dplyr::lag(DA_POPP1A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_max_munic     = dplyr::if_else(DA_POPP1A4 <= (max(dplyr::lag(DA_POPP1A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_min_k_munic   = dplyr::if_else(DA_POPP1A4 >= (min(dplyr::lag(DA_POPP1A4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_max_k_munic   = dplyr::if_else(DA_POPP1A4 <= (k * max(dplyr::lag(DA_POPP1A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_med_mov_munic = dplyr::if_else(DA_POPP1A4 <= (k * zoo::rollmedian(DA_POPP1A4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP1A4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp1a4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp1a4 |> 
  dplyr::select(!DA_POPP1A4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp1a4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp1a4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP4

```{r rules_dist_da_popp4}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP4), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_out_munic     = dplyr::if_else(!outlier_function(DA_POPP4), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_min_munic     = dplyr::if_else(DA_POPP4 >= (min(dplyr::lag(DA_POPP4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_max_munic     = dplyr::if_else(DA_POPP4 <= (max(dplyr::lag(DA_POPP4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_min_k_munic   = dplyr::if_else(DA_POPP4 >= (min(dplyr::lag(DA_POPP4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_max_k_munic   = dplyr::if_else(DA_POPP4 <= (k * max(dplyr::lag(DA_POPP4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_med_mov_munic = dplyr::if_else(DA_POPP4 <= (k * zoo::rollmedian(DA_POPP4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp4 |> 
  dplyr::select(!DA_POPP4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP5

```{r rules_dist_da_popp5}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP5), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_out_munic     = dplyr::if_else(!outlier_function(DA_POPP5), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_min_munic     = dplyr::if_else(DA_POPP5 >= (min(dplyr::lag(DA_POPP5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_max_munic     = dplyr::if_else(DA_POPP5 <= (max(dplyr::lag(DA_POPP5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_min_k_munic   = dplyr::if_else(DA_POPP5 >= (min(dplyr::lag(DA_POPP5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_max_k_munic   = dplyr::if_else(DA_POPP5 <= (k * max(dplyr::lag(DA_POPP5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_med_mov_munic = dplyr::if_else(DA_POPP5 <= (k * zoo::rollmedian(DA_POPP5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp5 |> 
  dplyr::select(!DA_POPP5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP4E5

```{r rules_dist_da_popp4e5}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp4e5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP4E5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP4E5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP4E5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP4E5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_out_munic     = dplyr::if_else(!outlier_function(DA_POPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_min_munic     = dplyr::if_else(DA_POPP4E5 >= (min(dplyr::lag(DA_POPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_max_munic     = dplyr::if_else(DA_POPP4E5 <= (max(dplyr::lag(DA_POPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_min_k_munic   = dplyr::if_else(DA_POPP4E5 >= (min(dplyr::lag(DA_POPP4E5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_max_k_munic   = dplyr::if_else(DA_POPP4E5 <= (k * max(dplyr::lag(DA_POPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_med_mov_munic = dplyr::if_else(DA_POPP4E5 <= (k * zoo::rollmedian(DA_POPP4E5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP4E5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp4e5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp4e5 |> 
  dplyr::select(!DA_POPP4E5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp4e5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp4e5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP5A9

```{r rules_dist_da_popp5a9}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp5a9 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP5A9" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP5A9"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP5A9) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP5A9_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP5A9), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_out_munic     = dplyr::if_else(!outlier_function(DA_POPP5A9), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_min_munic     = dplyr::if_else(DA_POPP5A9 >= (min(dplyr::lag(DA_POPP5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_max_munic     = dplyr::if_else(DA_POPP5A9 <= (max(dplyr::lag(DA_POPP5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_min_k_munic   = dplyr::if_else(DA_POPP5A9 >= (min(dplyr::lag(DA_POPP5A9), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_max_k_munic   = dplyr::if_else(DA_POPP5A9 <= (k * max(dplyr::lag(DA_POPP5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_med_mov_munic = dplyr::if_else(DA_POPP5A9 <= (k * zoo::rollmedian(DA_POPP5A9, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP5A9), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp5a9}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp5a9 |> 
  dplyr::select(!DA_POPP5A9) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp5a9}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp5a9}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP6A14

```{r rules_dist_da_popp6a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp6a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP6A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP6A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP6A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP6A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP6A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_out_munic     = dplyr::if_else(!outlier_function(DA_POPP6A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_min_munic     = dplyr::if_else(DA_POPP6A14 >= (min(dplyr::lag(DA_POPP6A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_max_munic     = dplyr::if_else(DA_POPP6A14 <= (max(dplyr::lag(DA_POPP6A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_min_k_munic   = dplyr::if_else(DA_POPP6A14 >= (min(dplyr::lag(DA_POPP6A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_max_k_munic   = dplyr::if_else(DA_POPP6A14 <= (k * max(dplyr::lag(DA_POPP6A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_med_mov_munic = dplyr::if_else(DA_POPP6A14 <= (k * zoo::rollmedian(DA_POPP6A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP6A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp6a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp6a14 |> 
  dplyr::select(!DA_POPP6A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp6a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp6a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP10A14

```{r rules_dist_da_popp10a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp10a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP10A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP10A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP10A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP10A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP10A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_out_munic     = dplyr::if_else(!outlier_function(DA_POPP10A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_min_munic     = dplyr::if_else(DA_POPP10A14 >= (min(dplyr::lag(DA_POPP10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_max_munic     = dplyr::if_else(DA_POPP10A14 <= (max(dplyr::lag(DA_POPP10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_min_k_munic   = dplyr::if_else(DA_POPP10A14 >= (min(dplyr::lag(DA_POPP10A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_max_k_munic   = dplyr::if_else(DA_POPP10A14 <= (k * max(dplyr::lag(DA_POPP10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_med_mov_munic = dplyr::if_else(DA_POPP10A14 <= (k * zoo::rollmedian(DA_POPP10A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP10A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp10a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp10a14 |> 
  dplyr::select(!DA_POPP10A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp10a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp10a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP15

```{r rules_dist_da_popp15}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_min_munic     = dplyr::if_else(DA_POPP15 >= (min(dplyr::lag(DA_POPP15), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_max_munic     = dplyr::if_else(DA_POPP15 <= (max(dplyr::lag(DA_POPP15), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_min_k_munic   = dplyr::if_else(DA_POPP15 >= (min(dplyr::lag(DA_POPP15), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_max_k_munic   = dplyr::if_else(DA_POPP15 <= (k * max(dplyr::lag(DA_POPP15), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_med_mov_munic = dplyr::if_else(DA_POPP15 <= (k * zoo::rollmedian(DA_POPP15, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15 |> 
  dplyr::select(!DA_POPP15) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP15A17

```{r rules_dist_da_popp15a17}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15a17 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15A17" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15A17"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15A17) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15A17_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15A17), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15A17), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_min_munic     = dplyr::if_else(DA_POPP15A17 >= (min(dplyr::lag(DA_POPP15A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_max_munic     = dplyr::if_else(DA_POPP15A17 <= (max(dplyr::lag(DA_POPP15A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_min_k_munic   = dplyr::if_else(DA_POPP15A17 >= (min(dplyr::lag(DA_POPP15A17), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_max_k_munic   = dplyr::if_else(DA_POPP15A17 <= (k * max(dplyr::lag(DA_POPP15A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_med_mov_munic = dplyr::if_else(DA_POPP15A17 <= (k * zoo::rollmedian(DA_POPP15A17, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15A17), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15a17}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15a17 |> 
  dplyr::select(!DA_POPP15A17) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15a17}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15a17}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP15A19

```{r rules_dist_da_popp15a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_min_munic     = dplyr::if_else(DA_POPP15A19 >= (min(dplyr::lag(DA_POPP15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_max_munic     = dplyr::if_else(DA_POPP15A19 <= (max(dplyr::lag(DA_POPP15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_min_k_munic   = dplyr::if_else(DA_POPP15A19 >= (min(dplyr::lag(DA_POPP15A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_max_k_munic   = dplyr::if_else(DA_POPP15A19 <= (k * max(dplyr::lag(DA_POPP15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_med_mov_munic = dplyr::if_else(DA_POPP15A19 <= (k * zoo::rollmedian(DA_POPP15A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15a19 |> 
  dplyr::select(!DA_POPP15A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP15M

```{r rules_dist_da_popp15m}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15M), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15M), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_min_munic     = dplyr::if_else(DA_POPP15M >= (min(dplyr::lag(DA_POPP15M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_max_munic     = dplyr::if_else(DA_POPP15M <= (max(dplyr::lag(DA_POPP15M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_min_k_munic   = dplyr::if_else(DA_POPP15M >= (min(dplyr::lag(DA_POPP15M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_max_k_munic   = dplyr::if_else(DA_POPP15M <= (k * max(dplyr::lag(DA_POPP15M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_med_mov_munic = dplyr::if_else(DA_POPP15M <= (k * zoo::rollmedian(DA_POPP15M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15m |> 
  dplyr::select(!DA_POPP15M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP16A19

```{r rules_dist_da_popp16a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp16a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP16A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP16A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP16A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP16A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP16A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_out_munic     = dplyr::if_else(!outlier_function(DA_POPP16A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_min_munic     = dplyr::if_else(DA_POPP16A19 >= (min(dplyr::lag(DA_POPP16A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_max_munic     = dplyr::if_else(DA_POPP16A19 <= (max(dplyr::lag(DA_POPP16A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_min_k_munic   = dplyr::if_else(DA_POPP16A19 >= (min(dplyr::lag(DA_POPP16A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_max_k_munic   = dplyr::if_else(DA_POPP16A19 <= (k * max(dplyr::lag(DA_POPP16A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_med_mov_munic = dplyr::if_else(DA_POPP16A19 <= (k * zoo::rollmedian(DA_POPP16A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP16A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp16a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp16a19 |> 
  dplyr::select(!DA_POPP16A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp16a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp16a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP16A64

```{r rules_dist_da_popp16a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp16a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP16A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP16A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP16A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP16A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP16A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_out_munic     = dplyr::if_else(!outlier_function(DA_POPP16A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_min_munic     = dplyr::if_else(DA_POPP16A64 >= (min(dplyr::lag(DA_POPP16A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_max_munic     = dplyr::if_else(DA_POPP16A64 <= (max(dplyr::lag(DA_POPP16A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_min_k_munic   = dplyr::if_else(DA_POPP16A64 >= (min(dplyr::lag(DA_POPP16A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_max_k_munic   = dplyr::if_else(DA_POPP16A64 <= (k * max(dplyr::lag(DA_POPP16A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_med_mov_munic = dplyr::if_else(DA_POPP16A64 <= (k * zoo::rollmedian(DA_POPP16A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP16A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp16a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp16a64 |> 
  dplyr::select(!DA_POPP16A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp16a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp16a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP18M

```{r rules_dist_da_popp18m}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp18m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP18M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP18M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP18M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP18M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP18M), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_out_munic     = dplyr::if_else(!outlier_function(DA_POPP18M), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_min_munic     = dplyr::if_else(DA_POPP18M >= (min(dplyr::lag(DA_POPP18M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_max_munic     = dplyr::if_else(DA_POPP18M <= (max(dplyr::lag(DA_POPP18M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_min_k_munic   = dplyr::if_else(DA_POPP18M >= (min(dplyr::lag(DA_POPP18M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_max_k_munic   = dplyr::if_else(DA_POPP18M <= (k * max(dplyr::lag(DA_POPP18M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_med_mov_munic = dplyr::if_else(DA_POPP18M <= (k * zoo::rollmedian(DA_POPP18M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP18M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp18m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp18m |> 
  dplyr::select(!DA_POPP18M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp18m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp18m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP20A24

```{r rules_dist_da_popp20a24}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp20a24 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP20A24" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP20A24"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP20A24) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP20A24_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP20A24), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_out_munic     = dplyr::if_else(!outlier_function(DA_POPP20A24), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_min_munic     = dplyr::if_else(DA_POPP20A24 >= (min(dplyr::lag(DA_POPP20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_max_munic     = dplyr::if_else(DA_POPP20A24 <= (max(dplyr::lag(DA_POPP20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_min_k_munic   = dplyr::if_else(DA_POPP20A24 >= (min(dplyr::lag(DA_POPP20A24), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_max_k_munic   = dplyr::if_else(DA_POPP20A24 <= (k * max(dplyr::lag(DA_POPP20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_med_mov_munic = dplyr::if_else(DA_POPP20A24 <= (k * zoo::rollmedian(DA_POPP20A24, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP20A24), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp20a24}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp20a24 |> 
  dplyr::select(!DA_POPP20A24) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp20a24}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp20a24}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP25A29

```{r rules_dist_da_popp25a29}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp25a29 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP25A29" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP25A29"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP25A29) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP25A29_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP25A29), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_out_munic     = dplyr::if_else(!outlier_function(DA_POPP25A29), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_min_munic     = dplyr::if_else(DA_POPP25A29 >= (min(dplyr::lag(DA_POPP25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_max_munic     = dplyr::if_else(DA_POPP25A29 <= (max(dplyr::lag(DA_POPP25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_min_k_munic   = dplyr::if_else(DA_POPP25A29 >= (min(dplyr::lag(DA_POPP25A29), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_max_k_munic   = dplyr::if_else(DA_POPP25A29 <= (k * max(dplyr::lag(DA_POPP25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_med_mov_munic = dplyr::if_else(DA_POPP25A29 <= (k * zoo::rollmedian(DA_POPP25A29, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP25A29), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp25a29}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp25a29 |> 
  dplyr::select(!DA_POPP25A29) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp25a29}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp25a29}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP30A34

```{r rules_dist_da_popp30a34}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp30a34 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP30A34" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP30A34"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP30A34) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP30A34_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP30A34), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_out_munic     = dplyr::if_else(!outlier_function(DA_POPP30A34), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_min_munic     = dplyr::if_else(DA_POPP30A34 >= (min(dplyr::lag(DA_POPP30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_max_munic     = dplyr::if_else(DA_POPP30A34 <= (max(dplyr::lag(DA_POPP30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_min_k_munic   = dplyr::if_else(DA_POPP30A34 >= (min(dplyr::lag(DA_POPP30A34), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_max_k_munic   = dplyr::if_else(DA_POPP30A34 <= (k * max(dplyr::lag(DA_POPP30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_med_mov_munic = dplyr::if_else(DA_POPP30A34 <= (k * zoo::rollmedian(DA_POPP30A34, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP30A34), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp30a34}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp30a34 |> 
  dplyr::select(!DA_POPP30A34) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp30a34}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp30a34}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP35A39

```{r rules_dist_da_popp35a39}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp35a39 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP35A39" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP35A39"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP35A39) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP35A39_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP35A39), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_out_munic     = dplyr::if_else(!outlier_function(DA_POPP35A39), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_min_munic     = dplyr::if_else(DA_POPP35A39 >= (min(dplyr::lag(DA_POPP35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_max_munic     = dplyr::if_else(DA_POPP35A39 <= (max(dplyr::lag(DA_POPP35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_min_k_munic   = dplyr::if_else(DA_POPP35A39 >= (min(dplyr::lag(DA_POPP35A39), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_max_k_munic   = dplyr::if_else(DA_POPP35A39 <= (k * max(dplyr::lag(DA_POPP35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_med_mov_munic = dplyr::if_else(DA_POPP35A39 <= (k * zoo::rollmedian(DA_POPP35A39, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP35A39), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp35a39}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp35a39 |> 
  dplyr::select(!DA_POPP35A39) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp35a39}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp35a39}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP40A44

```{r rules_dist_da_popp40a44}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp40a44 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP40A44" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP40A44"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP40A44) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP40A44_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP40A44), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_out_munic     = dplyr::if_else(!outlier_function(DA_POPP40A44), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_min_munic     = dplyr::if_else(DA_POPP40A44 >= (min(dplyr::lag(DA_POPP40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_max_munic     = dplyr::if_else(DA_POPP40A44 <= (max(dplyr::lag(DA_POPP40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_min_k_munic   = dplyr::if_else(DA_POPP40A44 >= (min(dplyr::lag(DA_POPP40A44), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_max_k_munic   = dplyr::if_else(DA_POPP40A44 <= (k * max(dplyr::lag(DA_POPP40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_med_mov_munic = dplyr::if_else(DA_POPP40A44 <= (k * zoo::rollmedian(DA_POPP40A44, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP40A44), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp40a44}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp40a44 |> 
  dplyr::select(!DA_POPP40A44) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp40a44}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp40a44}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP45A49

```{r rules_dist_da_popp45a49}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp45a49 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP45A49" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP45A49"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP45A49) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP45A49_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP45A49), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_out_munic     = dplyr::if_else(!outlier_function(DA_POPP45A49), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_min_munic     = dplyr::if_else(DA_POPP45A49 >= (min(dplyr::lag(DA_POPP45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_max_munic     = dplyr::if_else(DA_POPP45A49 <= (max(dplyr::lag(DA_POPP45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_min_k_munic   = dplyr::if_else(DA_POPP45A49 >= (min(dplyr::lag(DA_POPP45A49), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_max_k_munic   = dplyr::if_else(DA_POPP45A49 <= (k * max(dplyr::lag(DA_POPP45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_med_mov_munic = dplyr::if_else(DA_POPP45A49 <= (k * zoo::rollmedian(DA_POPP45A49, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP45A49), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp45a49}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp45a49 |> 
  dplyr::select(!DA_POPP45A49) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp45a49}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp45a49}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP50A54

```{r rules_dist_da_popp50a54}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp50a54 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP50A54" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP50A54"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP50A54) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP50A54_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP50A54), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_out_munic     = dplyr::if_else(!outlier_function(DA_POPP50A54), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_min_munic     = dplyr::if_else(DA_POPP50A54 >= (min(dplyr::lag(DA_POPP50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_max_munic     = dplyr::if_else(DA_POPP50A54 <= (max(dplyr::lag(DA_POPP50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_min_k_munic   = dplyr::if_else(DA_POPP50A54 >= (min(dplyr::lag(DA_POPP50A54), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_max_k_munic   = dplyr::if_else(DA_POPP50A54 <= (k * max(dplyr::lag(DA_POPP50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_med_mov_munic = dplyr::if_else(DA_POPP50A54 <= (k * zoo::rollmedian(DA_POPP50A54, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP50A54), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp50a54}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp50a54 |> 
  dplyr::select(!DA_POPP50A54) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp50a54}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp50a54}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP55A59

```{r rules_dist_da_popp55a59}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp55a59 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP55A59" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP55A59"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP55A59) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP55A59_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP55A59), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_out_munic     = dplyr::if_else(!outlier_function(DA_POPP55A59), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_min_munic     = dplyr::if_else(DA_POPP55A59 >= (min(dplyr::lag(DA_POPP55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_max_munic     = dplyr::if_else(DA_POPP55A59 <= (max(dplyr::lag(DA_POPP55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_min_k_munic   = dplyr::if_else(DA_POPP55A59 >= (min(dplyr::lag(DA_POPP55A59), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_max_k_munic   = dplyr::if_else(DA_POPP55A59 <= (k * max(dplyr::lag(DA_POPP55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_med_mov_munic = dplyr::if_else(DA_POPP55A59 <= (k * zoo::rollmedian(DA_POPP55A59, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP55A59), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp55a59}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp55a59 |> 
  dplyr::select(!DA_POPP55A59) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp55a59}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp55a59}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP60A64

```{r rules_dist_da_popp60a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp60a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP60A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP60A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP60A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP60A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP60A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_out_munic     = dplyr::if_else(!outlier_function(DA_POPP60A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_min_munic     = dplyr::if_else(DA_POPP60A64 >= (min(dplyr::lag(DA_POPP60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_max_munic     = dplyr::if_else(DA_POPP60A64 <= (max(dplyr::lag(DA_POPP60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_min_k_munic   = dplyr::if_else(DA_POPP60A64 >= (min(dplyr::lag(DA_POPP60A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_max_k_munic   = dplyr::if_else(DA_POPP60A64 <= (k * max(dplyr::lag(DA_POPP60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_med_mov_munic = dplyr::if_else(DA_POPP60A64 <= (k * zoo::rollmedian(DA_POPP60A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP60A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp60a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp60a64 |> 
  dplyr::select(!DA_POPP60A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp60a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp60a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP65A69

```{r rules_dist_da_popp65a69}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp65a69 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP65A69" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP65A69"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP65A69) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP65A69_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP65A69), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_out_munic     = dplyr::if_else(!outlier_function(DA_POPP65A69), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_min_munic     = dplyr::if_else(DA_POPP65A69 >= (min(dplyr::lag(DA_POPP65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_max_munic     = dplyr::if_else(DA_POPP65A69 <= (max(dplyr::lag(DA_POPP65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_min_k_munic   = dplyr::if_else(DA_POPP65A69 >= (min(dplyr::lag(DA_POPP65A69), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_max_k_munic   = dplyr::if_else(DA_POPP65A69 <= (k * max(dplyr::lag(DA_POPP65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_med_mov_munic = dplyr::if_else(DA_POPP65A69 <= (k * zoo::rollmedian(DA_POPP65A69, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP65A69), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp65a69}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp65a69 |> 
  dplyr::select(!DA_POPP65A69) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp65a69}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp65a69}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP70A74

```{r rules_dist_da_popp70a74}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp70a74 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP70A74" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP70A74"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP70A74) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP70A74_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP70A74), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_out_munic     = dplyr::if_else(!outlier_function(DA_POPP70A74), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_min_munic     = dplyr::if_else(DA_POPP70A74 >= (min(dplyr::lag(DA_POPP70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_max_munic     = dplyr::if_else(DA_POPP70A74 <= (max(dplyr::lag(DA_POPP70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_min_k_munic   = dplyr::if_else(DA_POPP70A74 >= (min(dplyr::lag(DA_POPP70A74), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_max_k_munic   = dplyr::if_else(DA_POPP70A74 <= (k * max(dplyr::lag(DA_POPP70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_med_mov_munic = dplyr::if_else(DA_POPP70A74 <= (k * zoo::rollmedian(DA_POPP70A74, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP70A74), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp70a74}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp70a74 |> 
  dplyr::select(!DA_POPP70A74) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp70a74}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp70a74}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP75A79

```{r rules_dist_da_popp75a79}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp75a79 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP75A79" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP75A79"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP75A79) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP75A79_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP75A79), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_out_munic     = dplyr::if_else(!outlier_function(DA_POPP75A79), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_min_munic     = dplyr::if_else(DA_POPP75A79 >= (min(dplyr::lag(DA_POPP75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_max_munic     = dplyr::if_else(DA_POPP75A79 <= (max(dplyr::lag(DA_POPP75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_min_k_munic   = dplyr::if_else(DA_POPP75A79 >= (min(dplyr::lag(DA_POPP75A79), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_max_k_munic   = dplyr::if_else(DA_POPP75A79 <= (k * max(dplyr::lag(DA_POPP75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_med_mov_munic = dplyr::if_else(DA_POPP75A79 <= (k * zoo::rollmedian(DA_POPP75A79, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP75A79), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp75a79}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp75a79 |> 
  dplyr::select(!DA_POPP75A79) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp75a79}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp75a79}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_POPP80M

```{r rules_dist_da_popp80m}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp80m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP80M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP80M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP80M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP80M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP80M), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_out_munic     = dplyr::if_else(!outlier_function(DA_POPP80M), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_min_munic     = dplyr::if_else(DA_POPP80M >= (min(dplyr::lag(DA_POPP80M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_max_munic     = dplyr::if_else(DA_POPP80M <= (max(dplyr::lag(DA_POPP80M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_min_k_munic   = dplyr::if_else(DA_POPP80M >= (min(dplyr::lag(DA_POPP80M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_max_k_munic   = dplyr::if_else(DA_POPP80M <= (k * max(dplyr::lag(DA_POPP80M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_med_mov_munic = dplyr::if_else(DA_POPP80M <= (k * zoo::rollmedian(DA_POPP80M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP80M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp80m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp80m |> 
  dplyr::select(!DA_POPP80M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp80m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp80m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_DENSP

```{r rules_dist_da_densp}

## df com o resultado das aplicações das regras
df_rules_dist_da_densp <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_DENSP" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_DENSP"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_DENSP) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_DENSP_hampel_munic  = dplyr::if_else(!hampel_filter(DA_DENSP), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_out_munic     = dplyr::if_else(!outlier_function(DA_DENSP), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_min_munic     = dplyr::if_else(DA_DENSP >= (min(dplyr::lag(DA_DENSP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_max_munic     = dplyr::if_else(DA_DENSP <= (max(dplyr::lag(DA_DENSP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_min_k_munic   = dplyr::if_else(DA_DENSP >= (min(dplyr::lag(DA_DENSP), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_max_k_munic   = dplyr::if_else(DA_DENSP <= (k * max(dplyr::lag(DA_DENSP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_med_mov_munic = dplyr::if_else(DA_DENSP <= (k * zoo::rollmedian(DA_DENSP, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_dif_munic     = dplyr::if_else(!compare_first_dif(DA_DENSP), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_densp}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_densp |> 
  dplyr::select(!DA_DENSP) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_densp}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_densp}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_PROPP4E5

```{r rules_dist_da_propp4e5}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp4e5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP4E5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP4E5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP4E5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP4E5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_min_munic     = dplyr::if_else(DA_PROPP4E5 >= (min(dplyr::lag(DA_PROPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_max_munic     = dplyr::if_else(DA_PROPP4E5 <= (max(dplyr::lag(DA_PROPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_min_k_munic   = dplyr::if_else(DA_PROPP4E5 >= (min(dplyr::lag(DA_PROPP4E5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_max_k_munic   = dplyr::if_else(DA_PROPP4E5 <= (k * max(dplyr::lag(DA_PROPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_med_mov_munic = dplyr::if_else(DA_PROPP4E5 <= (k * zoo::rollmedian(DA_PROPP4E5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP4E5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp4e5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp4e5 |> 
  dplyr::select(!DA_PROPP4E5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp4e5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp4e5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_PROPP0A5

```{r rules_dist_da_propp0a5}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp0a5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP0A5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP0A5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP0A5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP0A5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP0A5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP0A5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_min_munic     = dplyr::if_else(DA_PROPP0A5 >= (min(dplyr::lag(DA_PROPP0A5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_max_munic     = dplyr::if_else(DA_PROPP0A5 <= (max(dplyr::lag(DA_PROPP0A5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_min_k_munic   = dplyr::if_else(DA_PROPP0A5 >= (min(dplyr::lag(DA_PROPP0A5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_max_k_munic   = dplyr::if_else(DA_PROPP0A5 <= (k * max(dplyr::lag(DA_PROPP0A5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_med_mov_munic = dplyr::if_else(DA_PROPP0A5 <= (k * zoo::rollmedian(DA_PROPP0A5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP0A5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp0a5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp0a5 |> 
  dplyr::select(!DA_PROPP0A5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp0a5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp0a5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_PROPP6A17

```{r rules_dist_da_propp6a17}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp6a17 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP6A17" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP6A17"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP6A17) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP6A17_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP6A17), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP6A17), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_min_munic     = dplyr::if_else(DA_PROPP6A17 >= (min(dplyr::lag(DA_PROPP6A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_max_munic     = dplyr::if_else(DA_PROPP6A17 <= (max(dplyr::lag(DA_PROPP6A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_min_k_munic   = dplyr::if_else(DA_PROPP6A17 >= (min(dplyr::lag(DA_PROPP6A17), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_max_k_munic   = dplyr::if_else(DA_PROPP6A17 <= (k * max(dplyr::lag(DA_PROPP6A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_med_mov_munic = dplyr::if_else(DA_PROPP6A17 <= (k * zoo::rollmedian(DA_PROPP6A17, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP6A17), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp6a17}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp6a17 |> 
  dplyr::select(!DA_PROPP6A17) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp6a17}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp6a17}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_RDEPP

```{r rules_dist_da_rdepp}

## df com o resultado das aplicações das regras
df_rules_dist_da_rdepp <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_RDEPP" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_RDEPP"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_RDEPP) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_RDEPP_hampel_munic  = dplyr::if_else(!hampel_filter(DA_RDEPP), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_out_munic     = dplyr::if_else(!outlier_function(DA_RDEPP), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_min_munic     = dplyr::if_else(DA_RDEPP >= (min(dplyr::lag(DA_RDEPP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_max_munic     = dplyr::if_else(DA_RDEPP <= (max(dplyr::lag(DA_RDEPP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_min_k_munic   = dplyr::if_else(DA_RDEPP >= (min(dplyr::lag(DA_RDEPP), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_max_k_munic   = dplyr::if_else(DA_RDEPP <= (k * max(dplyr::lag(DA_RDEPP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_med_mov_munic = dplyr::if_else(DA_RDEPP <= (k * zoo::rollmedian(DA_RDEPP, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_dif_munic     = dplyr::if_else(!compare_first_dif(DA_RDEPP), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_rdepp}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_rdepp |> 
  dplyr::select(!DA_RDEPP) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_rdepp}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_rdepp}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_PROPP15N

```{r rules_dist_da_propp15n}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp15n <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP15N" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP15N"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP15N) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP15N_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP15N), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP15N), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_min_munic     = dplyr::if_else(DA_PROPP15N >= (min(dplyr::lag(DA_PROPP15N), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_max_munic     = dplyr::if_else(DA_PROPP15N <= (max(dplyr::lag(DA_PROPP15N), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_min_k_munic   = dplyr::if_else(DA_PROPP15N >= (min(dplyr::lag(DA_PROPP15N), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_max_k_munic   = dplyr::if_else(DA_PROPP15N <= (k * max(dplyr::lag(DA_PROPP15N), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_med_mov_munic = dplyr::if_else(DA_PROPP15N <= (k * zoo::rollmedian(DA_PROPP15N, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP15N), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp15n}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp15n |> 
  dplyr::select(!DA_PROPP15N) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp15n}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp15n}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_PROPP65M

```{r rules_dist_da_propp65m}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp65m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP65M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP65M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP65M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP65M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP65M), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP65M), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_min_munic     = dplyr::if_else(DA_PROPP65M >= (min(dplyr::lag(DA_PROPP65M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_max_munic     = dplyr::if_else(DA_PROPP65M <= (max(dplyr::lag(DA_PROPP65M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_min_k_munic   = dplyr::if_else(DA_PROPP65M >= (min(dplyr::lag(DA_PROPP65M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_max_k_munic   = dplyr::if_else(DA_PROPP65M <= (k * max(dplyr::lag(DA_PROPP65M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_med_mov_munic = dplyr::if_else(DA_PROPP65M <= (k * zoo::rollmedian(DA_PROPP65M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP65M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp65m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp65m |> 
  dplyr::select(!DA_PROPP65M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp65m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp65m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_INDENVE

```{r rules_dist_da_indenve}

## df com o resultado das aplicações das regras
df_rules_dist_da_indenve <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_INDENVE" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_INDENVE"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_INDENVE) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_INDENVE_hampel_munic  = dplyr::if_else(!hampel_filter(DA_INDENVE), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_out_munic     = dplyr::if_else(!outlier_function(DA_INDENVE), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_min_munic     = dplyr::if_else(DA_INDENVE >= (min(dplyr::lag(DA_INDENVE), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_max_munic     = dplyr::if_else(DA_INDENVE <= (max(dplyr::lag(DA_INDENVE), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_min_k_munic   = dplyr::if_else(DA_INDENVE >= (min(dplyr::lag(DA_INDENVE), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_max_k_munic   = dplyr::if_else(DA_INDENVE <= (k * max(dplyr::lag(DA_INDENVE), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_med_mov_munic = dplyr::if_else(DA_INDENVE <= (k * zoo::rollmedian(DA_INDENVE, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_dif_munic     = dplyr::if_else(!compare_first_dif(DA_INDENVE), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_indenve}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_indenve |> 
  dplyr::select(!DA_INDENVE) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_indenve}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_indenve}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM0A4

```{r rules_dist_da_homem0a4}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem0a4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM0A4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM0A4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM0A4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM0A4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM0A4), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM0A4), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_min_munic     = dplyr::if_else(DA_HOMEM0A4 >= (min(dplyr::lag(DA_HOMEM0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_max_munic     = dplyr::if_else(DA_HOMEM0A4 <= (max(dplyr::lag(DA_HOMEM0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_min_k_munic   = dplyr::if_else(DA_HOMEM0A4 >= (min(dplyr::lag(DA_HOMEM0A4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_max_k_munic   = dplyr::if_else(DA_HOMEM0A4 <= (k * max(dplyr::lag(DA_HOMEM0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_med_mov_munic = dplyr::if_else(DA_HOMEM0A4 <= (k * zoo::rollmedian(DA_HOMEM0A4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM0A4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem0a4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem0a4 |> 
  dplyr::select(!DA_HOMEM0A4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem0a4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem0a4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM5A9

```{r rules_dist_da_homem5a9}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem5a9 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM5A9" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM5A9"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM5A9) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM5A9_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM5A9), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM5A9), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_min_munic     = dplyr::if_else(DA_HOMEM5A9 >= (min(dplyr::lag(DA_HOMEM5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_max_munic     = dplyr::if_else(DA_HOMEM5A9 <= (max(dplyr::lag(DA_HOMEM5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_min_k_munic   = dplyr::if_else(DA_HOMEM5A9 >= (min(dplyr::lag(DA_HOMEM5A9), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_max_k_munic   = dplyr::if_else(DA_HOMEM5A9 <= (k * max(dplyr::lag(DA_HOMEM5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_med_mov_munic = dplyr::if_else(DA_HOMEM5A9 <= (k * zoo::rollmedian(DA_HOMEM5A9, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM5A9), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem5a9}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem5a9 |> 
  dplyr::select(!DA_HOMEM5A9) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem5a9}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem5a9}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM10A14

```{r rules_dist_da_homem10a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem10a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM10A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM10A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM10A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM10A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM10A14), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM10A14), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_min_munic     = dplyr::if_else(DA_HOMEM10A14 >= (min(dplyr::lag(DA_HOMEM10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_max_munic     = dplyr::if_else(DA_HOMEM10A14 <= (max(dplyr::lag(DA_HOMEM10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_min_k_munic   = dplyr::if_else(DA_HOMEM10A14 >= (min(dplyr::lag(DA_HOMEM10A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_max_k_munic   = dplyr::if_else(DA_HOMEM10A14 <= (k * max(dplyr::lag(DA_HOMEM10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_med_mov_munic = dplyr::if_else(DA_HOMEM10A14 <= (k * zoo::rollmedian(DA_HOMEM10A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM10A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem10a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem10a14 |> 
  dplyr::select(!DA_HOMEM10A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem10a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem10a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM15A19

```{r rules_dist_da_homem15a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem15a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM15A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM15A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM15A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM15A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM15A19), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM15A19), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_min_munic     = dplyr::if_else(DA_HOMEM15A19 >= (min(dplyr::lag(DA_HOMEM15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_max_munic     = dplyr::if_else(DA_HOMEM15A19 <= (max(dplyr::lag(DA_HOMEM15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_min_k_munic   = dplyr::if_else(DA_HOMEM15A19 >= (min(dplyr::lag(DA_HOMEM15A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_max_k_munic   = dplyr::if_else(DA_HOMEM15A19 <= (k * max(dplyr::lag(DA_HOMEM15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_med_mov_munic = dplyr::if_else(DA_HOMEM15A19 <= (k * zoo::rollmedian(DA_HOMEM15A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM15A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem15a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem15a19 |> 
  dplyr::select(!DA_HOMEM15A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem15a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem15a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM20A24

```{r rules_dist_da_homem20a24}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem20a24 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM20A24" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM20A24"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM20A24) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM20A24_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM20A24), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM20A24), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_min_munic     = dplyr::if_else(DA_HOMEM20A24 >= (min(dplyr::lag(DA_HOMEM20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_max_munic     = dplyr::if_else(DA_HOMEM20A24 <= (max(dplyr::lag(DA_HOMEM20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_min_k_munic   = dplyr::if_else(DA_HOMEM20A24 >= (min(dplyr::lag(DA_HOMEM20A24), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_max_k_munic   = dplyr::if_else(DA_HOMEM20A24 <= (k * max(dplyr::lag(DA_HOMEM20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_med_mov_munic = dplyr::if_else(DA_HOMEM20A24 <= (k * zoo::rollmedian(DA_HOMEM20A24, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM20A24), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem20a24}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem20a24 |> 
  dplyr::select(!DA_HOMEM20A24) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem20a24}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem20a24}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM25A29

```{r rules_dist_da_homem25a29}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem25a29 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM25A29" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM25A29"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM25A29) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM25A29_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM25A29), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM25A29), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_min_munic     = dplyr::if_else(DA_HOMEM25A29 >= (min(dplyr::lag(DA_HOMEM25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_max_munic     = dplyr::if_else(DA_HOMEM25A29 <= (max(dplyr::lag(DA_HOMEM25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_min_k_munic   = dplyr::if_else(DA_HOMEM25A29 >= (min(dplyr::lag(DA_HOMEM25A29), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_max_k_munic   = dplyr::if_else(DA_HOMEM25A29 <= (k * max(dplyr::lag(DA_HOMEM25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_med_mov_munic = dplyr::if_else(DA_HOMEM25A29 <= (k * zoo::rollmedian(DA_HOMEM25A29, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM25A29), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem25a29}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem25a29 |> 
  dplyr::select(!DA_HOMEM25A29) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem25a29}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem25a29}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM30A34

```{r rules_dist_da_homem30a34}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem30a34 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM30A34" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM30A34"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM30A34) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM30A34_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM30A34), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM30A34), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_min_munic     = dplyr::if_else(DA_HOMEM30A34 >= (min(dplyr::lag(DA_HOMEM30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_max_munic     = dplyr::if_else(DA_HOMEM30A34 <= (max(dplyr::lag(DA_HOMEM30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_min_k_munic   = dplyr::if_else(DA_HOMEM30A34 >= (min(dplyr::lag(DA_HOMEM30A34), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_max_k_munic   = dplyr::if_else(DA_HOMEM30A34 <= (k * max(dplyr::lag(DA_HOMEM30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_med_mov_munic = dplyr::if_else(DA_HOMEM30A34 <= (k * zoo::rollmedian(DA_HOMEM30A34, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM30A34), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem30a34}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem30a34 |> 
  dplyr::select(!DA_HOMEM30A34) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem30a34}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem30a34}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM35A39

```{r rules_dist_da_homem35a39}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem35a39 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM35A39" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM35A39"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM35A39) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM35A39_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM35A39), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM35A39), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_min_munic     = dplyr::if_else(DA_HOMEM35A39 >= (min(dplyr::lag(DA_HOMEM35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_max_munic     = dplyr::if_else(DA_HOMEM35A39 <= (max(dplyr::lag(DA_HOMEM35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_min_k_munic   = dplyr::if_else(DA_HOMEM35A39 >= (min(dplyr::lag(DA_HOMEM35A39), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_max_k_munic   = dplyr::if_else(DA_HOMEM35A39 <= (k * max(dplyr::lag(DA_HOMEM35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_med_mov_munic = dplyr::if_else(DA_HOMEM35A39 <= (k * zoo::rollmedian(DA_HOMEM35A39, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM35A39), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem35a39}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem35a39 |> 
  dplyr::select(!DA_HOMEM35A39) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem35a39}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem35a39}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM40A44

```{r rules_dist_da_homem40a44}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem40a44 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM40A44" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM40A44"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM40A44) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM40A44_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM40A44), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM40A44), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_min_munic     = dplyr::if_else(DA_HOMEM40A44 >= (min(dplyr::lag(DA_HOMEM40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_max_munic     = dplyr::if_else(DA_HOMEM40A44 <= (max(dplyr::lag(DA_HOMEM40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_min_k_munic   = dplyr::if_else(DA_HOMEM40A44 >= (min(dplyr::lag(DA_HOMEM40A44), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_max_k_munic   = dplyr::if_else(DA_HOMEM40A44 <= (k * max(dplyr::lag(DA_HOMEM40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_med_mov_munic = dplyr::if_else(DA_HOMEM40A44 <= (k * zoo::rollmedian(DA_HOMEM40A44, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM40A44), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem40a44}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem40a44 |> 
  dplyr::select(!DA_HOMEM40A44) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem40a44}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem40a44}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM45A49

```{r rules_dist_da_homem45a49}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem45a49 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM45A49" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM45A49"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM45A49) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM45A49_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM45A49), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM45A49), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_min_munic     = dplyr::if_else(DA_HOMEM45A49 >= (min(dplyr::lag(DA_HOMEM45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_max_munic     = dplyr::if_else(DA_HOMEM45A49 <= (max(dplyr::lag(DA_HOMEM45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_min_k_munic   = dplyr::if_else(DA_HOMEM45A49 >= (min(dplyr::lag(DA_HOMEM45A49), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_max_k_munic   = dplyr::if_else(DA_HOMEM45A49 <= (k * max(dplyr::lag(DA_HOMEM45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_med_mov_munic = dplyr::if_else(DA_HOMEM45A49 <= (k * zoo::rollmedian(DA_HOMEM45A49, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM45A49), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem45a49}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem45a49 |> 
  dplyr::select(!DA_HOMEM45A49) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem45a49}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem45a49}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM50A54

```{r rules_dist_da_homem50a54}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem50a54 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM50A54" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM50A54"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM50A54) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM50A54_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM50A54), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM50A54), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_min_munic     = dplyr::if_else(DA_HOMEM50A54  >= (min(dplyr::lag(DA_HOMEM50A54 ), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_max_munic     = dplyr::if_else(DA_HOMEM50A54  <= (max(dplyr::lag(DA_HOMEM50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_min_k_munic   = dplyr::if_else(DA_HOMEM50A54  >= (min(dplyr::lag(DA_HOMEM50A54), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_max_k_munic   = dplyr::if_else(DA_HOMEM50A54  <= (k * max(dplyr::lag(DA_HOMEM50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_med_mov_munic = dplyr::if_else(DA_HOMEM50A54  <= (k * zoo::rollmedian(DA_HOMEM50A54 , k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM50A54), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem50a54}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem50a54 |> 
  dplyr::select(!DA_HOMEM50A54 ) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem50a54}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem50a54}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM55A59

```{r rules_dist_da_homem55a59}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem55a59 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM55A59" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM55A59"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM55A59) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM55A59_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM55A59), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM55A59), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_min_munic     = dplyr::if_else(DA_HOMEM55A59 >= (min(dplyr::lag(DA_HOMEM55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_max_munic     = dplyr::if_else(DA_HOMEM55A59 <= (max(dplyr::lag(DA_HOMEM55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_min_k_munic   = dplyr::if_else(DA_HOMEM55A59 >= (min(dplyr::lag(DA_HOMEM55A59), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_max_k_munic   = dplyr::if_else(DA_HOMEM55A59 <= (k * max(dplyr::lag(DA_HOMEM55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_med_mov_munic = dplyr::if_else(DA_HOMEM55A59 <= (k * zoo::rollmedian(DA_HOMEM55A59, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM55A59), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem55a59}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem55a59 |> 
  dplyr::select(!DA_HOMEM55A59) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem55a59}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem55a59}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM60A64

```{r rules_dist_da_homem60a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem60a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM60A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM60A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM60A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM60A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM60A64), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM60A64), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_min_munic     = dplyr::if_else(DA_HOMEM60A64 >= (min(dplyr::lag(DA_HOMEM60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_max_munic     = dplyr::if_else(DA_HOMEM60A64 <= (max(dplyr::lag(DA_HOMEM60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_min_k_munic   = dplyr::if_else(DA_HOMEM60A64 >= (min(dplyr::lag(DA_HOMEM60A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_max_k_munic   = dplyr::if_else(DA_HOMEM60A64 <= (k * max(dplyr::lag(DA_HOMEM60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_med_mov_munic = dplyr::if_else(DA_HOMEM60A64 <= (k * zoo::rollmedian(DA_HOMEM60A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM60A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem60a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem60a64 |> 
  dplyr::select(!DA_HOMEM60A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem60a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem60a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM65A69

```{r rules_dist_da_homem65a69}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem65a69 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM65A69" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM65A69"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM65A69) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM65A69_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM65A69), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM65A69), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_min_munic     = dplyr::if_else(DA_HOMEM65A69 >= (min(dplyr::lag(DA_HOMEM65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_max_munic     = dplyr::if_else(DA_HOMEM65A69 <= (max(dplyr::lag(DA_HOMEM65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_min_k_munic   = dplyr::if_else(DA_HOMEM65A69 >= (min(dplyr::lag(DA_HOMEM65A69), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_max_k_munic   = dplyr::if_else(DA_HOMEM65A69 <= (k * max(dplyr::lag(DA_HOMEM65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_med_mov_munic = dplyr::if_else(DA_HOMEM65A69 <= (k * zoo::rollmedian(DA_HOMEM65A69, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM65A69), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem65a69}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem65a69 |> 
  dplyr::select(!DA_HOMEM65A69) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem65a69}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem65a69}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM70A74

```{r rules_dist_da_homem70a74}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem70a74 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM70A74" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM70A74"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM70A74) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM70A74_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM70A74), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM70A74), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_min_munic     = dplyr::if_else(DA_HOMEM70A74 >= (min(dplyr::lag(DA_HOMEM70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_max_munic     = dplyr::if_else(DA_HOMEM70A74 <= (max(dplyr::lag(DA_HOMEM70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_min_k_munic   = dplyr::if_else(DA_HOMEM70A74 >= (min(dplyr::lag(DA_HOMEM70A74), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_max_k_munic   = dplyr::if_else(DA_HOMEM70A74 <= (k * max(dplyr::lag(DA_HOMEM70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_med_mov_munic = dplyr::if_else(DA_HOMEM70A74 <= (k * zoo::rollmedian(DA_HOMEM70A74, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM70A74), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem70a74}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem70a74 |> 
  dplyr::select(!DA_HOMEM70A74) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem70a74}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem70a74}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM75A79

```{r rules_dist_da_homem75a79}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem75a79 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM75A79" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM75A79"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM75A79) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM75A79_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM75A79), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM75A79), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_min_munic     = dplyr::if_else(DA_HOMEM75A79 >= (min(dplyr::lag(DA_HOMEM75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_max_munic     = dplyr::if_else(DA_HOMEM75A79 <= (max(dplyr::lag(DA_HOMEM75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_min_k_munic   = dplyr::if_else(DA_HOMEM75A79 >= (min(dplyr::lag(DA_HOMEM75A79), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_max_k_munic   = dplyr::if_else(DA_HOMEM75A79 <= (k * max(dplyr::lag(DA_HOMEM75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_med_mov_munic = dplyr::if_else(DA_HOMEM75A79 <= (k * zoo::rollmedian(DA_HOMEM75A79, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM75A79), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem75a79}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem75a79 |> 
  dplyr::select(!DA_HOMEM75A79) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem75a79}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem75a79}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEM80

```{r rules_dist_da_homem80}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem80 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM80" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM80"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM80) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM80_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM80), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM80), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_min_munic     = dplyr::if_else(DA_HOMEM80 >= (min(dplyr::lag(DA_HOMEM80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_max_munic     = dplyr::if_else(DA_HOMEM80 <= (max(dplyr::lag(DA_HOMEM80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_min_k_munic   = dplyr::if_else(DA_HOMEM80 >= (min(dplyr::lag(DA_HOMEM80), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_max_k_munic   = dplyr::if_else(DA_HOMEM80 <= (k * max(dplyr::lag(DA_HOMEM80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_med_mov_munic = dplyr::if_else(DA_HOMEM80 <= (k * zoo::rollmedian(DA_HOMEM80, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM80), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem80}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem80 |> 
  dplyr::select(!DA_HOMEM80) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem80}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem80}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH0A4

```{r rules_dist_da_mulh0a4}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh0a4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH0A4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH0A4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH0A4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH0A4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH0A4), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_out_munic     = dplyr::if_else(!outlier_function(DA_MULH0A4), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_min_munic     = dplyr::if_else(DA_MULH0A4 >= (min(dplyr::lag(DA_MULH0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_max_munic     = dplyr::if_else(DA_MULH0A4 <= (max(dplyr::lag(DA_MULH0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_min_k_munic   = dplyr::if_else(DA_MULH0A4 >= (min(dplyr::lag(DA_MULH0A4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_max_k_munic   = dplyr::if_else(DA_MULH0A4 <= (k * max(dplyr::lag(DA_MULH0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_med_mov_munic = dplyr::if_else(DA_MULH0A4 <= (k * zoo::rollmedian(DA_MULH0A4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH0A4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh0a4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh0a4 |> 
  dplyr::select(!DA_MULH0A4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh0a4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh0a4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH5A9

```{r rules_dist_da_mulh5a9}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh5a9 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH5A9" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH5A9"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH5A9) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH5A9_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH5A9), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_out_munic     = dplyr::if_else(!outlier_function(DA_MULH5A9), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_min_munic     = dplyr::if_else(DA_MULH5A9 >= (min(dplyr::lag(DA_MULH5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_max_munic     = dplyr::if_else(DA_MULH5A9 <= (max(dplyr::lag(DA_MULH5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_min_k_munic   = dplyr::if_else(DA_MULH5A9 >= (min(dplyr::lag(DA_MULH5A9), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_max_k_munic   = dplyr::if_else(DA_MULH5A9 <= (k * max(dplyr::lag(DA_MULH5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_med_mov_munic = dplyr::if_else(DA_MULH5A9 <= (k * zoo::rollmedian(DA_MULH5A9, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH5A9), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh5a9}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh5a9 |> 
  dplyr::select(!DA_MULH5A9) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh5a9}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh5a9}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH10A14

```{r rules_dist_da_mulh10a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh10a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH10A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH10A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH10A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH10A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH10A14), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_out_munic     = dplyr::if_else(!outlier_function(DA_MULH10A14), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_min_munic     = dplyr::if_else(DA_MULH10A14 >= (min(dplyr::lag(DA_MULH10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_max_munic     = dplyr::if_else(DA_MULH10A14 <= (max(dplyr::lag(DA_MULH10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_min_k_munic   = dplyr::if_else(DA_MULH10A14 >= (min(dplyr::lag(DA_MULH10A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_max_k_munic   = dplyr::if_else(DA_MULH10A14 <= (k * max(dplyr::lag(DA_MULH10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_med_mov_munic = dplyr::if_else(DA_MULH10A14 <= (k * zoo::rollmedian(DA_MULH10A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH10A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh10a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh10a14 |> 
  dplyr::select(!DA_MULH10A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh10a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh10a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH15A19

```{r rules_dist_da_mulh15a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh15a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH15A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH15A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH15A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH15A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH15A19), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_out_munic     = dplyr::if_else(!outlier_function(DA_MULH15A19), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_min_munic     = dplyr::if_else(DA_MULH15A19 >= (min(dplyr::lag(DA_MULH15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_max_munic     = dplyr::if_else(DA_MULH15A19 <= (max(dplyr::lag(DA_MULH15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_min_k_munic   = dplyr::if_else(DA_MULH15A19 >= (min(dplyr::lag(DA_MULH15A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_max_k_munic   = dplyr::if_else(DA_MULH15A19 <= (k * max(dplyr::lag(DA_MULH15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_med_mov_munic = dplyr::if_else(DA_MULH15A19 <= (k * zoo::rollmedian(DA_MULH15A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH15A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh15a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh15a19 |> 
  dplyr::select(!DA_MULH15A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh15a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh15a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH20A24

```{r rules_dist_da_mulh20a24}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh20a24 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH20A24" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH20A24"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH20A24) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH20A24_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH20A24), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_out_munic     = dplyr::if_else(!outlier_function(DA_MULH20A24), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_min_munic     = dplyr::if_else(DA_MULH20A24 >= (min(dplyr::lag(DA_MULH20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_max_munic     = dplyr::if_else(DA_MULH20A24 <= (max(dplyr::lag(DA_MULH20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_min_k_munic   = dplyr::if_else(DA_MULH20A24 >= (min(dplyr::lag(DA_MULH20A24), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_max_k_munic   = dplyr::if_else(DA_MULH20A24 <= (k * max(dplyr::lag(DA_MULH20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_med_mov_munic = dplyr::if_else(DA_MULH20A24 <= (k * zoo::rollmedian(DA_MULH20A24, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH20A24), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh20a24}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh20a24 |> 
  dplyr::select(!DA_MULH20A24) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh20a24}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh20a24}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH25A29

```{r rules_dist_da_mulh25a29}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh25a29 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH25A29" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH25A29"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH25A29) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH25A29_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH25A29), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_out_munic     = dplyr::if_else(!outlier_function(DA_MULH25A29), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_min_munic     = dplyr::if_else(DA_MULH25A29 >= (min(dplyr::lag(DA_MULH25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_max_munic     = dplyr::if_else(DA_MULH25A29 <= (max(dplyr::lag(DA_MULH25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_min_k_munic   = dplyr::if_else(DA_MULH25A29 >= (min(dplyr::lag(DA_MULH25A29), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_max_k_munic   = dplyr::if_else(DA_MULH25A29 <= (k * max(dplyr::lag(DA_MULH25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_med_mov_munic = dplyr::if_else(DA_MULH25A29 <= (k * zoo::rollmedian(DA_MULH25A29, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH25A29), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh25a29}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh25a29 |> 
  dplyr::select(!DA_MULH25A29) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh25a29}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh25a29}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH30A34

```{r rules_dist_da_mulh30a34}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh30a34 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH30A34" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH30A34"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH30A34) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH30A34_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH30A34), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_out_munic     = dplyr::if_else(!outlier_function(DA_MULH30A34), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_min_munic     = dplyr::if_else(DA_MULH30A34 >= (min(dplyr::lag(DA_MULH30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_max_munic     = dplyr::if_else(DA_MULH30A34 <= (max(dplyr::lag(DA_MULH30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_min_k_munic   = dplyr::if_else(DA_MULH30A34 >= (min(dplyr::lag(DA_MULH30A34), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_max_k_munic   = dplyr::if_else(DA_MULH30A34 <= (k * max(dplyr::lag(DA_MULH30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_med_mov_munic = dplyr::if_else(DA_MULH30A34 <= (k * zoo::rollmedian(DA_MULH30A34, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH30A34), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh30a34}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh30a34 |> 
  dplyr::select(!DA_MULH30A34) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh30a34}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh30a34}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH35A39

```{r rules_dist_da_mulh35a39}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh35a39 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH35A39" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH35A39"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH35A39) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH35A39_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH35A39), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_out_munic     = dplyr::if_else(!outlier_function(DA_MULH35A39), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_min_munic     = dplyr::if_else(DA_MULH35A39 >= (min(dplyr::lag(DA_MULH35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_max_munic     = dplyr::if_else(DA_MULH35A39 <= (max(dplyr::lag(DA_MULH35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_min_k_munic   = dplyr::if_else(DA_MULH35A39 >= (min(dplyr::lag(DA_MULH35A39), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_max_k_munic   = dplyr::if_else(DA_MULH35A39 <= (k * max(dplyr::lag(DA_MULH35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_med_mov_munic = dplyr::if_else(DA_MULH35A39 <= (k * zoo::rollmedian(DA_MULH35A39, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH35A39), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh35a39}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh35a39 |> 
  dplyr::select(!DA_MULH35A39) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh35a39}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh35a39}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH40A44

```{r rules_dist_da_mulh40a44}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh40a44 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH40A44" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH40A44"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH40A44) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH40A44_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH40A44), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_out_munic     = dplyr::if_else(!outlier_function(DA_MULH40A44), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_min_munic     = dplyr::if_else(DA_MULH40A44 >= (min(dplyr::lag(DA_MULH40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_max_munic     = dplyr::if_else(DA_MULH40A44 <= (max(dplyr::lag(DA_MULH40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_min_k_munic   = dplyr::if_else(DA_MULH40A44 >= (min(dplyr::lag(DA_MULH40A44), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_max_k_munic   = dplyr::if_else(DA_MULH40A44 <= (k * max(dplyr::lag(DA_MULH40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_med_mov_munic = dplyr::if_else(DA_MULH40A44 <= (k * zoo::rollmedian(DA_MULH40A44, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH40A44), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh40a44}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh40a44 |> 
  dplyr::select(!DA_MULH40A44) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh40a44}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh40a44}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH45A49

```{r rules_dist_da_mulh45a49}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh45a49 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH45A49" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH45A49"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH45A49) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH45A49_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH45A49), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_out_munic     = dplyr::if_else(!outlier_function(DA_MULH45A49), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_min_munic     = dplyr::if_else(DA_MULH45A49 >= (min(dplyr::lag(DA_MULH45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_max_munic     = dplyr::if_else(DA_MULH45A49 <= (max(dplyr::lag(DA_MULH45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_min_k_munic   = dplyr::if_else(DA_MULH45A49 >= (min(dplyr::lag(DA_MULH45A49), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_max_k_munic   = dplyr::if_else(DA_MULH45A49 <= (k * max(dplyr::lag(DA_MULH45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_med_mov_munic = dplyr::if_else(DA_MULH45A49 <= (k * zoo::rollmedian(DA_MULH45A49, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH45A49), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh45a49}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh45a49 |> 
  dplyr::select(!DA_MULH45A49) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh45a49}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh45a49}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH50A54

```{r rules_dist_da_mulh50a54}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh50a54 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH50A54" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH50A54"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH50A54) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH50A54_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH50A54), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_out_munic     = dplyr::if_else(!outlier_function(DA_MULH50A54), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_min_munic     = dplyr::if_else(DA_MULH50A54 >= (min(dplyr::lag(DA_MULH50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_max_munic     = dplyr::if_else(DA_MULH50A54 <= (max(dplyr::lag(DA_MULH50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_min_k_munic   = dplyr::if_else(DA_MULH50A54 >= (min(dplyr::lag(DA_MULH50A54), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_max_k_munic   = dplyr::if_else(DA_MULH50A54 <= (k * max(dplyr::lag(DA_MULH50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_med_mov_munic = dplyr::if_else(DA_MULH50A54 <= (k * zoo::rollmedian(DA_MULH50A54, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH50A54), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh50a54}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh50a54 |> 
  dplyr::select(!DA_MULH50A54) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh50a54}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh50a54}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH55A59

```{r rules_dist_da_mulh55a59}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh55a59 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH55A59" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH55A59"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH55A59) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH55A59_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH55A59), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_out_munic     = dplyr::if_else(!outlier_function(DA_MULH55A59), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_min_munic     = dplyr::if_else(DA_MULH55A59 >= (min(dplyr::lag(DA_MULH55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_max_munic     = dplyr::if_else(DA_MULH55A59 <= (max(dplyr::lag(DA_MULH55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_min_k_munic   = dplyr::if_else(DA_MULH55A59 >= (min(dplyr::lag(DA_MULH55A59), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_max_k_munic   = dplyr::if_else(DA_MULH55A59 <= (k * max(dplyr::lag(DA_MULH55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_med_mov_munic = dplyr::if_else(DA_MULH55A59 <= (k * zoo::rollmedian(DA_MULH55A59, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH55A59), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh55a59}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh55a59 |> 
  dplyr::select(!DA_MULH55A59) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh55a59}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh55a59}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH60A64

```{r rules_dist_da_mulh60a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh60a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH60A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH60A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH60A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH60A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH60A64), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_out_munic     = dplyr::if_else(!outlier_function(DA_MULH60A64), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_min_munic     = dplyr::if_else(DA_MULH60A64 >= (min(dplyr::lag(DA_MULH60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_max_munic     = dplyr::if_else(DA_MULH60A64 <= (max(dplyr::lag(DA_MULH60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_min_k_munic   = dplyr::if_else(DA_MULH60A64 >= (min(dplyr::lag(DA_MULH60A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_max_k_munic   = dplyr::if_else(DA_MULH60A64 <= (k * max(dplyr::lag(DA_MULH60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_med_mov_munic = dplyr::if_else(DA_MULH60A64 <= (k * zoo::rollmedian(DA_MULH60A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH60A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh60a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh60a64 |> 
  dplyr::select(!DA_MULH60A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh60a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh60a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH65A69

```{r rules_dist_da_mulh65a69}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh65a69 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH65A69" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH65A69"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH65A69) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH65A69_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH65A69), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_out_munic     = dplyr::if_else(!outlier_function(DA_MULH65A69), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_min_munic     = dplyr::if_else(DA_MULH65A69 >= (min(dplyr::lag(DA_MULH65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_max_munic     = dplyr::if_else(DA_MULH65A69 <= (max(dplyr::lag(DA_MULH65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_min_k_munic   = dplyr::if_else(DA_MULH65A69 >= (min(dplyr::lag(DA_MULH65A69), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_max_k_munic   = dplyr::if_else(DA_MULH65A69 <= (k * max(dplyr::lag(DA_MULH65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_med_mov_munic = dplyr::if_else(DA_MULH65A69 <= (k * zoo::rollmedian(DA_MULH65A69, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH65A69), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh65a69}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh65a69 |> 
  dplyr::select(!DA_MULH65A69) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh65a69}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh65a69}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH70A74

```{r rules_dist_da_mulh70a74}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh70a74 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH70A74" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH70A74"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH70A74) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH70A74_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH70A74), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_out_munic     = dplyr::if_else(!outlier_function(DA_MULH70A74), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_min_munic     = dplyr::if_else(DA_MULH70A74 >= (min(dplyr::lag(DA_MULH70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_max_munic     = dplyr::if_else(DA_MULH70A74 <= (max(dplyr::lag(DA_MULH70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_min_k_munic   = dplyr::if_else(DA_MULH70A74 >= (min(dplyr::lag(DA_MULH70A74), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_max_k_munic   = dplyr::if_else(DA_MULH70A74 <= (k * max(dplyr::lag(DA_MULH70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_med_mov_munic = dplyr::if_else(DA_MULH70A74 <= (k * zoo::rollmedian(DA_MULH70A74, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH70A74), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh70a74}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh70a74 |> 
  dplyr::select(!DA_MULH70A74) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh70a74}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh70a74}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULH75A79

```{r rules_dist_da_mulh75a79}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh75a79 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH75A79" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH75A79"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH75A79) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH75A79_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH75A79), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_out_munic     = dplyr::if_else(!outlier_function(DA_MULH75A79), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_min_munic     = dplyr::if_else(DA_MULH75A79 >= (min(dplyr::lag(DA_MULH75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_max_munic     = dplyr::if_else(DA_MULH75A79 <= (max(dplyr::lag(DA_MULH75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_min_k_munic   = dplyr::if_else(DA_MULH75A79 >= (min(dplyr::lag(DA_MULH75A79), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_max_k_munic   = dplyr::if_else(DA_MULH75A79 <= (k * max(dplyr::lag(DA_MULH75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_med_mov_munic = dplyr::if_else(DA_MULH75A79 <= (k * zoo::rollmedian(DA_MULH75A79, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH75A79), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh75a79}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh75a79 |> 
  dplyr::select(!DA_MULH75A79) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh75a79}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh75a79}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULHER80

```{r rules_dist_da_mulher80}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulher80 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULHER80" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULHER80"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULHER80) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULHER80_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULHER80), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_out_munic     = dplyr::if_else(!outlier_function(DA_MULHER80), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_min_munic     = dplyr::if_else(DA_MULHER80 >= (min(dplyr::lag(DA_MULHER80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_max_munic     = dplyr::if_else(DA_MULHER80 <= (max(dplyr::lag(DA_MULHER80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_min_k_munic   = dplyr::if_else(DA_MULHER80 >= (min(dplyr::lag(DA_MULHER80), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_max_k_munic   = dplyr::if_else(DA_MULHER80 <= (k * max(dplyr::lag(DA_MULHER80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_med_mov_munic = dplyr::if_else(DA_MULHER80 <= (k * zoo::rollmedian(DA_MULHER80, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULHER80), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulher80}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulher80 |> 
  dplyr::select(!DA_MULHER80) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulher80}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulher80}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_HOMEMTOT

```{r rules_dist_da_homemtot}

## df com o resultado das aplicações das regras
df_rules_dist_da_homemtot <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEMTOT" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEMTOT"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEMTOT) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEMTOT_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEMTOT), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEMTOT), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_min_munic     = dplyr::if_else(DA_HOMEMTOT >= (min(dplyr::lag(DA_HOMEMTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_max_munic     = dplyr::if_else(DA_HOMEMTOT <= (max(dplyr::lag(DA_HOMEMTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_min_k_munic   = dplyr::if_else(DA_HOMEMTOT >= (min(dplyr::lag(DA_HOMEMTOT), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_max_k_munic   = dplyr::if_else(DA_HOMEMTOT <= (k * max(dplyr::lag(DA_HOMEMTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_med_mov_munic = dplyr::if_else(DA_HOMEMTOT <= (k * zoo::rollmedian(DA_HOMEMTOT, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEMTOT), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homemtot}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homemtot |> 
  dplyr::select(!DA_HOMEMTOT) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homemtot}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homemtot}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


### DA_MULHERTOT

```{r rules_dist_da_mulhertot}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulhertot <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULHERTOT" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULHERTOT"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULHERTOT) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULHERTOT_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULHERTOT), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_out_munic     = dplyr::if_else(!outlier_function(DA_MULHERTOT), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_min_munic     = dplyr::if_else(DA_MULHERTOT >= (min(dplyr::lag(DA_MULHERTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_max_munic     = dplyr::if_else(DA_MULHERTOT <= (max(dplyr::lag(DA_MULHERTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_min_k_munic   = dplyr::if_else(DA_MULHERTOT >= (min(dplyr::lag(DA_MULHERTOT), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_max_k_munic   = dplyr::if_else(DA_MULHERTOT <= (k * max(dplyr::lag(DA_MULHERTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_med_mov_munic = dplyr::if_else(DA_MULHERTOT <= (k * zoo::rollmedian(DA_MULHERTOT, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULHERTOT), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulhertot}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulhertot |> 
  dplyr::select(!DA_MULHERTOT) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulhertot}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulhertot}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```


# Análise descritiva

As tabelas a seguir apresentam um resumo descritivo dos indicadores analisados, fornecendo uma visão abrangente das características dos dados. Os cálculos foram realizados em função do ano. As informações inclusas abrangem:

-   **Quantidade de Valores (N):** Indica o número total de observações presentes no conjunto de dados para cada indicador.

-   **Valor Mínimo:** Representa o menor valor observado para o indicador.

-   **Valor da Média:** Indica a média aritmética dos valores do indicador, fornecendo uma medida central da tendência dos dados.

-   **Valor da Mediana:** Representa o valor que divide o conjunto de dados ordenados em duas metades de igual tamanho, sendo útil para lidar com casos com *outliers*.

-   **Valor Máximo:** Indica o maior valor observado para o indicador.

-   **Desvio Padrão (D.P.):** Mede a dispersão dos dados em relação à média, quantificando a variabilidade presente no conjunto.

-   **Coeficiente de Variação (C.V.):** Expressa a razão entre o desvio padrão e a média, em porcentagem, fornecendo uma medida relativa da dispersão dos dados em relação à média.

-   **Quantidade de Zeros:** Indica o número de observações com valor igual a zero para o indicador.

-   **Quantidade de Dados Ausentes:** Representa o número de observações com valores ausentes para o indicador.

**Observações Importantes:**

-   A análise de *outliers* (valores atípicos) não foi realizada nesta tabela descritiva. Para uma avaliação mais completa da qualidade dos dados, recomenda-se a análise de *outliers* e a verificação de possíveis inconsistências nos valores apresentados anteriormente neste documento.

-   A interpretação das medidas descritivas deve ser feita em conjunto com o conhecimento do contexto dos indicadores e dos objetivos da análise.

Ao analisar esta tabela, é possível obter uma compreensão inicial das características dos dados, identificando padrões, tendências e possíveis discrepâncias. As informações aqui apresentadas servem como base para análises estatísticas mais aprofundadas, auxiliando na tomada de decisões e na formulação de conclusões relevantes.

## Tabelas

```{r show_desc_table, results='asis'}
#| column: screen-inset-right

pander::pandoc.header("Descritiva", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  pander::pandoc.table(
    table_descriptive(variable = var, data = data, ano_base_alter), 
    decimal.mark = ",", 
    big.mark     = ".", 
    round        = 2,
    split.table  = Inf
  )
  cat("\\pagebreak\n")
}
```

## Gráficos

::: {.callout-note appearance="minimal"}
Observação: os gráficos abaixo são mostrados na escala logarítmica para facilitar a visualização dos dados em certos casos. Para conferir os valores reais, consultar as tabelas descritivas.
:::

```{r show_boxplot_chart, results='asis'}
#| out-width: 100%
#| fig-format: svg

pander::pandoc.header("Gráfico de caixa (boxplot)", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  print(chart_boxplot(variable = var, data = data, ano_base_alter))
  cat("\\pagebreak\n")
}
```

```{r show_hist_chart, results='asis'}
#| out-width: 100%
#| fig-format: svg

pander::pandoc.header("Histograma", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  print(chart_histogram(variable = var, data = data, ano_base_alter))
  cat("\\pagebreak\n")
}
```

```{r excel_create_wb}

## Criar pasta de trabalho
pt <- openxlsx::createWorkbook()
path_data <- system.file("data", "cidades.xlsx", package = "dataeditfjp")
cidades <- openxlsx::read.xlsx(path_data)

```



```{r df_build_viol_valid}
variables <- c(
               "DA_POPTA",
               "DA_POPP0",
               "DA_POPP1A4",
               "DA_POPP4",
               "DA_POPP5",
               "DA_POPP4E5",
               "DA_POPP5A9",
               "DA_POPP6A14",
               "DA_POPP10A14",
               "DA_POPP15",
               "DA_POPP15A17",
               "DA_POPP15A19",
               "DA_POPP15M",
               "DA_POPP16A19",
               "DA_POPP16A64",
               "DA_POPP18M",
               "DA_POPP20A24",
               "DA_POPP25A29",
               "DA_POPP30A34",
               "DA_POPP35A39",
               "DA_POPP40A44",
               "DA_POPP45A49",
               "DA_POPP50A54",
               "DA_POPP55A59",
               "DA_POPP60A64",
               "DA_POPP65A69",
               "DA_POPP70A74",
               "DA_POPP75A79",
               "DA_POPP80M",
               "DA_DENSP",
               "DA_PROPP4E5",
               "DA_PROPP0A5",
               "DA_PROPP6A17",
               "DA_RDEPP",
               "DA_PROPP15N",
               "DA_PROPP65M",
               "DA_INDENVE",
               "DA_HOMEM0A4",
               "DA_HOMEM5A9",
               "DA_HOMEM10A14",
               "DA_HOMEM15A19",
               "DA_HOMEM20A24",
               "DA_HOMEM25A29",
               "DA_HOMEM30A34",
               "DA_HOMEM35A39",
               "DA_HOMEM40A44",
               "DA_HOMEM45A49",
               "DA_HOMEM50A54",
               "DA_HOMEM55A59",
               "DA_HOMEM60A64",
               "DA_HOMEM65A69",
               "DA_HOMEM70A74",
               "DA_HOMEM75A79",
               "DA_HOMEM80",
               "DA_MULH0A4",
               "DA_MULH5A9",
               "DA_MULH10A14",
               "DA_MULH15A19",
               "DA_MULH20A24",
               "DA_MULH25A29",
               "DA_MULH30A34",
               "DA_MULH35A39",
               "DA_MULH40A44",
               "DA_MULH45A49",
               "DA_MULH50A54",
               "DA_MULH55A59",
               "DA_MULH60A64",
               "DA_MULH65A69",
               "DA_MULH70A74",
               "DA_MULH75A79",
               "DA_MULHER80",
               "DA_HOMEMTOT",
               "DA_MULHERTOT")

lis <- split(variables,f = variables)
df_obs_valid <- names(lis)|>
sapply(function(i){
lis[[i]] <- df_rules_valid_da_all |>
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with(i)
  ) |>
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")),
    names_to  = "regra",
    values_to = "obs_suspeita"
  ) |>
  dplyr::filter(obs_suspeita) |>
  dplyr::rename_with(tolower) |>
  dplyr::left_join(cidades, by = join_by(ibge7==id)) |>
  dplyr::select(ano, ibge7, cidade, obs_suspeita, regra) |>
  dplyr::arrange(ano, ibge7)
return(lis[[i]])
}, USE.NAMES=TRUE, simplify = FALSE)

index <- sapply(df_obs_valid, nrow)!=0
df_obs_valid <- df_obs_valid[index]

for(i in names(df_obs_valid)){
  openxlsx::addWorksheet(pt, paste0("valid-", i))
  openxlsx::writeData(pt, paste0("valid-", i), df_obs_valid[[i]])
}



# Criar base com as observações que violaram uma ou mais regras de validade

## Validade

# df_rules_valid_da_popta <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPTA")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp0 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP0")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp1a4 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP1A4")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp4 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP4")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp5 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP5")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp4e5 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP4E5")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp5a9 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP5A9")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp6a14 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP6A14")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp10a14 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP10A14")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp15 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP15")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp15a17 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP15A17")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp15a19 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP15A19")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp15m <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP15M")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp16a19 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP16A19")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp16a64 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP16A64")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp18m <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP18M")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp20a24 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP20A24")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp25a29 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP25A29")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp30a34 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP30A34")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp35a39 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP35A39")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp40a44 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP40A44")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp45a49 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP45A49")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp50a54 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP50A54")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp55a59 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP55A59")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp60a64 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP60A64")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp65a69 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP65A69")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp70a74 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP70A74")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp75a79 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP75A79")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_popp80m <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_POPP80M")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_densp <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_DENSP")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_propp4e5 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_PROPP4E5")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_propp0a5 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_PROPP0A5")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_propp6a17 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_PROPP6A17")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_rdepp <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_RDEPP")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_propp15n <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_PROPP15N")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_propp65m <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_PROPP65M")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_indenve <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_INDENVE")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem0a4 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM0A4")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem5a9 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM5A9")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem10a14 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM10A14")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem15a19 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM15A19")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem20a24 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM20A24")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem25a29 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM25A29")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem30a34 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM30A34")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem35a39 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM35A39")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem40a44 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM40A44")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem45a49 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM45A49")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem50a54 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM50A54")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem55a59 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM55A59")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem60a64 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM60A64")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem65a69 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM65A69")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem70a74 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM70A74")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem75a79 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM75A79")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homem80 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEM80")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh0a4 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH0A4")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh5a9 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH5A9")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh10a14 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH10A14")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh15a19 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH15A19")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh20a24 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH20A24")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh25a29 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH25A29")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh30a34 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH30A34")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh35a39 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH35A39")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh40a44 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH40A44")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh45a49 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH45A49")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh50a54 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH50A54")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh55a59 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH55A59")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh60a64 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH60A64")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh65a69 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH65A69")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh70a74 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH70A74")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulh75a79 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULH75A79")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulher80 <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULHER80")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_homemtot <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_HOMEMTOT")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
# 
# df_rules_valid_da_mulhertot <- df_rules_valid_da_all |> 
#   dplyr::select(
#     Ano,
#     ibge7,
#     dplyr::ends_with("DA_MULHERTOT")
#   ) |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)


```

```{r df_export_viol_valid}

## Lista com os dfs por indicador
# lista_df <- list(
#   "da_popta"      = df_rules_valid_da_popta,
#   "da_popp0"      = df_rules_valid_da_popp0,
#   "da_popp1a4"    = df_rules_valid_da_popp1a4,
#   "da_popp4"      = df_rules_valid_da_popp4,
#   "da_popp5"      = df_rules_valid_da_popp5,
#   "da_popp4e5"    = df_rules_valid_da_popp4e5,
#   "da_popp5a9"    = df_rules_valid_da_popp5a9,
#   "da_popp6a14"   = df_rules_valid_da_popp6a14,
#   "da_popp10a14"  = df_rules_valid_da_popp10a14,
#   "da_popp15"     = df_rules_valid_da_popp15,
#   "da_popp15a17"  = df_rules_valid_da_popp15a17,
#   "da_popp15a19"  = df_rules_valid_da_popp15a19,
#   "da_popp15m"    = df_rules_valid_da_popp15m,
#   "da_popp16a19"  = df_rules_valid_da_popp16a19,
#   "da_popp16a64"  = df_rules_valid_da_popp16a64,
#   "da_popp18m"    = df_rules_valid_da_popp18m,
#   "da_popp20a24"  = df_rules_valid_da_popp20a24,
#   "da_popp25a29"  = df_rules_valid_da_popp25a29,
#   "da_popp30a34"  = df_rules_valid_da_popp30a34,
#   "da_popp35a39"  = df_rules_valid_da_popp35a39,
#   "da_popp40a44"  = df_rules_valid_da_popp40a44,
#   "da_popp45a49"  = df_rules_valid_da_popp45a49,
#   "da_popp50a54"  = df_rules_valid_da_popp50a54,
#   "da_popp55a59"  = df_rules_valid_da_popp55a59,
#   "da_popp60a64"  = df_rules_valid_da_popp60a64,
#   "da_popp65a69"  = df_rules_valid_da_popp65a69,
#   "da_popp70a74"  = df_rules_valid_da_popp70a74,
#   "da_popp75a79"  = df_rules_valid_da_popp75a79,
#   "da_popp80m"    = df_rules_valid_da_popp80m,
#   "da_densp"      = df_rules_valid_da_densp,
#   "da_propp4e5"   = df_rules_valid_da_propp4e5,
#   "da_propp0a5"   = df_rules_valid_da_propp0a5,
#   "da_propp6a17"  = df_rules_valid_da_propp6a17,
#   "da_rdepp"      = df_rules_valid_da_rdepp,
#   "da_propp15n"   = df_rules_valid_da_propp15n,
#   "da_propp65m"   = df_rules_valid_da_propp65m,
#   "da_indenve"    = df_rules_valid_da_indenve,
#   "da_homem0a4"   = df_rules_valid_da_homem0a4,
#   "da_homem5a9"   = df_rules_valid_da_homem5a9,
#   "da_homem10a14" = df_rules_valid_da_homem10a14,
#   "da_homem15a19" = df_rules_valid_da_homem15a19,
#   "da_homem20a24" = df_rules_valid_da_homem20a24,
#   "da_homem25a29" = df_rules_valid_da_homem25a29,
#   "da_homem30a34" = df_rules_valid_da_homem30a34,
#   "da_homem35a39" = df_rules_valid_da_homem35a39,
#   "da_homem40a44" = df_rules_valid_da_homem40a44,
#   "da_homem45a49" = df_rules_valid_da_homem45a49,
#   "da_homem50a54" = df_rules_valid_da_homem50a54,
#   "da_homem55a59" = df_rules_valid_da_homem55a59,
#   "da_homem60a64" = df_rules_valid_da_homem60a64,
#   "da_homem65a69" = df_rules_valid_da_homem65a69,
#   "da_homem70a74" = df_rules_valid_da_homem70a74,
#   "da_homem75a79" = df_rules_valid_da_homem75a79,
#   "da_homem80"    = df_rules_valid_da_homem80,
#   "da_mulh0a4"    = df_rules_valid_da_mulh0a4,
#   "da_mulh5a9"    = df_rules_valid_da_mulh5a9,
#   "da_mulh10a14"  = df_rules_valid_da_mulh10a14,
#   "da_mulh15a19"  = df_rules_valid_da_mulh15a19,
#   "da_mulh20a24"  = df_rules_valid_da_mulh20a24,
#   "da_mulh25a29"  = df_rules_valid_da_mulh25a29,
#   "da_mulh30a34"  = df_rules_valid_da_mulh30a34,
#   "da_mulh35a39"  = df_rules_valid_da_mulh35a39,
#   "da_mulh40a44"  = df_rules_valid_da_mulh40a44,
#   "da_mulh45a49"  = df_rules_valid_da_mulh45a49,
#   "da_mulh50a54"  = df_rules_valid_da_mulh50a54,
#   "da_mulh55a59"  = df_rules_valid_da_mulh55a59,
#   "da_mulh60a64"  = df_rules_valid_da_mulh60a64,
#   "da_mulh65a69"  = df_rules_valid_da_mulh65a69,
#   "da_mulh70a74"  = df_rules_valid_da_mulh70a74,
#   "da_mulh75a79"  = df_rules_valid_da_mulh75a79,
#   "da_mulher80"   = df_rules_valid_da_mulher80,
#   "da_homemtot"   = df_rules_valid_da_homemtot,
#   "da_mulhertot"  = df_rules_valid_da_mulhertot
# )
# 
# ## Add dados à pasta de trabalho
# for(i in names(lista_df)){
#   nome <- stringr::str_remove(i, "df_rules_valid_")
#   openxlsx::addWorksheet(pt, paste0("valid - ", nome))
#   openxlsx::writeData(pt, paste0("valid - ", nome), lista_df[[i]])
# }

```


```{r df_build_viol_dist}

# Criar base com as observações que violaram uma ou mais regras de distribuição

## Distribuição

df_rules_dist_da_popta <- df_rules_dist_da_popta |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp0 <- df_rules_dist_da_popp0 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp1a4 <- df_rules_dist_da_popp1a4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp4 <- df_rules_dist_da_popp4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp5 <- df_rules_dist_da_popp5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp4e5 <- df_rules_dist_da_popp4e5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp5a9 <- df_rules_dist_da_popp5a9 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp6a14 <- df_rules_dist_da_popp6a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp10a14 <- df_rules_dist_da_popp10a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15 <- df_rules_dist_da_popp15 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15a17 <- df_rules_dist_da_popp15a17 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15a19 <- df_rules_dist_da_popp15a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15m <- df_rules_dist_da_popp15m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp16a19 <- df_rules_dist_da_popp16a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp16a64 <- df_rules_dist_da_popp16a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp18m <- df_rules_dist_da_popp18m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp20a24 <- df_rules_dist_da_popp20a24 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp25a29 <- df_rules_dist_da_popp25a29 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp30a34 <- df_rules_dist_da_popp30a34 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp35a39 <- df_rules_dist_da_popp35a39 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp40a44 <- df_rules_dist_da_popp40a44 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp45a49 <- df_rules_dist_da_popp45a49 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp50a54 <- df_rules_dist_da_popp50a54 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp55a59 <- df_rules_dist_da_popp55a59 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp60a64 <- df_rules_dist_da_popp60a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp65a69 <- df_rules_dist_da_popp65a69 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp70a74 <- df_rules_dist_da_popp70a74 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp75a79 <- df_rules_dist_da_popp75a79 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp80m <- df_rules_dist_da_popp80m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_densp <- df_rules_dist_da_densp |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp4e5 <- df_rules_dist_da_propp4e5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp0a5 <- df_rules_dist_da_propp0a5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp6a17 <- df_rules_dist_da_propp6a17 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_rdepp <- df_rules_dist_da_rdepp |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp15n <- df_rules_dist_da_propp15n |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp65m <- df_rules_dist_da_propp65m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_indenve <- df_rules_dist_da_indenve |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)


df_rules_dist_da_homem0a4 <- df_rules_dist_da_homem0a4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem5a9 <- df_rules_dist_da_homem5a9 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem10a14 <- df_rules_dist_da_homem10a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem15a19 <- df_rules_dist_da_homem15a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem20a24 <- df_rules_dist_da_homem20a24 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem25a29 <- df_rules_dist_da_homem25a29 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem30a34 <- df_rules_dist_da_homem30a34 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem35a39 <- df_rules_dist_da_homem35a39 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem40a44 <- df_rules_dist_da_homem40a44 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem45a49 <- df_rules_dist_da_homem45a49 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem50a54 <- df_rules_dist_da_homem50a54 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem55a59 <- df_rules_dist_da_homem55a59 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem60a64 <- df_rules_dist_da_homem60a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem65a69 <- df_rules_dist_da_homem65a69 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem70a74 <- df_rules_dist_da_homem70a74 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem75a79 <- df_rules_dist_da_homem75a79 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem80 <- df_rules_dist_da_homem80 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh0a4 <- df_rules_dist_da_mulh0a4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh5a9 <- df_rules_dist_da_mulh5a9 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh10a14 <- df_rules_dist_da_mulh10a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh15a19 <- df_rules_dist_da_mulh15a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh20a24 <- df_rules_dist_da_mulh20a24 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh25a29 <- df_rules_dist_da_mulh25a29 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh30a34 <- df_rules_dist_da_mulh30a34 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh35a39 <- df_rules_dist_da_mulh35a39 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh40a44 <- df_rules_dist_da_mulh40a44 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh45a49 <- df_rules_dist_da_mulh45a49 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh50a54 <- df_rules_dist_da_mulh50a54 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh55a59 <- df_rules_dist_da_mulh55a59 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh60a64 <- df_rules_dist_da_mulh60a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh65a69 <- df_rules_dist_da_mulh65a69 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh70a74 <- df_rules_dist_da_mulh70a74 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh75a79 <- df_rules_dist_da_mulh75a79 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulher80 <- df_rules_dist_da_mulher80 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homemtot <- df_rules_dist_da_homemtot |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulhertot <- df_rules_dist_da_mulhertot |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

```

```{r df_export_viol_dist}

lista_df <- list(
  "da_popta"      = df_rules_dist_da_popta,
  "da_popp0"      = df_rules_dist_da_popp0,
  "da_popp1a4"    = df_rules_dist_da_popp1a4,
  "da_popp4"      = df_rules_dist_da_popp4,
  "da_popp5"      = df_rules_dist_da_popp5,
  "da_popp4e5"    = df_rules_dist_da_popp4e5,
  "da_popp5a9"    = df_rules_dist_da_popp5a9,
  "da_popp6a14"   = df_rules_dist_da_popp6a14,
  "da_popp10a14"  = df_rules_dist_da_popp10a14,
  "da_popp15"     = df_rules_dist_da_popp15,
  "da_popp15a17"  = df_rules_dist_da_popp15a17,
  "da_popp15a19"  = df_rules_dist_da_popp15a19,
  "da_popp15m"    = df_rules_dist_da_popp15m,
  "da_popp16a19"  = df_rules_dist_da_popp16a19,
  "da_popp16a64"  = df_rules_dist_da_popp16a64,
  "da_popp18m"    = df_rules_dist_da_popp18m,
  "da_popp20a24"  = df_rules_dist_da_popp20a24,
  "da_popp25a29"  = df_rules_dist_da_popp25a29,
  "da_popp30a34"  = df_rules_dist_da_popp30a34,
  "da_popp35a39"  = df_rules_dist_da_popp35a39,
  "da_popp40a44"  = df_rules_dist_da_popp40a44,
  "da_popp45a49"  = df_rules_dist_da_popp45a49,
  "da_popp50a54"  = df_rules_dist_da_popp50a54,
  "da_popp55a59"  = df_rules_dist_da_popp55a59,
  "da_popp60a64"  = df_rules_dist_da_popp60a64,
  "da_popp65a69"  = df_rules_dist_da_popp65a69,
  "da_popp70a74"  = df_rules_dist_da_popp70a74,
  "da_popp75a79"  = df_rules_dist_da_popp75a79,
  "da_popp80m"    = df_rules_dist_da_popp80m,
  "da_densp"      = df_rules_dist_da_densp,
  "da_propp4e5"   = df_rules_dist_da_propp4e5,
  "da_propp0a5"   = df_rules_dist_da_propp0a5,
  "da_propp6a17"  = df_rules_dist_da_propp6a17,
  "da_rdepp"      = df_rules_dist_da_rdepp,
  "da_propp15n"   = df_rules_dist_da_propp15n,
  "da_propp65m"   = df_rules_dist_da_propp65m,
  "da_indenve"    = df_rules_dist_da_indenve,
  "da_homem0a4"   = df_rules_dist_da_homem0a4,
  "da_homem5a9"   = df_rules_dist_da_homem5a9,
  "da_homem10a14" = df_rules_dist_da_homem10a14,
  "da_homem15a19" = df_rules_dist_da_homem15a19,
  "da_homem20a24" = df_rules_dist_da_homem20a24,
  "da_homem25a29" = df_rules_dist_da_homem25a29,
  "da_homem30a34" = df_rules_dist_da_homem30a34,
  "da_homem35a39" = df_rules_dist_da_homem35a39,
  "da_homem40a44" = df_rules_dist_da_homem40a44,
  "da_homem45a49" = df_rules_dist_da_homem45a49,
  "da_homem50a54" = df_rules_dist_da_homem50a54,
  "da_homem55a59" = df_rules_dist_da_homem55a59,
  "da_homem60a64" = df_rules_dist_da_homem60a64,
  "da_homem65a69" = df_rules_dist_da_homem65a69,
  "da_homem70a74" = df_rules_dist_da_homem70a74,
  "da_homem75a79" = df_rules_dist_da_homem75a79,
  "da_homem80"    = df_rules_dist_da_homem80,
  "da_mulh0a4"    = df_rules_dist_da_mulh0a4,
  "da_mulh5a9"    = df_rules_dist_da_mulh5a9,
  "da_mulh10a14"  = df_rules_dist_da_mulh10a14,
  "da_mulh15a19"  = df_rules_dist_da_mulh15a19,
  "da_mulh20a24"  = df_rules_dist_da_mulh20a24,
  "da_mulh25a29"  = df_rules_dist_da_mulh25a29,
  "da_mulh30a34"  = df_rules_dist_da_mulh30a34,
  "da_mulh35a39"  = df_rules_dist_da_mulh35a39,
  "da_mulh40a44"  = df_rules_dist_da_mulh40a44,
  "da_mulh45a49"  = df_rules_dist_da_mulh45a49,
  "da_mulh50a54"  = df_rules_dist_da_mulh50a54,
  "da_mulh55a59"  = df_rules_dist_da_mulh55a59,
  "da_mulh60a64"  = df_rules_dist_da_mulh60a64,
  "da_mulh65a69"  = df_rules_dist_da_mulh65a69,
  "da_mulh70a74"  = df_rules_dist_da_mulh70a74,
  "da_mulh75a79"  = df_rules_dist_da_mulh75a79,
  "da_mulher80"   = df_rules_dist_da_mulher80,
  "da_homemtot"   = df_rules_dist_da_homemtot,
  "da_mulhertot"  = df_rules_dist_da_mulhertot
)

for(i in names(lista_df)){
  nome <- stringr::str_remove(i, "df_rules_dist_")
  openxlsx::addWorksheet(pt, paste0("distrib-", nome))
  openxlsx::writeData(pt, paste0("distrib-", nome), lista_df[[i]])
}
```

```{r excel_save_wb}

openxlsx::saveWorkbook(pt, "fjpdados_demografia_violacoes.xlsx", overwrite = T)
```

```{r clean_env, results='hide'}

rm(list = ls())
gc()
```
