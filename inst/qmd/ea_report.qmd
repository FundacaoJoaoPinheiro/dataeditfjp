---
title: FJP Dados
subtitle: Economia
description: Relatório contendo uma análise descritiva e os resultados das regras de crítica dos dados da dimensão.
author: 
  name: Coordenação de Indicadores Sociais (CIS)
  affiliation: 
    name: Diretoria de Estatística e Informações (Direi)
    address: Alameda das Acácias, 70 - São Luiz 
    city: Belo Horizonte
    state: Minas Gerais
    postal-code: 31.275-150
    url: https://fjp.mg.gov.br/
lang: pt
date: today
title-block-banner: "#00b4d8"
title-block-banner-color: "#ffffff"
format: 
  html:
    embed-resources: true
    smooth-scroll: true
    toc: true
    toc-location: left
    toc-title: MENU
    linkcolor: "#00b4d8"
    css: css/all_custom.css
    theme:
      light: [flatly, css/ea_custom.scss]
editor: visual
execute:
  echo: false
  warning: false
  error: false
  message: false
params:
  data: file.xlsx
output-file: "ea_relatorio.html"
---

```{r source_functions}

# source(sistem.file("R", "aux_functions.R"), package = "criticaldatafjp")
source(here::here("R", "aux_functions.R"))
```

```{r set_param_global}

k <- 1.5 

## "Truque" para setar "k" como uma constante
lockBinding("k", globalenv())

## Parâmetros para os gráficos do validate::
chart_title <- "Resultado das validações por regra estabelecida"
chart_label <- c("Erros", "Sucessos", "Missing", "Total")
chart_palette <- c("#ff985a", "#9fc0de", "#cccccc")
chart_xlab <- ""
```

```{r import_data}

data <- openxlsx::read.xlsx(params$data)
```

```{r get_var_numeric}

# Obter as siglas das variáveis do tipo numérico
var_numeric <- data |> 
  dplyr::select(
    !c("CHAVE", "IBGE6", "IBGE7", "ANO") & dplyr::where(is.numeric)
  ) |> 
  colnames() |> 
  unlist()
```

```{r get_var_character}

# Obter as siglas variáveis do tipo string
var_char <- data |> 
  dplyr::select(
    !c("CHAVE", "IBGE6", "IBGE7", "ANO") & dplyr::where(is.character)
  ) |> 
  colnames() |> 
  unlist()
```

# Introdução

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi sollicitudin, metus nec rhoncus posuere, leo dolor auctor neque, ut consectetur massa sem et nibh. Vivamus aliquam arcu sed ligula tincidunt, vel iaculis felis accumsan. Fusce in pellentesque erat. In vel euismod justo. Suspendisse imperdiet nulla eget dolor ornare, in viverra massa congue. Suspendisse nec vestibulum lectus. Phasellus venenatis vel turpis ut finibus. Vivamus vehicula neque sem, at ullamcorper magna finibus at. Praesent pulvinar, enim id pellentesque ultricies, magna nibh suscipit magna, at viverra dolor neque vel dolor. Quisque vestibulum orci et ex pharetra, vitae feugiat nulla sollicitudin. Suspendisse posuere aliquet.

# Regras de crítica

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi sollicitudin, metus nec rhoncus posuere, leo dolor auctor neque, ut consectetur massa sem et nibh. Vivamus aliquam arcu sed ligula tincidunt, vel iaculis felis accumsan. Fusce in pellentesque erat. In vel euismod justo. Suspendisse imperdiet nulla eget dolor ornare, in viverra massa congue. Suspendisse nec vestibulum lectus. Phasellus venenatis vel turpis ut finibus. Vivamus vehicula neque sem, at ullamcorper magna finibus at. Praesent pulvinar, enim id pellentesque ultricies, magna nibh suscipit magna, at viverra dolor neque vel dolor. Quisque vestibulum orci et ex pharetra, vitae feugiat nulla sollicitudin. Suspendisse posuere aliquet.

-   Tipo

    -   **TI\_\[...\]**: tipo do dado está de acordo com o esperado (numérico, textual ou categórico).

-   Validade

    -   **VI\_\[...\]**: dado é não negativo e/ou está entre um intervalo estipulado (ex.: 0% e 100%).

-   Consistência

    -   **CF\_\[...\]\_prop**: ???

    -   **CF\_\[...\]\_total**: a soma da proporção é igual a $\approx$ 100%.

-   Distribuição

    -   **DF\_\[...\]\_hampel_munic**: identificação de um possível valor *outlier* na série histórica;

    -   **DF\_\[...\]\_out_munic**: segundo método de identificação de um possível valor *outlier* na série histórica;

    -   **DF\_\[...\]\_min_munic**: o valor mais recente é maior ou igual ao menor / k valor da série histórica;

    -   **DF\_\[...\]\_max_munic**: o valor mais recente é menor ou igual ao maior \* k valor da série histórica;

    -   **DF\_\[...\]\_med_mov_munic:** o valor atual é menor ou igual a mediana móvel \* k;

    -   **DF\_\[...\]\_dif_munic**: o valor mais recente da primeira diferença é menor ou igual ao maior valor da primeira diferença da série histórica;

    -   **DF\_\[...\]\_compare**: ???

## Tipo

### Todos os indicadores

```{r rules_type}
  
rules_type <- validate::validator(
  TI_EA_BFFAM    = is.numeric(EA_BFFAM),
  TI_EA_TRFAM    = is.numeric(EA_TRFAM),
  TI_EA_TRPF     = is.numeric(EA_TRPF),
  TI_EA_BPCDEF   = is.numeric(EA_BPCDEF),
  TI_EA_BPCIDO   = is.numeric(EA_BPCIDO),
  TI_EA_BFBPC    = is.numeric(EA_BFBPC),
  TI_EA_TRBPCDEF = is.numeric(EA_TRBPCDEF),
  TI_EA_TRBPCIDO = is.numeric(EA_TRBPCIDO),
  TI_EA_TRBPC    = is.numeric(EA_TRBPC),
  TI_EA_TRBPCPB  = is.numeric(EA_TRBPCPB),
  TI_EA_TRBFBPC  = is.numeric(EA_TRBFBPC),
  TI_EA_TRPC     = is.numeric(EA_TRPC),
  TI_EA_TRPCBF   = is.numeric(EA_TRPCBF),
  TI_EA_TRPCBPC  = is.numeric(EA_TRPCBPC),
  TI_EA_VAAGR    = is.numeric(EA_VAAGR),
  TI_EA_VAIND    = is.numeric(EA_VAIND),
  TI_EA_VAADM    = is.numeric(EA_VAADM),
  TI_EA_VASERV   = is.numeric(EA_VASERV),
  TI_EA_PVAAGR   = is.numeric(EA_PVAAGR),
  TI_EA_PVAIND   = is.numeric(EA_PVAIND),
  TI_EA_PVAADM   = is.numeric(EA_PVAADM),
  TI_EA_PVASERV  = is.numeric(EA_PVASERV),
  TI_EA_VATOT    = is.numeric(EA_VATOT),
  TI_EA_IMPLIQ   = is.numeric(EA_IMPLIQ),
  TI_EA_PIB      = is.numeric(EA_PIB),
  TI_EA_PIBPC    = is.numeric(EA_PIBPC),
  TI_EA_VAFAG    = is.numeric(EA_VAFAG),
  TI_EA_VAF      = is.numeric(EA_VAF),
  TI_EA_VAFMI    = is.numeric(EA_VAFMI),
  TI_EA_VAFIT    = is.numeric(EA_VAFIT),
  TI_EA_VAFIC    = is.numeric(EA_VAFIC),
  TI_EA_VAFUP    = is.numeric(EA_VAFUP),
  TI_EA_VAFCV    = is.numeric(EA_VAFCV),
  TI_EA_VAFCA    = is.numeric(EA_VAFCA),
  TI_EA_VAFSE    = is.numeric(EA_VAFSE),
  TI_EA_VAFO     = is.numeric(EA_VAFO),
  TI_EA_PVAFAG   = is.numeric(EA_PVAFAG),
  TI_EA_PVAFMI   = is.numeric(EA_PVAFMI),
  TI_EA_PVAFIT   = is.numeric(EA_PVAFIT),
  TI_EA_PVAFIC   = is.numeric(EA_PVAFIC),
  TI_EA_PVAFUP   = is.numeric(EA_PVAFUP),
  TI_EA_PVAFCV   = is.numeric(EA_PVAFCV),
  TI_EA_PVAFCA   = is.numeric(EA_PVAFCA),
  TI_EA_PVAFSE   = is.numeric(EA_PVAFSE),
  TI_EA_PVAFO    = is.numeric(EA_PVAFO),
  TI_EA_VAFPC    = is.numeric(EA_VAFPC),
  TI_EA_VAFCVPC  = is.numeric(EA_VAFCVPC),
  TI_EA_EMPRSF   = is.numeric(EA_EMPRSF),
  TI_EA_EMPRSFTX = is.numeric(EA_EMPRSFTX),
  TI_EA_RENSF    = is.numeric(EA_RENSF),
  TI_EA_RENPCSF  = is.numeric(EA_RENPCSF),
  TI_EA_EMPRSFAG = is.numeric(EA_EMPRSFAG),
  TI_EA_EMPRSFMI = is.numeric(EA_EMPRSFMI),
  TI_EA_EMPRSFIT = is.numeric(EA_EMPRSFIT),
  TI_EA_EMPRSFUP = is.numeric(EA_EMPRSFUP),
  TI_EA_EMPRSFIC = is.numeric(EA_EMPRSFIC),
  TI_EA_EMPRSFCO = is.numeric(EA_EMPRSFCO),
  TI_EA_EMPRSFSE = is.numeric(EA_EMPRSFSE)
)
```

```{r confront_type}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_type <- validate::confront(data, rules_type)

validate::summary(check_type) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |>
  kableExtra::kable_paper("hover", full_width = F)
```

## Validade

### Todos os indicadores - Valores ausentes

#### Total

```{r rules_validate_na_total}

rules_validate_na_total <- validate::validator(
  VI_NA_EA_BFFAM    = !is.na(EA_BFFAM),
  VI_NA_EA_TRFAM    = !is.na(EA_TRFAM),
  VI_NA_EA_TRPF     = !is.na(EA_TRPF),
  VI_NA_EA_BPCDEF   = !is.na(EA_BPCDEF),
  VI_NA_EA_BPCIDO   = !is.na(EA_BPCIDO),
  VI_NA_EA_BFBPC    = !is.na(EA_BFBPC),
  VI_NA_EA_TRBPCDEF = !is.na(EA_TRBPCDEF),
  VI_NA_EA_TRBPCIDO = !is.na(EA_TRBPCIDO),
  VI_NA_EA_TRBPC    = !is.na(EA_TRBPC),
  VI_NA_EA_TRBPCPB  = !is.na(EA_TRBPCPB),
  VI_NA_EA_TRBFBPC  = !is.na(EA_TRBFBPC),
  VI_NA_EA_TRPC     = !is.na(EA_TRPC),
  VI_NA_EA_TRPCBF   = !is.na(EA_TRPCBF),
  VI_NA_EA_TRPCBPC  = !is.na(EA_TRPCBPC),
  VI_NA_EA_VAAGR    = !is.na(EA_VAAGR),
  VI_NA_EA_VAIND    = !is.na(EA_VAIND),
  VI_NA_EA_VAADM    = !is.na(EA_VAADM),
  VI_NA_EA_VASERV   = !is.na(EA_VASERV),
  VI_NA_EA_VATOT    = !is.na(EA_VATOT),
  VI_NA_EA_IMPLIQ   = !is.na(EA_IMPLIQ),
  VI_NA_EA_PIB      = !is.na(EA_PIB),
  VI_NA_EA_PIBPC    = !is.na(EA_PIBPC),
  VI_NA_EA_VAFAG    = !is.na(EA_VAFAG),
  VI_NA_EA_VAF      = !is.na(EA_VAF),
  VI_NA_EA_VAFMI    = !is.na(EA_VAFMI),
  VI_NA_EA_VAFIT    = !is.na(EA_VAFIT),
  VI_NA_EA_VAFIC    = !is.na(EA_VAFIC),
  VI_NA_EA_VAFUP    = !is.na(EA_VAFUP),
  VI_NA_EA_VAFCV    = !is.na(EA_VAFCV),
  VI_NA_EA_VAFCA    = !is.na(EA_VAFCA),
  VI_NA_EA_VAFSE    = !is.na(EA_VAFSE),
  VI_NA_EA_VAFO     = !is.na(EA_VAFO),
  VI_NA_EA_VAFPC    = !is.na(EA_VAFPC),
  VI_NA_EA_VAFCVPC  = !is.na(EA_VAFCVPC),
  VI_NA_EA_EMPRSF   = !is.na(EA_EMPRSF),
  VI_NA_EA_RENSF    = !is.na(EA_RENSF),
  VI_NA_EA_RENPCSF  = !is.na(EA_RENPCSF),
  VI_NA_EA_EMPRSFAG = !is.na(EA_EMPRSFAG),
  VI_NA_EA_EMPRSFMI = !is.na(EA_EMPRSFMI),
  VI_NA_EA_EMPRSFIT = !is.na(EA_EMPRSFIT),
  VI_NA_EA_EMPRSFUP = !is.na(EA_EMPRSFUP),
  VI_NA_EA_EMPRSFIC = !is.na(EA_EMPRSFIC),
  VI_NA_EA_EMPRSFCO = !is.na(EA_EMPRSFCO),
  VI_NA_EA_EMPRSFSE = !is.na(EA_EMPRSFSE)
)
```

```{r confront_validate_na_total}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_validate_na_total <- validate::confront(data, rules_validate_na_total)

validate::summary(check_validate_na_total) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_validate_na_total}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_validate_na_total, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

#### Percentual

```{r rules_validate_na_pct}

rules_validate_na_pct <- validate::validator(
  VI_NA_EA_PVAAGR   = !is.na(EA_PVAAGR),
  VI_NA_EA_PVAIND   = !is.na(EA_PVAIND),
  VI_NA_EA_PVAADM   = !is.na(EA_PVAADM),
  VI_NA_EA_PVASERV  = !is.na(EA_PVASERV),
  VI_NA_EA_PVAFAG   = !is.na(EA_PVAFAG),
  VI_NA_EA_PVAFMI   = !is.na(EA_PVAFMI),
  VI_NA_EA_PVAFIT   = !is.na(EA_PVAFIT),
  VI_NA_EA_PVAFIC   = !is.na(EA_PVAFIC),
  VI_NA_EA_PVAFUP   = !is.na(EA_PVAFUP),
  VI_NA_EA_PVAFCV   = !is.na(EA_PVAFCV),
  VI_NA_EA_PVAFCA   = !is.na(EA_PVAFCA),
  VI_NA_EA_PVAFSE   = !is.na(EA_PVAFSE),
  VI_NA_EA_PVAFO    = !is.na(EA_PVAFO),
  VI_NA_EA_EMPRSFTX = !is.na(EA_EMPRSFTX)
)
```

```{r confront_validate_na_pct}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_validate_na_pct <- validate::confront(data, rules_validate_na_pct)

validate::summary(check_validate_na_pct) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_validate_na_pct}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_validate_na_pct, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### Todos os indicadores - Demais regras

#### Total

```{r rules_validate_others_total}

rules_validate_others_total <- validate::validator(
  VI_EA_BFFAM    = EA_BFFAM >= 0,
  VI_EA_TRFAM    = EA_TRFAM >= 0,
  VI_EA_TRPF     = EA_TRPF >= 0,
  VI_EA_BPCDEF   = EA_BPCDEF >= 0,
  VI_EA_BPCIDO   = EA_BPCIDO >= 0,
  VI_EA_BFBPC    = EA_BFBPC >= 0,
  VI_EA_TRBPCDEF = EA_TRBPCDEF >= 0,
  VI_EA_TRBPCIDO = EA_TRBPCIDO >= 0,
  VI_EA_TRBPC    = EA_TRBPC >= 0,
  VI_EA_TRBPCPB  = EA_TRBPCPB >= 0,
  VI_EA_TRBFBPC  = EA_TRBFBPC >= 0,
  VI_EA_TRPC     = EA_TRPC >= 0,
  VI_EA_TRPCBF   = EA_TRPCBF >= 0,
  VI_EA_TRPCBPC  = EA_TRPCBPC >= 0,
  VI_EA_VAAGR    = EA_VAAGR >= 0,
  VI_EA_VAIND    = EA_VAIND >= 0,
  VI_EA_VAADM    = EA_VAADM >= 0,
  VI_EA_VASERV   = EA_VASERV >= 0,
  VI_EA_VATOT    = EA_VATOT >= 0,
  VI_EA_IMPLIQ   = EA_IMPLIQ >= 0,
  VI_EA_PIB      = EA_PIB >= 0,
  VI_EA_PIBPC    = EA_PIBPC >= 0,
  VI_EA_VAFAG    = EA_VAFAG >= 0,
  VI_EA_VAF      = EA_VAF >= 0,
  VI_EA_VAFMI    = EA_VAFMI >= 0,
  VI_EA_VAFIT    = EA_VAFIT >= 0,
  VI_EA_VAFIC    = EA_VAFIC >= 0,
  VI_EA_VAFUP    = EA_VAFUP >= 0,
  VI_EA_VAFCV    = EA_VAFCV >= 0,
  VI_EA_VAFCA    = EA_VAFCA >= 0,
  VI_EA_VAFSE    = EA_VAFSE >= 0,
  VI_EA_VAFO     = EA_VAFO >= 0,
  VI_EA_VAFPC    = EA_VAFPC >= 0,
  VI_EA_VAFCVPC  = EA_VAFCVPC >= 0,
  VI_EA_EMPRSF   = EA_EMPRSF >= 0,
  VI_EA_RENSF    = EA_RENSF >= 0,
  VI_EA_RENPCSF  = EA_RENPCSF >= 0,
  VI_EA_EMPRSFAG = EA_EMPRSFAG >= 0,
  VI_EA_EMPRSFMI = EA_EMPRSFMI >= 0,
  VI_EA_EMPRSFIT = EA_EMPRSFIT >= 0,
  VI_EA_EMPRSFUP = EA_EMPRSFUP >= 0,
  VI_EA_EMPRSFIC = EA_EMPRSFIC >= 0,
  VI_EA_EMPRSFCO = EA_EMPRSFCO >= 0,
  VI_EA_EMPRSFSE = EA_EMPRSFSE >= 0
)
```

```{r confront_validate_others_total}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_validate_others_total <- validate::confront(data, rules_validate_others_total)

validate::summary(check_validate_others_total) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_validate_others_total}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_validate_others_total, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

#### Percentual

```{r rules_validate_others_pct}

rules_validate_others_pct <- validate::validator(
  VI_EA_PVAAGR   = in_range(EA_PVAAGR, min = 0, max = 100),
  VI_EA_PVAIND   = in_range(EA_PVAIND, min = 0, max = 100),
  VI_EA_PVAADM   = in_range(EA_PVAADM, min = 0, max = 100),
  VI_EA_PVASERV  = in_range(EA_PVASERV, min = 0, max = 100),
  VI_EA_PVAFAG   = in_range(EA_PVAFAG, min = 0, max = 100),
  VI_EA_PVAFMI   = in_range(EA_PVAFMI, min = 0, max = 100),
  VI_EA_PVAFIT   = in_range(EA_PVAFIT, min = 0, max = 100),
  VI_EA_PVAFIC   = in_range(EA_PVAFIC, min = 0, max = 100),
  VI_EA_PVAFUP   = in_range(EA_PVAFUP, min = 0, max = 100),
  VI_EA_PVAFCV   = in_range(EA_PVAFCV, min = 0, max = 100),
  VI_EA_PVAFCA   = in_range(EA_PVAFCA, min = 0, max = 100),
  VI_EA_PVAFSE   = in_range(EA_PVAFSE, min = 0, max = 100),
  VI_EA_PVAFO    = in_range(EA_PVAFO, min = 0, max = 100),
  VI_EA_EMPRSFTX = in_range(EA_EMPRSFTX, min = 0, max = 100)
)
```

```{r confront_validate_others_pct}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_validate_others_pct <- validate::confront(data, rules_validate_others_pct)

validate::summary(check_validate_others_pct) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_validate_others_pct}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_validate_others_pct, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

## Consistência

```{r rules_consistency}

rules_consistency <- validate::validator(
  CI_VA_total  = in_range(EA_PVAAGR + EA_PVAIND + EA_PVAADM + EA_PVASERV, min = 99.5, max = 100.9),
  CI_VAF_total = in_range(EA_PVAFAG + EA_PVAFMI + EA_PVAFIT + EA_PVAFIC + EA_PVAFUP + EA_PVAFCV + EA_PVAFCA + EA_PVAFSE + EA_PVAFO, min = 99.5, max = 100.9)
)
```

```{r confront_consistency}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_consistency <- validate::confront(data, rules_consistency)

validate::summary(check_consistency) |>
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |>
  kableExtra::kable_paper("hover", full_width = F)
```

```{r show_consistency}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_consistency, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

## Distribuição

### EA_BFFAM

```{r rules_dist_ea_bffam}

rules_dist_ea_bffam <- validate::validator(
  DF_EA_BFFAM_hampel_munic  = validate::do_by(EA_BFFAM, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_BFFAM_out_munic     = validate::do_by(EA_BFFAM, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_BFFAM_min_munic     = EA_BFFAM >= (validate::min_by(EA_BFFAM, by = IBGE7, na.rm = T) / k),
  
  DF_EA_BFFAM_max_munic     = EA_BFFAM <= (k * validate::max_by(EA_BFFAM, by = IBGE7, na.rm = T)),
  
  DF_EA_BFFAM_med_mov_munic = EA_BFFAM <= (k * validate::do_by(EA_BFFAM, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_BFFAM_dif_munic     = validate::do_by(EA_BFFAM, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_bffam}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_bffam <- validate::confront(data, rules_dist_ea_bffam)

validate::summary(check_dist_ea_bffam) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_bffam}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_bffam, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRFAM

```{r rules_dist_ea_trfam}

rules_dist_ea_trfam <- validate::validator(
  DF_EA_TRFAM_hampel_munic  = validate::do_by(EA_TRFAM, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRFAM_out_munic     = validate::do_by(EA_TRFAM, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRFAM_min_munic     = EA_TRFAM >= (validate::min_by(EA_TRFAM, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRFAM_max_munic     = EA_TRFAM <= (k * validate::max_by(EA_TRFAM, by = IBGE7, na.rm = T)),
  
  DF_EA_TRFAM_med_mov_munic = EA_TRFAM <= (k * validate::do_by(EA_TRFAM, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRFAM_dif_munic     = validate::do_by(EA_TRFAM, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trfam}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trfam <- validate::confront(data, rules_dist_ea_trfam)

validate::summary(check_dist_ea_trfam) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trfam}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trfam, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRPF

```{r rules_dist_ea_trpf}
  
rules_dist_ea_trpf <- validate::validator(
  DF_EA_TRPF_hampel_munic  = validate::do_by(EA_TRPF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRPF_out_munic     = validate::do_by(EA_TRPF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRPF_min_munic     = EA_TRPF >= (validate::min_by(EA_TRPF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRPF_max_munic     = EA_TRPF <= (k * validate::max_by(EA_TRPF, by = IBGE7, na.rm = T)),
  
  DF_EA_TRPF_med_mov_munic = EA_TRPF <= (k * validate::do_by(EA_TRPF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRPF_dif_munic     = validate::do_by(EA_TRPF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trpf}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trpf <- validate::confront(data, rules_dist_ea_trpf)

validate::summary(check_dist_ea_trpf) |>
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trpf}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trpf, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_BPCDEF

```{r rules_dist_ea_bpcde}

rules_dist_ea_bpcde <- validate::validator(
  DF_EA_BPCDEF_hampel_munic  = validate::do_by(EA_BPCDEF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_BPCDEF_out_munic     = validate::do_by(EA_BPCDEF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_BPCDEF_min_munic     = EA_BPCDEF >= (validate::min_by(EA_BPCDEF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_BPCDEF_max_munic     = EA_BPCDEF <= (k * validate::max_by(EA_BPCDEF, by = IBGE7, na.rm = T)),
  
  DF_EA_BPCDEF_med_mov_munic = EA_BPCDEF <= (k * validate::do_by(EA_BPCDEF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_BPCDEF_dif_munic     = validate::do_by(EA_BPCDEF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_bpcde}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_bpcde <- validate::confront(data, rules_dist_ea_bpcde)

validate::summary(check_dist_ea_bpcde) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_bpcde}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_bpcde, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_BPCIDO

```{r rules_dist_ea_bpcido}

rules_dist_ea_bpcido <- validate::validator(
  DF_EA_BPCIDO_hampel_munic  = validate::do_by(EA_BPCIDO, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_BPCIDO_out_munic     = validate::do_by(EA_BPCIDO, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_BPCIDO_min_munic     = EA_BPCIDO >= (validate::min_by(EA_BPCIDO, by = IBGE7, na.rm = T) / k),
  
  DF_EA_BPCIDO_max_munic     = EA_BPCIDO <= (k * validate::max_by(EA_BPCIDO, by = IBGE7, na.rm = T)),
  
  DF_EA_BPCIDO_med_mov_munic = EA_BPCIDO <= (k * validate::do_by(EA_BPCIDO, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_BPCIDO_dif_munic     = validate::do_by(EA_BPCIDO, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_bpcido}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_bpcido <- validate::confront(data, rules_dist_ea_bpcido)

validate::summary(check_dist_ea_bpcido) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_bpcido}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_bpcido, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_BFBPC

```{r rules_dist_ea_bfbpc}

rules_dist_ea_bfbpc <- validate::validator(
  DF_EA_BFBPC_hampel_munic  = validate::do_by(EA_BFBPC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_BFBPC_out_munic     = validate::do_by(EA_BFBPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_BFBPC_min_munic     = EA_BFBPC >= (validate::min_by(EA_BFBPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_BFBPC_max_munic     = EA_BFBPC <= (k * validate::max_by(EA_BFBPC, by = IBGE7, na.rm = T)),
  
  DF_EA_BFBPC_med_mov_munic = EA_BFBPC <= (k * validate::do_by(EA_BFBPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_BFBPC_dif_munic     = validate::do_by(EA_BFBPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_bfbpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_bfbpc <- validate::confront(data, rules_dist_ea_bfbpc)

validate::summary(check_dist_ea_bfbpc) |>
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_bfbpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_bfbpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRBPCDEF

```{r rules_dist_ea_trbpcdef}

rules_dist_ea_trbpcdef <- validate::validator( 
  DF_EA_TRBPCDEF_hampel_munic  = validate::do_by(EA_TRBPCDEF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRBPCDEF_out_munic     = validate::do_by(EA_TRBPCDEF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRBPCDEF_min_munic     = EA_TRBPCDEF >= (validate::min_by(EA_TRBPCDEF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRBPCDEF_max_munic     = EA_TRBPCDEF <= (k * validate::max_by(EA_TRBPCDEF, by = IBGE7, na.rm = T)),
  
  DF_EA_TRBPCDEF_med_mov_munic = EA_TRBPCDEF <= (k * validate::do_by(EA_TRBPCDEF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRBPCDEF_dif_munic     = validate::do_by(EA_TRBPCDEF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trbpcdef}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trbpcdef <- validate::confront(data, rules_dist_ea_trbpcdef)

validate::summary(check_dist_ea_trbpcdef) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trbpcdef}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trbpcdef, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRBPCIDO

```{r rules_dist_ea_trbpcido}

rules_dist_ea_trbpcido <- validate::validator(  
  DF_EA_TRBPCIDO_hampel_munic  = validate::do_by(EA_TRBPCIDO, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRBPCIDO_out_munic     = validate::do_by(EA_TRBPCIDO, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRBPCIDO_min_munic     = EA_TRBPCIDO >= (validate::min_by(EA_TRBPCIDO, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRBPCIDO_max_munic     = EA_TRBPCIDO <= (k * validate::max_by(EA_TRBPCIDO, by = IBGE7, na.rm = T)),
  
  DF_EA_TRBPCIDO_med_mov_munic = EA_TRBPCIDO <= (k * validate::do_by(EA_TRBPCIDO, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRBPCIDO_dif_munic     = validate::do_by(EA_TRBPCIDO, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trbpcido}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trbpcido <- validate::confront(data, rules_dist_ea_trbpcido)

validate::summary(check_dist_ea_trbpcido) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trbpcido}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trbpcido, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRBPC

```{r rules_dist_ea_trbpc}

rules_dist_ea_trbpc <- validate::validator(  
  DF_EA_TRBPC_hampel_munic  = validate::do_by(EA_TRBPC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRBPC_out_munic     = validate::do_by(EA_TRBPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRBPC_min_munic     = EA_TRBPC >= (validate::min_by(EA_TRBPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRBPC_max_munic     = EA_TRBPC <= (k * validate::max_by(EA_TRBPC, by = IBGE7, na.rm = T)),
  
  DF_EA_TRBPC_med_mov_munic = EA_TRBPC <= (k * validate::do_by(EA_TRBPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRBPC_dif_munic     = validate::do_by(EA_TRBPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trbpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trbpc <- validate::confront(data, rules_dist_ea_trbpc)

validate::summary(check_dist_ea_trbpc) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trbpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trbpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRBPCPB

```{r rules_dist_ea_trbpcpb}

rules_dist_ea_trbpcpb <- validate::validator( 
  DF_EA_TRBPCPB_hampel_munic  = validate::do_by(EA_TRBPCPB, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRBPCPB_out_munic     = validate::do_by(EA_TRBPCPB, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRBPCPB_min_munic     = EA_TRBPCPB >= (validate::min_by(EA_TRBPCPB, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRBPCPB_max_munic     = EA_TRBPCPB <= (k * validate::max_by(EA_TRBPCPB, by = IBGE7, na.rm = T)),
  
  DF_EA_TRBPCPB_med_mov_munic = EA_TRBPCPB <= (k * validate::do_by(EA_TRBPCPB, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRBPCPB_dif_munic     = validate::do_by(EA_TRBPCPB, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trbpcpb}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trbpcpb <- validate::confront(data, rules_dist_ea_trbpcpb)

validate::summary(check_dist_ea_trbpcpb) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trbpcpb}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trbpcpb, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRBFBPC

```{r rules_dist_ea_trbfbpc}

rules_dist_ea_trbfbpc <- validate::validator(  
  DF_EA_TRBFBPC_hampel_munic  = validate::do_by(EA_TRBFBPC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRBFBPC_out_munic     = validate::do_by(EA_TRBFBPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRBFBPC_min_munic     = EA_TRBFBPC >= (validate::min_by(EA_TRBFBPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRBFBPC_max_munic     = EA_TRBFBPC <= (k * validate::max_by(EA_TRBFBPC, by = IBGE7, na.rm = T)),
  
  DF_EA_TRBFBPC_med_mov_munic = EA_TRBFBPC <= (k * validate::do_by(EA_TRBFBPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRBFBPC_dif_munic     = validate::do_by(EA_TRBFBPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trbfbpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trbfbpc <- validate::confront(data, rules_dist_ea_trbfbpc)

validate::summary(check_dist_ea_trbfbpc) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trbfbpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trbfbpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRPC

```{r rules_dist_ea_trpc}

rules_dist_ea_trpc <- validate::validator( 
  DF_EA_TRPC_hampel_munic  = validate::do_by(EA_TRPC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRPC_out_munic     = validate::do_by(EA_TRPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRPC_min_munic     = EA_TRPC >= (validate::min_by(EA_TRPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRPC_max_munic     = EA_TRPC <= (k * validate::max_by(EA_TRPC, by = IBGE7, na.rm = T)),
  
  DF_EA_TRPC_med_mov_munic = EA_TRPC <= (k * validate::do_by(EA_TRPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRPC_dif_munic     = validate::do_by(EA_TRPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trpc <- validate::confront(data, rules_dist_ea_trpc)

validate::summary(check_dist_ea_trpc) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRPCBF

```{r rules_dist_ea_trpcbf}

rules_dist_ea_trpcbf <- validate::validator( 
  DF_EA_TRPCBF_hampel_munic  = validate::do_by(EA_TRPCBF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRPCBF_out_munic     = validate::do_by(EA_TRPCBF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRPCBF_min_munic     = EA_TRPCBF >= (validate::min_by(EA_TRPCBF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRPCBF_max_munic     = EA_TRPCBF <= (k * validate::max_by(EA_TRPCBF, by = IBGE7, na.rm = T)),
  
  DF_EA_TRPCBF_med_mov_munic = EA_TRPCBF <= (k * validate::do_by(EA_TRPCBF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRPCBF_dif_munic     = validate::do_by(EA_TRPCBF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trpcbf}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trpcbf <- validate::confront(data, rules_dist_ea_trpcbf)

validate::summary(check_dist_ea_trpcbf) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trpcbf}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trpcbf, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_TRPCBPC

```{r rules_dist_ea_trpcbpc}

rules_dist_ea_trpcbpc <- validate::validator( 
  DF_EA_TRPCBPC_hampel_munic  = validate::do_by(EA_TRPCBPC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_TRPCBPC_out_munic     = validate::do_by(EA_TRPCBPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_TRPCBPC_min_munic     = EA_TRPCBPC >= (validate::min_by(EA_TRPCBPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_TRPCBPC_max_munic     = EA_TRPCBPC <= (k * validate::max_by(EA_TRPCBPC, by = IBGE7, na.rm = T)),
  
  DF_EA_TRPCBPC_med_mov_munic = EA_TRPCBPC <= (k * validate::do_by(EA_TRPCBPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_TRPCBPC_dif_munic     = validate::do_by(EA_TRPCBPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_trpcbpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_trpcbpc <- validate::confront(data, rules_dist_ea_trpcbpc)

validate::summary(check_dist_ea_trpcbpc) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_trpcbpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_trpcbpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAAGR

```{r rules_dist_ea_vaagr}

rules_dist_ea_vaagr <- validate::validator(
  DF_EA_VAAGR_hampel_munic  = validate::do_by(EA_VAAGR, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAAGR_out_munic     = validate::do_by(EA_VAAGR, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAAGR_min_munic     = EA_VAAGR >= (validate::min_by(EA_VAAGR, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAAGR_max_munic     = EA_VAAGR <= (k * validate::max_by(EA_VAAGR, by = IBGE7, na.rm = T)),
  
  DF_EA_VAAGR_med_mov_munic = EA_VAAGR <= (k * validate::do_by(EA_VAAGR, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAAGR_dif_munic     = validate::do_by(EA_VAAGR, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vaagr}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vaagr <- validate::confront(data, rules_dist_ea_vaagr)

validate::summary(check_dist_ea_vaagr) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vaagr}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vaagr, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAIND

```{r rules_dist_ea_vaind}

rules_dist_ea_vaind <- validate::validator(
  DF_EA_VAIND_hampel_munic  = validate::do_by(EA_VAIND, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_VAIND_out_munic     = validate::do_by(EA_VAIND, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAIND_min_munic     = EA_VAIND >= (validate::min_by(EA_VAIND, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAIND_max_munic     = EA_VAIND <= (k * validate::max_by(EA_VAIND, by = IBGE7, na.rm = T)),
  
  DF_EA_VAIND_med_mov_munic = EA_VAIND <= (k * validate::do_by(EA_VAIND, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAIND_dif_munic     = validate::do_by(EA_VAIND, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vaind}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vaind <- validate::confront(data, rules_dist_ea_vaind)

validate::summary(check_dist_ea_vaind) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vaind}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vaind, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAADM

```{r rules_dist_ea_vaadm}

rules_dist_ea_vaadm <- validate::validator(
  DF_EA_VAADM_hampel_munic  = validate::do_by(EA_VAADM, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAADM_out_munic     = validate::do_by(EA_VAADM, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAADM_min_munic     = EA_VAADM >= (validate::min_by(EA_VAADM, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAADM_max_munic     = EA_VAADM <= (k * validate::max_by(EA_VAADM, by = IBGE7, na.rm = T)),
  
  DF_EA_VAADM_med_mov_munic = EA_VAADM <= (k * validate::do_by(EA_VAADM, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAADM_dif_munic     = validate::do_by(EA_VAADM, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vaadm}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vaadm <- validate::confront(data, rules_dist_ea_vaadm)

validate::summary(check_dist_ea_vaadm) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vaadm}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vaadm, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VASERV

```{r rules_dist_ea_vaserv}

rules_dist_ea_vaserv <- validate::validator(
  DF_EA_VASERV_hampel_munic  = validate::do_by(EA_VASERV, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VASERV_out_munic     = validate::do_by(EA_VASERV, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VASERV_min_munic     = EA_VASERV >= (validate::min_by(EA_VASERV, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VASERV_max_munic     = EA_VASERV <= (k * validate::max_by(EA_VASERV, by = IBGE7, na.rm = T)),
  
  DF_EA_VASERV_med_mov_munic = EA_VASERV <= (k * validate::do_by(EA_VASERV, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VASERV_dif_munic     = validate::do_by(EA_VASERV, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vaserv}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vaserv <- validate::confront(data, rules_dist_ea_vaserv)

validate::summary(check_dist_ea_vaserv) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vaserv}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vaserv, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAAGR

```{r rules_dist_ea_pvaagr}

rules_dist_ea_pvaagr <- validate::validator(
  DF_EA_PVAAGR_hampel_munic  = validate::do_by(EA_PVAAGR, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAAGR_out_munic     = validate::do_by(EA_PVAAGR, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAAGR_min_munic     = EA_PVAAGR >= (validate::min_by(EA_PVAAGR, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAAGR_max_munic     = EA_PVAAGR <= (k * validate::max_by(EA_PVAAGR, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAAGR_med_mov_munic = EA_PVAAGR <= (k * validate::do_by(EA_PVAAGR, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAAGR_dif_munic     = validate::do_by(EA_PVAAGR, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvaagr}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvaagr <- validate::confront(data, rules_dist_ea_pvaagr)

validate::summary(check_dist_ea_pvaagr) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvaagr}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvaagr, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAIND

```{r rules_dist_ea_pvaind}

rules_dist_ea_pvaind <- validate::validator(
  DF_EA_PVAIND_hampel_munic  = validate::do_by(EA_PVAIND, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAIND_out_munic     = validate::do_by(EA_PVAIND, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAIND_min_munic     = EA_PVAIND >= (validate::min_by(EA_PVAIND, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAIND_max_munic     = EA_PVAIND <= (k * validate::max_by(EA_PVAIND, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAIND_med_mov_munic = EA_PVAIND <= (k * validate::do_by(EA_PVAIND, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAIND_dif_munic     = validate::do_by(EA_PVAIND, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvaind}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvaind <- validate::confront(data, rules_dist_ea_pvaind)

validate::summary(check_dist_ea_pvaind) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvaind}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvaind, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAADM

```{r rules_dist_ea_pvaadm}

rules_dist_ea_pvaadm <- validate::validator(
  DF_EA_PVAADM_hampel_munic  = validate::do_by(EA_PVAADM, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAADM_out_munic     = validate::do_by(EA_PVAADM, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAADM_min_munic     = EA_PVAADM >= (validate::min_by(EA_PVAADM, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAADM_max_munic     = EA_PVAADM <= (k * validate::max_by(EA_PVAADM, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAADM_med_mov_munic = EA_PVAADM <= (k * validate::do_by(EA_PVAADM, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAADM_dif_munic     = validate::do_by(EA_PVAADM, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvaadm}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvaadm <- validate::confront(data, rules_dist_ea_pvaadm)

validate::summary(check_dist_ea_pvaadm) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvaadm}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvaadm, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVASERV

```{r rules_dist_ea_pvaserv}

rules_dist_ea_pvaserv <- validate::validator(
  DF_EA_PVASERV_hampel_munic  = validate::do_by(EA_PVASERV, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVASERV_out_munic     = validate::do_by(EA_PVASERV, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVASERV_min_munic     = EA_PVASERV >= (validate::min_by(EA_PVASERV, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVASERV_max_munic     = EA_PVASERV <= (k * validate::max_by(EA_PVASERV, by = IBGE7, na.rm = T)),
  
  DF_EA_PVASERV_med_mov_munic = EA_PVASERV <= (k * validate::do_by(EA_PVASERV, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVASERV_dif_munic     = validate::do_by(EA_PVASERV, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvaserv}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvaserv <- validate::confront(data, rules_dist_ea_pvaserv)

validate::summary(check_dist_ea_pvaserv) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvaserv}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvaserv, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VATOT

```{r rules_dist_ea_vatot}

rules_dist_ea_vatot <- validate::validator(
  DF_EA_VATOT_hampel_munic  = validate::do_by(EA_VATOT, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VATOT_out_munic     = validate::do_by(EA_VATOT, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VATOT_min_munic     = EA_VATOT >= (validate::min_by(EA_VATOT, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VATOT_max_munic     = EA_VATOT <= (k * validate::max_by(EA_VATOT, by = IBGE7, na.rm = T)),
  
  DF_EA_VATOT_med_mov_munic = EA_VATOT <= (k * validate::do_by(EA_VATOT, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VATOT_dif_munic     = validate::do_by(EA_VATOT, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vatot}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vatot <- validate::confront(data, rules_dist_ea_vatot)

validate::summary(check_dist_ea_vatot) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vatot}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vatot, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_IMPLIQ

```{r rules_dist_ea_impliq}

rules_dist_ea_impliq <- validate::validator(
  DF_EA_IMPLIQ_hampel_munic  = validate::do_by(EA_IMPLIQ, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_IMPLIQ_out_munic     = validate::do_by(EA_IMPLIQ, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_IMPLIQ_min_munic     = EA_IMPLIQ >= (validate::min_by(EA_IMPLIQ, by = IBGE7, na.rm = T) / k),
  
  DF_EA_IMPLIQ_max_munic     = EA_IMPLIQ <= (k * validate::max_by(EA_IMPLIQ, by = IBGE7, na.rm = T)),
  
  DF_EA_IMPLIQ_med_mov_munic = EA_IMPLIQ <= (k * validate::do_by(EA_IMPLIQ, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_IMPLIQ_dif_munic     = validate::do_by(EA_IMPLIQ, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_impliq}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_impliq <- validate::confront(data, rules_dist_ea_impliq)

validate::summary(check_dist_ea_impliq) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_impliq}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_impliq, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PIB

```{r rules_dist_ea_pib}

rules_dist_ea_pib <- validate::validator(
  DF_EA_PIB_hampel_munic  = validate::do_by(EA_PIB, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PIB_out_munic     = validate::do_by(EA_PIB, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PIB_min_munic     = EA_PIB >= (validate::min_by(EA_PIB, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PIB_max_munic     = EA_PIB <= (k * validate::max_by(EA_PIB, by = IBGE7, na.rm = T)),
  
  DF_EA_PIB_med_mov_munic = EA_PIB <= (k * validate::do_by(EA_PIB, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PIB_dif_munic     = validate::do_by(EA_PIB, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pib}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pib <- validate::confront(data, rules_dist_ea_pib)

validate::summary(check_dist_ea_pib) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pib}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pib, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PIBPC

```{r rules_dist_ea_pibpc}

rules_dist_ea_pibpc <- validate::validator(  
  DF_EA_PIBPC_hampel_munic  = validate::do_by(EA_PIBPC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PIBPC_out_munic     = validate::do_by(EA_PIBPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PIBPC_min_munic     = EA_PIBPC >= (validate::min_by(EA_PIBPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PIBPC_max_munic     = EA_PIBPC <= (k * validate::max_by(EA_PIBPC, by = IBGE7, na.rm = T)),
  
  DF_EA_PIBPC_med_mov_munic = EA_PIBPC <= (k * validate::do_by(EA_PIBPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PIBPC_dif_munic     = validate::do_by(EA_PIBPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pibpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pibpc <- validate::confront(data, rules_dist_ea_pibpc)

validate::summary(check_dist_ea_pibpc) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pibpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pibpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAF

```{r rules_dist_ea_vaf}

rules_dist_ea_vaf <- validate::validator(
  DF_EA_VAF_hampel_munic  = validate::do_by(EA_VAF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAF_out_munic     = validate::do_by(EA_VAF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAF_min_munic     = EA_VAF >= (validate::min_by(EA_VAF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAF_max_munic     = EA_VAF <= (k * validate::max_by(EA_VAF, by = IBGE7, na.rm = T)),
  
  DF_EA_VAF_med_mov_munic = EA_VAF <= (k * validate::do_by(EA_VAF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAF_dif_munic     = validate::do_by(EA_VAF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vaf}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vaf <- validate::confront(data, rules_dist_ea_vaf)

validate::summary(check_dist_ea_vaf) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vaf}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vaf, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFAG

```{r rules_dist_ea_vafag}

rules_dist_ea_vafag <- validate::validator(
  DF_EA_VAFAG_hampel_munic  = validate::do_by(EA_VAFAG, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFAG_out_munic     = validate::do_by(EA_VAFAG, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFAG_min_munic     = EA_VAFAG >= (validate::min_by(EA_VAFAG, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFAG_max_munic     = EA_VAFAG <= (k * validate::max_by(EA_VAFAG, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFAG_med_mov_munic = EA_VAFAG <= (k * validate::do_by(EA_VAFAG, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFAG_dif_munic     = validate::do_by(EA_VAFAG, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafag}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafag <- validate::confront(data, rules_dist_ea_vafag)

validate::summary(check_dist_ea_vafag) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafag}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafag, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFMI

```{r rules_dist_ea_vafmi}

rules_dist_ea_vafmi <- validate::validator(
  DF_EA_VAFMI_hampel_munic  = validate::do_by(EA_VAFMI, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFMI_out_munic     = validate::do_by(EA_VAFMI, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFMI_min_munic     = EA_VAFMI >= (validate::min_by(EA_VAFMI, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFMI_max_munic     = EA_VAFMI <= (k * validate::max_by(EA_VAFMI, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFMI_med_mov_munic = EA_VAFMI <= (k * validate::do_by(EA_VAFMI, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFMI_dif_munic     = validate::do_by(EA_VAFMI, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafmi}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafmi <- validate::confront(data, rules_dist_ea_vafmi)

validate::summary(check_dist_ea_vafmi) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafmi}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafmi, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFIT

```{r rules_dist_ea_vafit}

rules_dist_ea_vafit <- validate::validator(  
  DF_EA_VAFIT_hampel_munic  = validate::do_by(EA_VAFIT, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_VAFIT_out_munic     = validate::do_by(EA_VAFIT, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFIT_min_munic     = EA_VAFIT >= (validate::min_by(EA_VAFIT, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFIT_max_munic     = EA_VAFIT <= (k * validate::max_by(EA_VAFIT, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFIT_med_mov_munic = EA_VAFIT <= (k * validate::do_by(EA_VAFIT, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFIT_dif_munic     = validate::do_by(EA_VAFIT, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafit}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafit <- validate::confront(data, rules_dist_ea_vafit)

validate::summary(check_dist_ea_vafit) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafit}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafit, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFIC

```{r rules_dist_ea_vafic}

rules_dist_ea_vafic <- validate::validator(
  DF_EA_VAFIC_hampel_munic  = validate::do_by(EA_VAFIC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFIC_out_munic     = validate::do_by(EA_VAFIC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFIC_min_munic     = EA_VAFIC >= (validate::min_by(EA_VAFIC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFIC_max_munic     = EA_VAFIC <= (k * validate::max_by(EA_VAFIC, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFIC_med_mov_munic = EA_VAFIC <= (k * validate::do_by(EA_VAFIC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFIC_dif_munic     = validate::do_by(EA_VAFIC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafic}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafic <- validate::confront(data, rules_dist_ea_vafic)

validate::summary(check_dist_ea_vafic) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafic}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafic, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFUP

```{r rules_dist_ea_vafup}

rules_dist_ea_vafup <- validate::validator(
  DF_EA_VAFUP_hampel_munic  = validate::do_by(EA_VAFUP, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFUP_out_munic     = validate::do_by(EA_VAFUP, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFUP_min_munic     = EA_VAFUP >= (validate::min_by(EA_VAFUP, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFUP_max_munic     = EA_VAFUP <= (k * validate::max_by(EA_VAFUP, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFUP_med_mov_munic = EA_VAFUP <= (k * validate::do_by(EA_VAFUP, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFUP_dif_munic     = validate::do_by(EA_VAFUP, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafup}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafup <- validate::confront(data, rules_dist_ea_vafup)

validate::summary(check_dist_ea_vafup) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafup}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafup, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFCV

```{r rules_dist_ea_vafcv}

rules_dist_ea_vafcv <- validate::validator(  
  DF_EA_VAFCV_hampel_munic  = validate::do_by(EA_VAFCV, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFCV_out_munic     = validate::do_by(EA_VAFCV, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFCV_min_munic     = EA_VAFCV >= (validate::min_by(EA_VAFCV, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFCV_max_munic     = EA_VAFCV <= (k * validate::max_by(EA_VAFCV, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFCV_med_mov_munic = EA_VAFCV <= (k * validate::do_by(EA_VAFCV, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFCV_dif_munic     = validate::do_by(EA_VAFCV, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafcv}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafcv <- validate::confront(data, rules_dist_ea_vafcv)

validate::summary(check_dist_ea_vafcv) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafcv}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafcv, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFCA

```{r rules_dist_ea_vafca}

rules_dist_ea_vafca <- validate::validator(
  DF_EA_VAFCA_hampel_munic  = validate::do_by(EA_VAFCA, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_VAFCA_out_munic     = validate::do_by(EA_VAFCA, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFCA_min_munic     = EA_VAFCA >= (validate::min_by(EA_VAFCA, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFCA_max_munic     = EA_VAFCA <= (k * validate::max_by(EA_VAFCA, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFCA_med_mov_munic = EA_VAFCA <= (k * validate::do_by(EA_VAFCA, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFCA_dif_munic     = validate::do_by(EA_VAFCA, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafca}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafca <- validate::confront(data, rules_dist_ea_vafca)

validate::summary(check_dist_ea_vafca) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafca}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafca, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFSE

```{r rules_dist_ea_vafse}

rules_dist_ea_vafse <- validate::validator(  
  DF_EA_VAFSE_hampel_munic  = validate::do_by(EA_VAFSE, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFSE_out_munic     = validate::do_by(EA_VAFSE, by = IBGE7, fun = outlier_detection) == F,

  DF_EA_VAFSE_min_munic     = EA_VAFSE >= (validate::min_by(EA_VAFSE, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFSE_max_munic     = EA_VAFSE <= (k * validate::max_by(EA_VAFSE, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFSE_med_mov_munic = EA_VAFSE <= (k * validate::do_by(EA_VAFSE, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFSE_dif_munic     = validate::do_by(EA_VAFSE, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafse}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafse <- validate::confront(data, rules_dist_ea_vafse)

validate::summary(check_dist_ea_vafse) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafse}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafse, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFO

```{r rules_dist_ea_vafo}

rules_dist_ea_vafo <- validate::validator( 
  DF_EA_VAFO_hampel_munic  = validate::do_by(EA_VAFO, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_VAFO_out_munic     = validate::do_by(EA_VAFO, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFO_min_munic     = EA_VAFO >= (validate::min_by(EA_VAFO, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFO_max_munic     = EA_VAFO <= (k * validate::max_by(EA_VAFO, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFO_med_mov_munic = EA_VAFO <= (k * validate::do_by(EA_VAFO, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFO_dif_munic     = validate::do_by(EA_VAFO, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafo}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafo <- validate::confront(data, rules_dist_ea_vafo)

validate::summary(check_dist_ea_vafo) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafo}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafo, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFAG

```{r rules_dist_ea_pvafag}

rules_dist_ea_pvafag <- validate::validator(
  DF_EA_PVAFAG_hampel_munic  = validate::do_by(EA_PVAFAG, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFAG_out_munic     = validate::do_by(EA_PVAFAG, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFAG_min_munic     = EA_PVAFAG >= (validate::min_by(EA_PVAFAG, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFAG_max_munic     = EA_PVAFAG <= (k * validate::max_by(EA_PVAFAG, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFAG_med_mov_munic = EA_PVAFAG <= (k * validate::do_by(EA_PVAFAG, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFAG_dif_munic     = validate::do_by(EA_PVAFAG, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafag}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafag <- validate::confront(data, rules_dist_ea_pvafag)

validate::summary(check_dist_ea_pvafag) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafag}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafag, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFMI

```{r rules_dist_ea_pvafmi}

rules_dist_ea_pvafmi <- validate::validator(
  DF_EA_PVAFMI_hampel_munic  = validate::do_by(EA_PVAFMI, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFMI_out_munic     = validate::do_by(EA_PVAFMI, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFMI_min_munic     = EA_PVAFMI >= (validate::min_by(EA_PVAFMI, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFMI_max_munic     = EA_PVAFMI <= (k * validate::max_by(EA_PVAFMI, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFMI_med_mov_munic = EA_PVAFMI <= (k * validate::do_by(EA_PVAFMI, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFMI_dif_munic     = validate::do_by(EA_PVAFMI, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafmi}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafmi <- validate::confront(data, rules_dist_ea_pvafmi)

validate::summary(check_dist_ea_pvafmi) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafmi}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafmi, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFIT

```{r rules_dist_ea_pvafit}

rules_dist_ea_pvafit <- validate::validator(  
  DF_EA_PVAFIT_hampel_munic  = validate::do_by(EA_PVAFIT, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_PVAFIT_out_munic     = validate::do_by(EA_PVAFIT, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFIT_min_munic     = EA_PVAFIT >= (validate::min_by(EA_PVAFIT, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFIT_max_munic     = EA_PVAFIT <= (k * validate::max_by(EA_PVAFIT, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFIT_med_mov_munic = EA_PVAFIT <= (k * validate::do_by(EA_PVAFIT, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFIT_dif_munic     = validate::do_by(EA_PVAFIT, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafit}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafit <- validate::confront(data, rules_dist_ea_pvafit)

validate::summary(check_dist_ea_pvafit) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafit}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafit, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFIC

```{r rules_dist_ea_pvafic}

rules_dist_ea_pvafic <- validate::validator(
  DF_EA_PVAFIC_hampel_munic  = validate::do_by(EA_PVAFIC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFIC_out_munic     = validate::do_by(EA_PVAFIC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFIC_min_munic     = EA_PVAFIC >= (validate::min_by(EA_PVAFIC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFIC_max_munic     = EA_PVAFIC <= (k * validate::max_by(EA_PVAFIC, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFIC_med_mov_munic = EA_PVAFIC <= (k * validate::do_by(EA_PVAFIC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFIC_dif_munic     = validate::do_by(EA_PVAFIC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafic}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafic <- validate::confront(data, rules_dist_ea_pvafic)

validate::summary(check_dist_ea_pvafic) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafic}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafic, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFUP

```{r rules_dist_ea_pvafup}

rules_dist_ea_pvafup <- validate::validator(
  DF_EA_PVAFUP_hampel_munic  = validate::do_by(EA_PVAFUP, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFUP_out_munic     = validate::do_by(EA_PVAFUP, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFUP_min_munic     = EA_PVAFUP >= (validate::min_by(EA_PVAFUP, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFUP_max_munic     = EA_PVAFUP <= (k * validate::max_by(EA_PVAFUP, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFUP_med_mov_munic = EA_PVAFUP <= (k * validate::do_by(EA_PVAFUP, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFUP_dif_munic     = validate::do_by(EA_PVAFUP, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafup}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafup <- validate::confront(data, rules_dist_ea_pvafup)

validate::summary(check_dist_ea_pvafup) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafup}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafup, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFCV

```{r rules_dist_ea_pvafcv}

rules_dist_ea_pvafcv <- validate::validator(  
  DF_EA_PVAFCV_hampel_munic  = validate::do_by(EA_PVAFCV, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFCV_out_munic     = validate::do_by(EA_PVAFCV, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFCV_min_munic     = EA_PVAFCV >= (validate::min_by(EA_PVAFCV, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFCV_max_munic     = EA_PVAFCV <= (k * validate::max_by(EA_PVAFCV, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFCV_med_mov_munic = EA_PVAFCV <= (k * validate::do_by(EA_PVAFCV, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFCV_dif_munic     = validate::do_by(EA_PVAFCV, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafcv}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafcv <- validate::confront(data, rules_dist_ea_pvafcv)

validate::summary(check_dist_ea_pvafcv) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafcv}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafcv, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFCA

```{r rules_dist_ea_pvafca}

rules_dist_ea_pvafca <- validate::validator(
  DF_EA_PVAFCA_hampel_munic  = validate::do_by(EA_PVAFCA, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_PVAFCA_out_munic     = validate::do_by(EA_PVAFCA, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFCA_min_munic     = EA_PVAFCA >= (validate::min_by(EA_PVAFCA, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFCA_max_munic     = EA_PVAFCA <= (k * validate::max_by(EA_PVAFCA, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFCA_med_mov_munic = EA_PVAFCA <= (k * validate::do_by(EA_PVAFCA, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFCA_dif_munic     = validate::do_by(EA_PVAFCA, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafca}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafca <- validate::confront(data, rules_dist_ea_pvafca)

validate::summary(check_dist_ea_pvafca) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafca}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafca, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFSE

```{r rules_dist_ea_pvafse}

rules_dist_ea_pvafse <- validate::validator(  
  DF_EA_PVAFSE_hampel_munic  = validate::do_by(EA_PVAFSE, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFSE_out_munic     = validate::do_by(EA_PVAFSE, by = IBGE7, fun = outlier_detection) == F,

  DF_EA_PVAFSE_min_munic     = EA_PVAFSE >= (validate::min_by(EA_PVAFSE, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFSE_max_munic     = EA_PVAFSE <= (k * validate::max_by(EA_PVAFSE, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFSE_med_mov_munic = EA_PVAFSE <= (k * validate::do_by(EA_PVAFSE, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFSE_dif_munic     = validate::do_by(EA_PVAFSE, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafse}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafse <- validate::confront(data, rules_dist_ea_pvafse)

validate::summary(check_dist_ea_pvafse) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafse}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafse, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_PVAFO

```{r rules_dist_ea_pvafo}

rules_dist_ea_pvafo <- validate::validator( 
  DF_EA_PVAFO_hampel_munic  = validate::do_by(EA_PVAFO, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_PVAFO_out_munic     = validate::do_by(EA_PVAFO, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_PVAFO_min_munic     = EA_PVAFO >= (validate::min_by(EA_PVAFO, by = IBGE7, na.rm = T) / k),
  
  DF_EA_PVAFO_max_munic     = EA_PVAFO <= (k * validate::max_by(EA_PVAFO, by = IBGE7, na.rm = T)),
  
  DF_EA_PVAFO_med_mov_munic = EA_PVAFO <= (k * validate::do_by(EA_PVAFO, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_PVAFO_dif_munic     = validate::do_by(EA_PVAFO, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_pvafo}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_pvafo <- validate::confront(data, rules_dist_ea_pvafo)

validate::summary(check_dist_ea_pvafo) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_pvafo}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_pvafo, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFPC

```{r rules_dist_ea_vafpc}

rules_dist_ea_vafpc <- validate::validator(
  DF_EA_VAFPC_hampel_munic  = validate::do_by(EA_VAFPC, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_VAFPC_out_munic     = validate::do_by(EA_VAFPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFPC_min_munic     = EA_VAFPC >= (validate::min_by(EA_VAFPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFPC_max_munic     = EA_VAFPC <= (k * validate::max_by(EA_VAFPC, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFPC_med_mov_munic = EA_VAFPC <= (k * validate::do_by(EA_VAFPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFPC_dif_munic     = validate::do_by(EA_VAFPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafpc <- validate::confront(data, rules_dist_ea_vafpc)

validate::summary(check_dist_ea_vafpc) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_VAFCVPC

```{r rules_dist_ea_vafcvpc}

rules_dist_ea_vafcvpc <- validate::validator( 
  DF_EA_VAFCVPC_hampel_munic  = validate::do_by(EA_VAFCVPC, by = IBGE7, fun = hampel_filter) == F,

  DF_EA_VAFCVPC_out_munic     = validate::do_by(EA_VAFCVPC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_VAFCVPC_min_munic     = EA_VAFCVPC >= (validate::min_by(EA_VAFCVPC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_VAFCVPC_max_munic     = EA_VAFCVPC <= (k * validate::max_by(EA_VAFCVPC, by = IBGE7, na.rm = T)),
  
  DF_EA_VAFCVPC_med_mov_munic = EA_VAFCVPC <= (k * validate::do_by(EA_VAFCVPC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_VAFCVPC_dif_munic     = validate::do_by(EA_VAFCVPC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_vafcvpc}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_vafcvpc <- validate::confront(data, rules_dist_ea_vafcvpc)

validate::summary(check_dist_ea_vafcvpc) |>
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_vafcvpc}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_vafcvpc, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSF

```{r rules_dist_ea_emprsf}

rules_dist_ea_emprsf <- validate::validator(
  DF_EA_EMPRSF_hampel_munic  = validate::do_by(EA_EMPRSF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSF_out_munic     = validate::do_by(EA_EMPRSF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSF_min_munic     = EA_EMPRSF >= (validate::min_by(EA_EMPRSF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSF_max_munic     = EA_EMPRSF <= (k * validate::max_by(EA_EMPRSF, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSF_med_mov_munic = EA_EMPRSF <= (k * validate::do_by(EA_EMPRSF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSF_dif_munic     = validate::do_by(EA_EMPRSF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsf}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsf <- validate::confront(data, rules_dist_ea_emprsf)

validate::summary(check_dist_ea_emprsf) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsf}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsf, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFTX

```{r rules_dist_ea_emprsftx}

rules_dist_ea_emprsftx <- validate::validator(
  DF_EA_EMPRSFTX_hampel_munic  = validate::do_by(EA_EMPRSFTX, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFTX_out_munic     = validate::do_by(EA_EMPRSFTX, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFTX_min_munic     = EA_EMPRSFTX >= (validate::min_by(EA_EMPRSFTX, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFTX_max_munic     = EA_EMPRSFTX <= (k * validate::max_by(EA_EMPRSFTX, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFTX_med_mov_munic = EA_EMPRSFTX <= (k * validate::do_by(EA_EMPRSFTX, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFTX_dif_munic     = validate::do_by(EA_EMPRSFTX, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsftx}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsftx <- validate::confront(data, rules_dist_ea_emprsftx)

validate::summary(check_dist_ea_emprsftx) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsftx}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsftx, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_RENSF

```{r rules_dist_ea_rensf}

rules_dist_ea_rensf <- validate::validator(
  DF_EA_RENSF_hampel_munic  = validate::do_by(EA_RENSF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_RENSF_out_munic     = validate::do_by(EA_RENSF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_RENSF_min_munic     = EA_RENSF >= (validate::min_by(EA_RENSF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_RENSF_max_munic     = EA_RENSF <= (k * validate::max_by(EA_RENSF, by = IBGE7, na.rm = T)),
  
  DF_EA_RENSF_med_mov_munic = EA_RENSF <= (k * validate::do_by(EA_RENSF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_RENSF_dif_munic     = validate::do_by(EA_RENSF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_rensf}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_rensf <- validate::confront(data, rules_dist_ea_rensf)

validate::summary(check_dist_ea_rensf) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_rensf}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_rensf, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_RENPCSF

```{r rules_dist_ea_renpcsf}

rules_dist_ea_renpcsf <- validate::validator(
  DF_EA_RENPCSF_hampel_munic  = validate::do_by(EA_RENPCSF, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_RENPCSF_out_munic     = validate::do_by(EA_RENPCSF, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_RENPCSF_min_munic     = EA_RENPCSF >= (validate::min_by(EA_RENPCSF, by = IBGE7, na.rm = T) / k),
  
  DF_EA_RENPCSF_max_munic     = EA_RENPCSF <= (k * validate::max_by(EA_RENPCSF, by = IBGE7, na.rm = T)),
  
  DF_EA_RENPCSF_med_mov_munic = EA_RENPCSF <= (k * validate::do_by(EA_RENPCSF, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_RENPCSF_dif_munic     = validate::do_by(EA_RENPCSF, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_renpcsf}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_renpcsf <- validate::confront(data, rules_dist_ea_renpcsf)

validate::summary(check_dist_ea_renpcsf) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_renpcsf}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_renpcsf, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFAG

```{r rules_dist_ea_emprsfag}

rules_dist_ea_emprsfag <- validate::validator(
  DF_EA_EMPRSFAG_hampel_munic  = validate::do_by(EA_EMPRSFAG, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFAG_out_munic     = validate::do_by(EA_EMPRSFAG, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFAG_min_munic     = EA_EMPRSFAG >= (validate::min_by(EA_EMPRSFAG, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFAG_max_munic     = EA_EMPRSFAG <= (k * validate::max_by(EA_EMPRSFAG, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFAG_med_mov_munic = EA_EMPRSFAG <= (k * validate::do_by(EA_EMPRSFAG, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFAG_dif_munic     = validate::do_by(EA_EMPRSFAG, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfag}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfag <- validate::confront(data, rules_dist_ea_emprsfag)

validate::summary(check_dist_ea_emprsfag) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfag}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfag, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFMI

```{r rules_dist_ea_emprsfmi}

rules_dist_ea_emprsfmi <- validate::validator( 
  DF_EA_EMPRSFMI_hampel_munic  = validate::do_by(EA_EMPRSFMI, by = IBGE7, fun = hampel_filter) == F,
   
  DF_EA_EMPRSFMI_out_munic     = validate::do_by(EA_EMPRSFMI, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFMI_min_munic     = EA_EMPRSFMI >= (validate::min_by(EA_EMPRSFMI, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFMI_max_munic     = EA_EMPRSFMI <= (k * validate::max_by(EA_EMPRSFMI, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFMI_med_mov_munic = EA_EMPRSFMI <= (k * validate::do_by(EA_EMPRSFMI, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFMI_dif_munic     = validate::do_by(EA_EMPRSFMI, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfmi}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfmi <- validate::confront(data, rules_dist_ea_emprsfmi)

validate::summary(check_dist_ea_emprsfmi) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfmi}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfmi, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFIT

```{r rules_dist_ea_emprsfit}

rules_dist_ea_emprsfit <- validate::validator( 
  DF_EA_EMPRSFIT_hampel_munic  = validate::do_by(EA_EMPRSFIT, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFIT_out_munic     = validate::do_by(EA_EMPRSFIT, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFIT_min_munic     = EA_EMPRSFIT >= (validate::min_by(EA_EMPRSFIT, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFIT_max_munic     = EA_EMPRSFIT <= (k * validate::max_by(EA_EMPRSFIT, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFIT_med_mov_munic = EA_EMPRSFIT <= (k * validate::do_by(EA_EMPRSFIT, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFIT_dif_munic     = validate::do_by(EA_EMPRSFIT, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfit}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfit <- validate::confront(data, rules_dist_ea_emprsfit)

validate::summary(check_dist_ea_emprsfit) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfit}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfit, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFUP

```{r rules_dist_ea_emprsfup}

rules_dist_ea_emprsfup <- validate::validator(
  DF_EA_EMPRSFUP_hampel_munic  = validate::do_by(EA_EMPRSFUP, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFUP_out_munic     = validate::do_by(EA_EMPRSFUP, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFUP_min_munic     = EA_EMPRSFUP >= (validate::min_by(EA_EMPRSFUP, by = IBGE7, na.rm = T) / k),
   
  DF_EA_EMPRSFUP_max_munic     = EA_EMPRSFUP <= (k * validate::max_by(EA_EMPRSFUP, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFUP_med_mov_munic = EA_EMPRSFUP <= (k * validate::do_by(EA_EMPRSFUP, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFUP_dif_munic     = validate::do_by(EA_EMPRSFUP, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfup}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfup <- validate::confront(data, rules_dist_ea_emprsfup)

validate::summary(check_dist_ea_emprsfup) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfup}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfup, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFIC

```{r rules_dist_ea_emprsfic}

rules_dist_ea_emprsfic <- validate::validator(
  DF_EA_EMPRSFIC_hampel_munic  = validate::do_by(EA_EMPRSFIC, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFIC_out_munic     = validate::do_by(EA_EMPRSFIC, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFIC_min_munic     = EA_EMPRSFIC >= (validate::min_by(EA_EMPRSFIC, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFIC_max_munic     = EA_EMPRSFIC <= (k * validate::max_by(EA_EMPRSFIC, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFIC_med_mov_munic = EA_EMPRSFIC <= (k * validate::do_by(EA_EMPRSFIC, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFIC_dif_munic     = validate::do_by(EA_EMPRSFIC, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfic}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfic <- validate::confront(data, rules_dist_ea_emprsfic)

validate::summary(check_dist_ea_emprsfic) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfic}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfic, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFCO

```{r rules_dist_ea_emprsfco}

rules_dist_ea_emprsfco <- validate::validator( 
  DF_EA_EMPRSFCO_hampel_munic  = validate::do_by(EA_EMPRSFCO, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFCO_out_munic     = validate::do_by(EA_EMPRSFCO, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFCO_min_munic     = EA_EMPRSFCO >= (validate::min_by(EA_EMPRSFCO, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFCO_max_munic     = EA_EMPRSFCO <= (k * validate::max_by(EA_EMPRSFCO, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFCO_med_mov_munic = EA_EMPRSFCO <= (k * validate::do_by(EA_EMPRSFCO, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFCO_dif_munic     = validate::do_by(EA_EMPRSFCO, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfco}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfco <- validate::confront(data, rules_dist_ea_emprsfco)

validate::summary(check_dist_ea_emprsfco) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfco}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfco, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

### EA_EMPRSFSE

```{r rules_dist_ea_emprsfse}

rules_dist_ea_emprsfse <- validate::validator( 
  DF_EA_EMPRSFSE_hampel_munic  = validate::do_by(EA_EMPRSFSE, by = IBGE7, fun = hampel_filter) == F,
  
  DF_EA_EMPRSFSE_out_munic     = validate::do_by(EA_EMPRSFSE, by = IBGE7, fun = outlier_detection) == F,
  
  DF_EA_EMPRSFSE_min_munic     = EA_EMPRSFSE >= (validate::min_by(EA_EMPRSFSE, by = IBGE7, na.rm = T) / k),
  
  DF_EA_EMPRSFSE_max_munic     = EA_EMPRSFSE <= (k * validate::max_by(EA_EMPRSFSE, by = IBGE7, na.rm = T)),
  
  DF_EA_EMPRSFSE_med_mov_munic = EA_EMPRSFSE <= (k * validate::do_by(EA_EMPRSFSE, by = IBGE7, fun = zoo::rollmedian, k = 3, fill = NA, align = "right")),
  
  DF_EA_EMPRSFSE_dif_munic     = validate::do_by(EA_EMPRSFSE, by = IBGE7, fun = compare_first_dif) == F
)
```

```{r confront_dist_ea_emprsfse}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_dist_ea_emprsfse <- validate::confront(data, rules_dist_ea_emprsfse)

validate::summary(check_dist_ea_emprsfse) |> 
  dplyr::select(
    Regra         = name,
    `Observações` = items,
    Sucessos      = passes,
    Erros         = fails,
    Missing       = nNA
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_ea_emprsfse}
#| out-width: 100%

## Gráfico com os resultados
validate::plot(check_dist_ea_emprsfse, title = chart_title, labels = chart_label, fill = chart_palette, xlab = chart_xlab)
```

# Análise descritiva

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi sollicitudin, metus nec rhoncus posuere, leo dolor auctor neque, ut consectetur massa sem et nibh. Vivamus aliquam arcu sed ligula tincidunt, vel iaculis felis accumsan. Fusce in pellentesque erat. In vel euismod justo. Suspendisse imperdiet nulla eget dolor ornare, in viverra massa congue. Suspendisse nec vestibulum lectus. Phasellus venenatis vel turpis ut finibus. Vivamus vehicula neque sem, at ullamcorper magna finibus at. Praesent pulvinar, enim id pellentesque ultricies, magna nibh suscipit magna, at viverra dolor neque vel dolor. Quisque vestibulum orci et ex pharetra, vitae feugiat nulla sollicitudin. Suspendisse posuere aliquet.

## Tabelas

```{r show_desc_table, results='asis'}
#| column: screen-inset-right

pander::pandoc.header("Descritiva", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  pander::pandoc.table(
    table_descriptive(var), 
    decimal.mark = ",", 
    big.mark     = ".", 
    round        = 2,
    split.table  = Inf
  )
  cat("\\pagebreak\n")
}
```

```{r show_qtl_table, results='asis'}

pander::pandoc.header("Quantil", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  pander::pandoc.table(
    table_quantile(var), 
    decimal.mark = ",", 
    big.mark     = ".", 
    round        = 2, 
    split.table  = Inf
  )
  cat("\\pagebreak\n")
}
```

## Gráficos

::: {.callout-note appearance="minimal"}
Observação: os gráficos abaixo são mostrados na escala logarítmica para facilitar a visualização dos dados em certos casos. Para conferir os valores reais, consultar as tabelas descritivas.
:::

```{r show_boxplot_chart, results='asis'}
#| out-width: 100%
#| fig-format: svg

pander::pandoc.header("Gráfico de caixa (boxplot)", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  print(chart_boxplot(var))
  cat("\\pagebreak\n")
}
```

```{r show_hist_chart, results='asis'}
#| out-width: 100%
#| fig-format: svg

pander::pandoc.header("Histograma", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  print(chart_histogram(var))
  cat("\\pagebreak\n")
}
```

```{r df_viol_build}

# Criar base com as observações que violaram uma ou mais regras

## Distribuição
data_viol_dist_export <- dplyr::select(validate::violating(data, rules_dist_ea_vaind), ANO, IBGE7, EA_VAIND) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vaadm), ANO, IBGE7, EA_VAADM), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vaserv), ANO, IBGE7, EA_VASERV), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvaagr), ANO, IBGE7, EA_PVAAGR), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvaind), ANO, IBGE7, EA_PVAIND), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvaadm), ANO, IBGE7, EA_PVAADM), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvaserv), ANO, IBGE7, EA_PVASERV), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vatot), ANO, IBGE7, EA_VATOT), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_impliq), ANO, IBGE7, EA_IMPLIQ), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pib), ANO, IBGE7, EA_PIB), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pibpc), ANO, IBGE7, EA_PIBPC), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vaf), ANO, IBGE7, EA_VAF), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafag), ANO, IBGE7, EA_VAFAG), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafmi), ANO, IBGE7, EA_VAFMI), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafit), ANO, IBGE7, EA_VAFIT), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafic), ANO, IBGE7, EA_VAFIC), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafup), ANO, IBGE7, EA_VAFUP), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafcv), ANO, IBGE7, EA_VAFCV), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafca), ANO, IBGE7, EA_VAFCA), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafse), ANO, IBGE7, EA_VAFSE), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafo), ANO, IBGE7, EA_VAFO), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafag), ANO, IBGE7, EA_PVAFAG), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafmi), ANO, IBGE7, EA_PVAFMI), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafit), ANO, IBGE7, EA_PVAFIT), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafic), ANO, IBGE7, EA_PVAFIC), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafup), ANO, IBGE7, EA_PVAFUP), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafcv), ANO, IBGE7, EA_PVAFCV), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafca), ANO, IBGE7, EA_PVAFCA), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafse), ANO, IBGE7, EA_PVAFSE), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_pvafo), ANO, IBGE7, EA_PVAFO), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafpc), ANO, IBGE7, EA_VAFPC), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_vafcvpc), ANO, IBGE7, EA_VAFCVPC), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsf), ANO, IBGE7, EA_EMPRSF), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsftx), ANO, IBGE7, EA_EMPRSFTX), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_rensf), ANO, IBGE7, EA_RENSF), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_renpcsf), ANO, IBGE7, EA_RENPCSF), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfag), ANO, IBGE7, EA_EMPRSFAG), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfmi), ANO, IBGE7, EA_EMPRSFMI), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfit), ANO, IBGE7, EA_EMPRSFIT), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfup), ANO, IBGE7, EA_EMPRSFUP), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfic), ANO, IBGE7, EA_EMPRSFIC), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfco), ANO, IBGE7, EA_EMPRSFCO), by = dplyr::join_by(ANO, IBGE7)) |> 
dplyr::full_join(dplyr::select(validate::violating(data, rules_dist_ea_emprsfse), ANO, IBGE7, EA_EMPRSFSE), by = dplyr::join_by(ANO, IBGE7)) |> 
  dplyr::arrange(ANO, IBGE7)
```

```{r df_viol_export}

# Exportar base com as observações que violaram uma ou mais regras
pt <- openxlsx::createWorkbook()

#openxlsx::addWorksheet(pt, "Regra consistência")
openxlsx::addWorksheet(pt, "Regra distribuição")

#openxlsx::writeData(pt, "Regra consistência", data_viol_consist_export)
openxlsx::writeData(pt, "Regra distribuição", data_viol_dist_export)

openxlsx::saveWorkbook(pt, "fjpdados_economia_violacoes.xlsx", overwrite = T)
```
