---
title: FJP Dados
subtitle: Demografia
description: Relatório contendo uma análise descritiva e os resultados das regras de crítica dos dados da dimensão.
author: 
  name: Coordenação de Indicadores Sociais (CIS)
  affiliation: 
    name: Diretoria de Estatística e Informações (Direi)
    address: Alameda das Acácias, 70 - São Luiz 
    city: Belo Horizonte
    state: Minas Gerais
    postal-code: 31.275-150
    url: https://fjp.mg.gov.br/
lang: pt
date: today
title-block-banner: "#6B5E9B"
title-block-banner-color: "#ffffff"
format: 
  html:
    embed-resources: true
    smooth-scroll: true
    toc: true
    toc-location: left
    toc-title: MENU
    linkcolor: "#6B5E9B"
    css: css/all_custom.css
    theme:
      light: [flatly, css/hs_custom.scss]
editor: visual
execute:
  echo: false
  warning: false
  error: false
  message: false
params:
  data: file.xlsx
output-file: "da_relatorio.html"
---

```{r  setup, include=FALSE}

table_descriptive <- function(variable, data){
  res <- data |>
    dplyr::group_by(ANO) |>
    dplyr::summarise(
      N = dplyr::n(),
      `Mínimo`=dplyr::na_if(min(.data[[variable]], na.rm = TRUE), Inf),
      `Média`  = mean(.data[[variable]], na.rm = TRUE),
      Mediana  = median(.data[[variable]], na.rm = TRUE),
      `Máximo` = dplyr::na_if(max(.data[[variable]], na.rm = TRUE), -Inf),
      `D. P.`  = sd(.data[[variable]], na.rm = TRUE),
      `C. V.`  = sd(.data[[variable]], na.rm = TRUE)/mean(.data[[variable]], na.rm = TRUE),
      Zero     = sum(.data[[variable]] == 0, na.rm = T),
      Ausentes  = sum(is.na(.data[[variable]])),
      .groups = "drop")

    return(res)
}

table_quantile <- function(variable, data){
  result <- data  |>
    dplyr::group_by(ANO)  |>
    dplyr::summarise(value = stats::quantile(.data[[variable]], probs = c(.25, .75), na.rm = T),
                     .groups  = "drop")  |>
    dplyr::mutate(quantil = rep(c("25%", "75%"),length(unique(ANO))) ) |>
    tidyr::pivot_wider(id_cols = ANO, values_from = value, names_from = quantil)
  return(result)
}

chart_boxplot <- function(variable, data){
  result <- data  |>
    ggplot2::ggplot(ggplot2::aes(x = as.character(ANO), y = log(.data[[variable]] + 1), fill = as.character(ANO))) +
    ggplot2::geom_boxplot() +
    ggplot2::scale_fill_viridis_d(option = "G", direction = -1) + # G: mako
    ggplot2::labs(
      y = paste0("Escala logarítmica de ", variable)
    ) +
    ggplot2::theme_minimal() +
    ggplot2::theme(
      legend.position = "none",
      axis.title.x    = ggplot2::element_blank(),
      axis.text.x     = ggplot2::element_text(angle = 90, vjust = 0.5, hjust = 1)
    )

  return(result)
}


chart_histogram <- function(variable, data){
  result <- data |>
    dplyr::mutate(ANO = as.numeric(ANO)) |>
    ggplot2::ggplot(ggplot2::aes(x = log(.data[[variable]] + 1), fill = ANO)) +
    ggplot2::geom_histogram() +
    ggplot2::scale_fill_viridis_c(option = "mako", direction = -1) + # G: mako
    ggplot2::labs(
      y = paste0("Escala logarítmica de ", variable)
    ) +
    ggplot2::theme_minimal() +
    ggplot2::theme(
      legend.position = "none",
      axis.title      = ggplot2::element_blank(),
      axis.ticks      = ggplot2::element_blank()
    ) +
    ggplot2::facet_wrap(~ANO, ncol = 4)

  return(result)
}

chart_bar <- function(ano, n){
  result <- data.frame(ano, n) |>
    ggplot2::ggplot(ggplot2::aes(x = as.character(ano), y = as.integer(n))) +
    ggplot2::geom_bar(stat = "identity", fill = "#cccccc") +
    ggplot2::scale_y_continuous(
      labels = scales::label_number(big.mark = ".", decimal.mark = ",")
    ) +
    ggplot2::labs(
      title = "Observações suspeitas por ano",
      y     = "Total\n"
    ) +
    ggplot2::theme_minimal() +
    ggplot2::theme(
       legend.position = "none",
       axis.title.x    = ggplot2::element_blank(),
       axis.text.x     = ggplot2::element_text(angle = 90, vjust = 0.5, hjust = 1)
    )

  return(result)
}

# Build horizontal bar chart
chart_hbar <- function(ano, n){
  result <-
    data.frame(ano, n) |>
    ggplot2::ggplot(ggplot2::aes(x = as.character(ano), y = as.integer(n))) +
    ggplot2::geom_bar(stat = "identity", fill = "#cccccc") +
    ggplot2::scale_y_continuous(
      labels = scales::label_number(big.mark = ".", decimal.mark = ",")
    ) +
    ggplot2::labs(
      title = "Observações suspeitas por ano",
      y     = "Total\n"
    ) +
    ggplot2::theme_minimal() +
    ggplot2::theme(
       legend.position = "none",
       axis.title.x    = ggplot2::element_blank(),
       axis.text.x     = ggplot2::element_text(angle = 90, vjust = 0.5, hjust = 1)
    )

  return(print(result))
}

# Build vertical bar chart
chart_vbar <- function(df){
  result <-
    df |>
    dplyr::group_by(Regra) |>
    dplyr::summarise(
      Validada = round(sum(Validada) / sum(Total) * 100, 2),
      Suspeita = round(sum(Suspeita) / sum(Total) * 100, 2),
      Ausente  = round(sum(Ausente) / sum(Total) * 100, 2)
    ) |>
    dplyr::mutate(Regra = stringr::str_remove(Regra, "DF_[[:upper:]]{2}_[[:alnum:]]+_")) |>
    tidyr::pivot_longer(cols = !Regra, names_to = "categoria", values_to = "pct") |>
    ggplot2::ggplot(ggplot2::aes(x = pct, y = Regra, fill = categoria)) +
    ggplot2::geom_bar(position = "stack", stat = "identity") +
    ggplot2::scale_fill_brewer(palette = "Set2") +
    ggplot2::scale_x_continuous(
      labels = scales::label_percent(scale = 1, big.mark = ".", decimal.mark = ",")
    ) +
    ggplot2::labs(
      title = "Percentual geral de classificação das observações por regra",
      x     = NULL,
      y     = "Regra\n",
      fill  = NULL
    ) +
    ggplot2::theme_minimal() +
    ggplot2::theme(
      legend.position = "top"
    )

  return(print(result))
}

# Build heatmap
chart_heatmap <- function(df){
  result <-
    df |>
    dplyr::mutate(
      Ano   = as.character(Ano),
      Regra = stringr::str_remove(Regra, "DF_[[:upper:]]{2}_[[:alnum:]]+_")
    ) |>
    ggplot2::ggplot(ggplot2::aes(x = Regra, y = Ano, fill = Suspeita)) +
    ggplot2::geom_tile() +
    ggplot2::geom_text(ggplot2::aes(label = Suspeita), size = 3) +
    ggplot2::scale_fill_distiller(palette = "OrRd", direction = 1) +
    ggplot2::labs(
      title = "Total de observações suspeitas por regra e ano",
      x     = "\nRegra",
      y     = "Ano\n"
    ) +
    ggplot2::theme_minimal() +
    ggplot2::theme(
      legend.position = "None",
      axis.text.x     = ggplot2::element_text(angle = 45, hjust = 1)
    )

  return(print(result))
}

difpercentual <- function(df, variable){
  df |>
    dplyr::group_by(ANO) |>
    dplyr::mutate(total = sum({{variable}}, na.rm = TRUE)) |>
    dplyr::ungroup() |>
    dplyr::group_by(IBGE7) |>
    dplyr::summarise(ANO = ANO,
                     {{variable}} := {{variable}},
                     part = {{variable}}/total,
                     part_lag = dplyr::lag(part, n = 1),
                     dif_prop = part - part_lag,
                     .groups = "drop")
}

outlier_function <- function(variable, a=-4,b=3){
  q1 <- stats::quantile(variable, probs = 0.25, na.rm = T, names = F)
  q3 <- stats::quantile(variable, probs = 0.75, na.rm = T, names = F)
  iqr <- stats::IQR(variable, na.rm = T)
  mc <- robustbase::mc(variable, na.rm = T)
  inf <- q1 - 1.5*exp(a*mc)*iqr
  sup <- q3 + 1.5*exp(b*mc)*iqr

  check <- ifelse(variable < inf | variable > sup, T, F)

  return(check)
}

hampel_filter <- function(variable){
  limite_inf = stats::median(variable, na.rm = T) - 3 * stats::mad(variable, constant = 1, na.rm = T)
  limite_sup = stats::median(variable, na.rm = T) + 3 * stats::mad(variable, constant = 1, na.rm = T)
  result = (variable < limite_inf | variable > limite_sup)
  return(result)
}


compare_first_dif <- function(var){
  dif <- abs(round(c(NA_real_, diff(var)), 2))
  dif_max <- max(dplyr::lag(dif), na.rm = T)
  check <- ifelse(dif > dif_max, TRUE, FALSE)

  return(check)
}

compare_lag <- function(var){
  return(var >= dplyr::lag(var, n = 1))
}

```

```{r set_param_global}

k <- 1.5 

## "Truque" para setar "k" como uma constante
lockBinding("k", globalenv())

## Parâmetros para os gráficos do validate::
# chart_title <- "Sumário da validação por regra estabelecida"
# chart_label <- c("Suspeita", "Validada", "Ausente", "Total")
# chart_palette <- c("#ff985a", "#9fc0de", "#cccccc")
# chart_xlab <- ""
```

```{r import_data}

data <- openxlsx::read.xlsx(params$data)
```

```{r get_var_numeric}

# Obter as siglas das variáveis do tipo numérico
var_numeric <- data |> 
  dplyr::select(
    !c("CHAVE", "IBGE6", "IBGE7", "ANO", "DA_AREA") & dplyr::where(is.numeric)
  ) |> 
  colnames() |> 
  unlist()
```

```{r get_var_character}

# Obter as siglas variáveis do tipo string
var_char <- data |> 
  dplyr::select(
    !c("CHAVE", "IBGE6", "IBGE7", "ANO", "DA_AREA") & dplyr::where(is.character)
  ) |> 
  colnames() |> 
  unlist()
```

# Introdução

A **crítica de dados** refere-se ao processo de verificação e validação da integridade dos dados. Esse processo é crucial para garantir a qualidade dos dados antes de serem utilizados para análises ou publicizados. A importância da crítica de dados reside na sua capacidade de identificar valores suspeitos ou inconsistências que poderiam comprometer a confiabilidade dos resultados obtidos a partir desses dados.

# Regras de crítica

As **regras de crítica** são diretrizes ou critérios específicos estabelecidos para avaliar se os dados atendem aos padrões de qualidade desejados. Essas regras podem incluir a verificação de intervalos de valores aceitáveis, a consistência lógica entre diferentes variáveis, e a detecção de valores ausentes, entre outras. Aplicar essas regras de maneira sistemática ajuda a assegurar que os dados sejam precisos, completos e adequados para seu propósito, promovendo a confiança nas análises e nas decisões baseadas em dados. A padronização dos nomes permite que seja possível a identificação da classificação da regra e a presença do atributo de flexibilidade. Define-se a seguinte proposta de nomenclatura para as regras de crítica:

*1 carácter indicando finalidade + 1 carácter indicando flexibilidade + Sigla da variável*

**Classificação por finalidade**

Tipo (T): refere-se a classe da variável, são realizadas verificações no sentido de identificar se os dados são numéricos, caracteres, lógicos, entre outros.

-   **TI\_\[...\]**: tipo do dado está de acordo com o esperado (numérico, textual ou categórico).

Validade ou Intervalo (V): refere-se aos intervalos estabelecidos matematicamente para um dado ou indicador. Verificações de valores positivos, intervalos entre 0 e 1, são exemplos de verificação de validades, além da verificação de valores ausentes;

-   **VI_NA\_\[...\]**: dado não tem valor ausente/*missing*;

-   **VI\_\[...\]**: dado é não negativo, está devidamente categorizado ou está entre o intervalo esperado (ex.: 0% e 100%).

Consistência (C): refere-se aos casos em que se verificam as relações matemáticas com outras variáveis, por exemplo, parcelas de um total não podem ser maiores do que o próprio total.

-   **CF\_\[...\]\_total_year**: a soma da proporção anual é igual a $\approx$ 100%.

Distribuição (D): regras de distribuição estabelecem parâmetros esperados para as estatísticas descritivas da variável como média, mediana, máximo, mínimo e regras de identificação de *outliers*;

-   **DF\_\[...\]\_hampel_munic**: método de identificação de um possível valor *outlier* na série histórica; - **DF\_\[...\]\_out_munic**: segundo método de identificação de um possível valor *outlier* na série histórica;

-   **DF\_\[...\]\_min_munic**: o valor mais recente é maior ou igual ao menor valor da série histórica;

-   **DF\_\[...\]\_max_munic**: o valor mais recente é menor ou igual ao maior valor da série histórica;

-   **DF\_\[...\]\_min_k_munic**: o valor mais recente é maior ou igual ao $\frac{menor}{k}$ valor da série histórica;

-   **DF\_\[...\]\_max_k_munic**: o valor mais recente é menor ou igual ao $maior \times k$ valor da série histórica;

-   **DF\_\[...\]\_med_mov_munic:** o valor atual é menor ou igual a $\text{mediana móvel} \times k$;

-   **DF\_\[...\]\_dif_munic**: o valor mais recente da primeira diferença é menor ou igual ao maior valor da primeira diferença da série histórica;

-   **DF\_\[...\]\_estoque_munic**: valor atual é maior ou igual ao valor imediatamente anterior.

**Classificação por flexibilidade (F ou I)**

-   Flexível (F): construída com parâmetros esperados, mas caso algum caso falhe a regra, precisa ser investigado o motivo, identificando se é o caso de um valor atípico explicado por alguma situação.

-   Inflexível (I): necessariamente precisa ser seguida, uma regra inflexível é rígida e não existe exceção a sua condição estipulada.

```{r set_year}

# Inserir aqui apenas aquelas variáveis que possuem alguma restrição 
# no ano inicial de análise devido a fatores como mudança de metodologia
# ano_base_alter <- c(
#   "MA_ICMSECOLOG" = 2010
# )

# Remover os comentários para utilizar este trecho caso não haja nenhuma restrição
# para nenhuma variável
ano_base_alter <- c(
  "NA" = NA_integer_
)
```

```{r get_cat}

## Categorias varíaveis dicotômicas
# cat_dic <- c(
#   "Sim",
#   "Não"
# )

## Categorias encontradas na série histórica
# cat_disposlixo <- c(
#   "AAF em verificação",
#   "AS Não Regularizado",
#   "AS Regularizado",
#   "AS+UTC Não Regularizados",
#   "AS+UTC Regularizados",
#   "Aterro Controlado",
#   "Fora do Estado",
#   "Lixão",
#   "UTC Não Regularizada",
#   "UTC Regularizada"
#   )
```

```{r map_valid_desc}

# Mapear variável e descrição de sua respectiva regra de validade para ser apresentado na tabela.
desc_regra_valid <- c(
  # Casos mais comuns
  `1` = "Valor é ≥ 0",
  `2` = "Valor está dentro da categoria esperada",
  `3` = "Valor está dentro da faixa esperada (0 a 100)",
  `4` = "Valor está dentro da faixa esperada (0 a 1000)",
  `5` = "Valor está dentro da faixa esperada (0 a 10000)",
  `6` = "Valor está dentro da faixa esperada (0 a 100000)",
  # Casos especiais
  `7` = "Valor é ≥ 1", # SP_PM e SP_PMPC
  `8` = "Valor é ≥ 8", # SP_PM1
  `9`  = "Valor está dentro da faixa esperada (0 a 0,33)", # HS_POLITICA e HS_PLANOSAN
  `10` = "Valor está dentro da faixa esperada (0 a 0,34)", # HS_CONSELHO
  `11` = "Valor está dentro da faixa esperada (0 a 1)"     # HS_GESTAO
)

# df com o nome da regra e a respectiva descrição
desc_regra_valid_var <- data.frame(
  Regra = c(
    "VI_DA_POPT",
    "VI_DA_POPTA",
    "VI_DA_POPP0",
    "VI_DA_POPP1A4",
    "VI_DA_POPP4",
    "VI_DA_POPP5",
    "VI_DA_POPP4E5",
    "VI_DA_POPP5A9",
    "VI_DA_POPP6A14",
    "VI_DA_POPP10A14",
    "VI_DA_POPP15",
    "VI_DA_POPP15A17",
    "VI_DA_POPP15A19",
    "VI_DA_POPP15M",
    "VI_DA_POPP16A19",
    "VI_DA_POPP16A64",
    "VI_DA_POPP18M",
    "VI_DA_POPP20A24",
    "VI_DA_POPP25A29",
    "VI_DA_POPP30A34",
    "VI_DA_POPP35A39",
    "VI_DA_POPP40A44",
    "VI_DA_POPP45A49",
    "VI_DA_POPP50A54",
    "VI_DA_POPP55A59",
    "VI_DA_POPP60A64",
    "VI_DA_POPP65A69",
    "VI_DA_POPP70A74",
    "VI_DA_POPP75A79",
    "VI_DA_POPP80M",
    "VI_DA_DENSP",
    "VI_DA_PROPP4E5",
    "VI_DA_PROPP0A5",
    "VI_DA_PROPP6A17",
    "VI_DA_RDEPP",
    "VI_DA_PROPP15N",
    "VI_DA_PROPP65M",
    "VI_DA_INDENVE",
    "VI_DA_POPPURB",
    "VI_DA_TFT",
    "VI_DA_TMI",
    "VI_DA_ESPVIDA",
    "VI_DA_TBM",
    "VI_DA_TBN",
    "VI_DA_TCV",
    "VI_DA_TLM",
    "VI_DA_TCD",
    "VI_DA_EMIGRA",
    "VI_DA_IMIGRA",
    "VI_DA_HOMEM0A4",
    "VI_DA_HOMEM5A9",
    "VI_DA_HOMEM10A14",
    "VI_DA_HOMEM15A19",
    "VI_DA_HOMEM20A24",
    "VI_DA_HOMEM25A29",
    "VI_DA_HOMEM30A34",
    "VI_DA_HOMEM35A39",
    "VI_DA_HOMEM40A44",
    "VI_DA_HOMEM45A49",
    "VI_DA_HOMEM50A54",
    "VI_DA_HOMEM55A59",
    "VI_DA_HOMEM60A64",
    "VI_DA_HOMEM65A69",
    "VI_DA_HOMEM70A74",
    "VI_DA_HOMEM75A79",
    "VI_DA_HOMEM80",
    "VI_DA_MULH0A4",
    "VI_DA_MULH5A9",
    "VI_DA_MULH10A14",
    "VI_DA_MULH15A19",
    "VI_DA_MULH20A24",
    "VI_DA_MULH25A29",
    "VI_DA_MULH30A34",
    "VI_DA_MULH35A39",
    "VI_DA_MULH40A44",
    "VI_DA_MULH45A49",
    "VI_DA_MULH50A54",
    "VI_DA_MULH55A59",
    "VI_DA_MULH60A64",
    "VI_DA_MULH65A69",
    "VI_DA_MULH70A74",
    "VI_DA_MULH75A79",
    "VI_DA_MULHER80",
    "VI_DA_HOMEMTOT",
    "VI_DA_MULHERTOT"
  )
) |> 
  dplyr::mutate(
    `Descrição` = dplyr::case_match(
      Regra,
    "VI_DA_POPT"       ~ desc_regra_valid[1],
    "VI_DA_POPTA"      ~ desc_regra_valid[1],
    "VI_DA_POPP0"      ~ desc_regra_valid[1],
    "VI_DA_POPP1A4"    ~ desc_regra_valid[1],
    "VI_DA_POPP4"      ~ desc_regra_valid[1],
    "VI_DA_POPP5"      ~ desc_regra_valid[1],
    "VI_DA_POPP4E5"    ~ desc_regra_valid[1],
    "VI_DA_POPP5A9"    ~ desc_regra_valid[1],
    "VI_DA_POPP6A14"   ~ desc_regra_valid[1],
    "VI_DA_POPP10A14"  ~ desc_regra_valid[1],
    "VI_DA_POPP15"     ~ desc_regra_valid[1],
    "VI_DA_POPP15A17"  ~ desc_regra_valid[1],
    "VI_DA_POPP15A19"  ~ desc_regra_valid[1],
    "VI_DA_POPP15M"    ~ desc_regra_valid[1],
    "VI_DA_POPP16A19"  ~ desc_regra_valid[1],
    "VI_DA_POPP16A64"  ~ desc_regra_valid[1],
    "VI_DA_POPP18M"    ~ desc_regra_valid[1],
    "VI_DA_POPP20A24"  ~ desc_regra_valid[1],
    "VI_DA_POPP25A29"  ~ desc_regra_valid[1],
    "VI_DA_POPP30A34"  ~ desc_regra_valid[1],
    "VI_DA_POPP35A39"  ~ desc_regra_valid[1],
    "VI_DA_POPP40A44"  ~ desc_regra_valid[1],
    "VI_DA_POPP45A49"  ~ desc_regra_valid[1],
    "VI_DA_POPP50A54"  ~ desc_regra_valid[1],
    "VI_DA_POPP55A59"  ~ desc_regra_valid[1],
    "VI_DA_POPP60A64"  ~ desc_regra_valid[1],
    "VI_DA_POPP65A69"  ~ desc_regra_valid[1],
    "VI_DA_POPP70A74"  ~ desc_regra_valid[1],
    "VI_DA_POPP75A79"  ~ desc_regra_valid[1],
    "VI_DA_POPP80M"    ~ desc_regra_valid[1],
    "VI_DA_DENSP"      ~ desc_regra_valid[1],
    "VI_DA_PROPP4E5"   ~ desc_regra_valid[3],
    "VI_DA_PROPP0A5"   ~ desc_regra_valid[3],
    "VI_DA_PROPP6A17"  ~ desc_regra_valid[3],
    "VI_DA_RDEPP"      ~ desc_regra_valid[3],
    "VI_DA_PROPP15N"   ~ desc_regra_valid[3],
    "VI_DA_PROPP65M"   ~ desc_regra_valid[3],
    "VI_DA_INDENVE"    ~ desc_regra_valid[3],
    "VI_DA_POPPURB"    ~ desc_regra_valid[3],
    "VI_DA_TFT"        ~ desc_regra_valid[1],
    "VI_DA_TMI"        ~ desc_regra_valid[4],
    "VI_DA_ESPVIDA"    ~ desc_regra_valid[1],
    "VI_DA_TBM"        ~ desc_regra_valid[4],
    "VI_DA_TBN"        ~ desc_regra_valid[4],
    "VI_DA_TCV"        ~ desc_regra_valid[1],
    "VI_DA_TLM"        ~ desc_regra_valid[4],
    "VI_DA_TCD"        ~ desc_regra_valid[1],
    "VI_DA_EMIGRA"     ~ desc_regra_valid[1],
    "VI_DA_IMIGRA"     ~ desc_regra_valid[1],
    "VI_DA_HOMEM0A4"   ~ desc_regra_valid[1],
    "VI_DA_HOMEM5A9"   ~ desc_regra_valid[1],
    "VI_DA_HOMEM10A14" ~ desc_regra_valid[1],
    "VI_DA_HOMEM15A19" ~ desc_regra_valid[1],
    "VI_DA_HOMEM20A24" ~ desc_regra_valid[1],
    "VI_DA_HOMEM25A29" ~ desc_regra_valid[1],
    "VI_DA_HOMEM30A34" ~ desc_regra_valid[1],
    "VI_DA_HOMEM35A39" ~ desc_regra_valid[1],
    "VI_DA_HOMEM40A44" ~ desc_regra_valid[1],
    "VI_DA_HOMEM45A49" ~ desc_regra_valid[1],
    "VI_DA_HOMEM50A54" ~ desc_regra_valid[1],
    "VI_DA_HOMEM55A59" ~ desc_regra_valid[1],
    "VI_DA_HOMEM60A64" ~ desc_regra_valid[1],
    "VI_DA_HOMEM65A69" ~ desc_regra_valid[1],
    "VI_DA_HOMEM70A74" ~ desc_regra_valid[1],
    "VI_DA_HOMEM75A79" ~ desc_regra_valid[1],
    "VI_DA_HOMEM80"    ~ desc_regra_valid[1],
    "VI_DA_MULH0A4"    ~ desc_regra_valid[1],
    "VI_DA_MULH5A9"    ~ desc_regra_valid[1],
    "VI_DA_MULH10A14"  ~ desc_regra_valid[1],
    "VI_DA_MULH15A19"  ~ desc_regra_valid[1],
    "VI_DA_MULH20A24"  ~ desc_regra_valid[1],
    "VI_DA_MULH25A29"  ~ desc_regra_valid[1],
    "VI_DA_MULH30A34"  ~ desc_regra_valid[1],
    "VI_DA_MULH35A39"  ~ desc_regra_valid[1],
    "VI_DA_MULH40A44"  ~ desc_regra_valid[1],
    "VI_DA_MULH45A49"  ~ desc_regra_valid[1],
    "VI_DA_MULH50A54"  ~ desc_regra_valid[1],
    "VI_DA_MULH55A59"  ~ desc_regra_valid[1],
    "VI_DA_MULH60A64"  ~ desc_regra_valid[1],
    "VI_DA_MULH65A69"  ~ desc_regra_valid[1],
    "VI_DA_MULH70A74"  ~ desc_regra_valid[1],
    "VI_DA_MULH75A79"  ~ desc_regra_valid[1],
    "VI_DA_MULHER80"   ~ desc_regra_valid[1],
    "VI_DA_HOMEMTOT"   ~ desc_regra_valid[1],
    "VI_DA_MULHERTOT"  ~ desc_regra_valid[1]
    )
  )
```

```{r map_consist_desc}

# Mapear variável e descrição de sua respectiva regra de consistência para ser apresentado na tabela.
# desc_regra_consist <- c(
#   `1` = "A soma da proporção anual é igual a 100%" # MA_FOCOS
# )
# 
# # df com o nome da regra e a respectiva descrição
# desc_regra_consist_var <- data.frame(
#   Regra = c(
#     "CF_MA_FOCOS_total_year"
#   )
# ) |> 
#   dplyr::mutate(
#     `Descrição` = dplyr::case_match(
#       Regra,
#       "CF_MA_FOCOS_total_year" ~ desc_regra_consist[1]
#     )
#   )
```

## Tipo

### Todos os indicadores

```{r rules_type}
  
rules_type <- validate::validator(
 TI_DA_POPT       = is.numeric(DA_POPT),
 TI_DA_POPTA      = is.numeric(DA_POPTA),
 TI_DA_POPP0      = is.numeric(DA_POPP0),
 TI_DA_POPP1A4    = is.numeric(DA_POPP1A4),
 TI_DA_POPP4      = is.numeric(DA_POPP4),
 TI_DA_POPP5      = is.numeric(DA_POPP5),
 TI_DA_POPP4E5    = is.numeric(DA_POPP4E5),
 TI_DA_POPP5A9    = is.numeric(DA_POPP5A9),
 TI_DA_POPP6A14   = is.numeric(DA_POPP6A14),
 TI_DA_POPP10A14  = is.numeric(DA_POPP10A14),
 TI_DA_POPP15     = is.numeric(DA_POPP15),
 TI_DA_POPP15A17  = is.numeric(DA_POPP15A17),
 TI_DA_POPP15A19  = is.numeric(DA_POPP15A19),
 TI_DA_POPP15M    = is.numeric(DA_POPP15M),
 TI_DA_POPP16A19  = is.numeric(DA_POPP16A19),
 TI_DA_POPP16A64  = is.numeric(DA_POPP16A64),
 TI_DA_POPP18M    = is.numeric(DA_POPP18M),
 TI_DA_POPP20A24  = is.numeric(DA_POPP20A24),
 TI_DA_POPP25A29  = is.numeric(DA_POPP25A29),
 TI_DA_POPP30A34  = is.numeric(DA_POPP30A34),
 TI_DA_POPP35A39  = is.numeric(DA_POPP35A39),
 TI_DA_POPP40A44  = is.numeric(DA_POPP40A44),
 TI_DA_POPP45A49  = is.numeric(DA_POPP45A49),
 TI_DA_POPP50A54  = is.numeric(DA_POPP50A54),
 TI_DA_POPP55A59  = is.numeric(DA_POPP55A59),
 TI_DA_POPP60A64  = is.numeric(DA_POPP60A64),
 TI_DA_POPP65A69  = is.numeric(DA_POPP65A69),
 TI_DA_POPP70A74  = is.numeric(DA_POPP70A74),
 TI_DA_POPP75A79  = is.numeric(DA_POPP75A79),
 TI_DA_POPP80M    = is.numeric(DA_POPP80M),
 TI_DA_DENSP      = is.numeric(DA_DENSP),
 TI_DA_PROPP4E5   = is.numeric(DA_PROPP4E5),
 TI_DA_PROPP0A5   = is.numeric(DA_PROPP0A5),
 TI_DA_PROPP6A17  = is.numeric(DA_PROPP6A17),
 TI_DA_RDEPP      = is.numeric(DA_RDEPP),
 TI_DA_PROPP15N   = is.numeric(DA_PROPP15N),
 TI_DA_PROPP65M   = is.numeric(DA_PROPP65M),
 TI_DA_INDENVE    = is.numeric(DA_INDENVE),
 TI_DA_POPPURB    = is.numeric(DA_POPPURB),
 TI_DA_TFT        = is.numeric(DA_TFT),
 TI_DA_TMI        = is.numeric(DA_TMI),
 TI_DA_ESPVIDA    = is.numeric(DA_ESPVIDA),
 TI_DA_TBM        = is.numeric(DA_TBM),
 TI_DA_TBN        = is.numeric(DA_TBN),
 TI_DA_TCV        = is.numeric(DA_TCV),
 TI_DA_TLM        = is.numeric(DA_TLM),
 TI_DA_TCD        = is.numeric(DA_TCD),
 TI_DA_EMIGRA     = is.numeric(DA_EMIGRA),
 TI_DA_IMIGRA     = is.numeric(DA_IMIGRA),
 TI_DA_HOMEM0A4   = is.numeric(DA_HOMEM0A4),
 TI_DA_HOMEM5A9   = is.numeric(DA_HOMEM5A9),
 TI_DA_HOMEM10A14 = is.numeric(DA_HOMEM10A14),
 TI_DA_HOMEM15A19 = is.numeric(DA_HOMEM15A19),
 TI_DA_HOMEM20A24 = is.numeric(DA_HOMEM20A24),
 TI_DA_HOMEM25A29 = is.numeric(DA_HOMEM25A29),
 TI_DA_HOMEM30A34 = is.numeric(DA_HOMEM30A34),
 TI_DA_HOMEM35A39 = is.numeric(DA_HOMEM35A39),
 TI_DA_HOMEM40A44 = is.numeric(DA_HOMEM40A44),
 TI_DA_HOMEM45A49 = is.numeric(DA_HOMEM45A49),
 TI_DA_HOMEM50A54 = is.numeric(DA_HOMEM50A54),
 TI_DA_HOMEM55A59 = is.numeric(DA_HOMEM55A59),
 TI_DA_HOMEM60A64 = is.numeric(DA_HOMEM60A64),
 TI_DA_HOMEM65A69 = is.numeric(DA_HOMEM65A69),
 TI_DA_HOMEM70A74 = is.numeric(DA_HOMEM70A74),
 TI_DA_HOMEM75A79 = is.numeric(DA_HOMEM75A79),
 TI_DA_HOMEM80    = is.numeric(DA_HOMEM80),
 TI_DA_MULH0A4    = is.numeric(DA_MULH0A4),
 TI_DA_MULH5A9    = is.numeric(DA_MULH5A9),
 TI_DA_MULH10A14  = is.numeric(DA_MULH10A14),
 TI_DA_MULH15A19  = is.numeric(DA_MULH15A19),
 TI_DA_MULH20A24  = is.numeric(DA_MULH20A24),
 TI_DA_MULH25A29  = is.numeric(DA_MULH25A29),
 TI_DA_MULH30A34  = is.numeric(DA_MULH30A34),
 TI_DA_MULH35A39  = is.numeric(DA_MULH35A39),
 TI_DA_MULH40A44  = is.numeric(DA_MULH40A44),
 TI_DA_MULH45A49  = is.numeric(DA_MULH45A49),
 TI_DA_MULH50A54  = is.numeric(DA_MULH50A54),
 TI_DA_MULH55A59  = is.numeric(DA_MULH55A59),
 TI_DA_MULH60A64  = is.numeric(DA_MULH60A64),
 TI_DA_MULH65A69  = is.numeric(DA_MULH65A69),
 TI_DA_MULH70A74  = is.numeric(DA_MULH70A74),
 TI_DA_MULH75A79  = is.numeric(DA_MULH75A79),
 TI_DA_MULHER80   = is.numeric(DA_MULHER80),
 TI_DA_HOMEMTOT   = is.numeric(DA_HOMEMTOT),
 TI_DA_MULHERTOT  = is.numeric(DA_MULHERTOT)
)
```

```{r confront_type}

## Confrontar os dados com as regras e exibir uma tabela com os resultados
check_type <- validate::confront(data, rules_type)

validate::summary(check_type) |> 
  dplyr::select(
    Regra    = name,
    Validada = passes
  ) |> 
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |>
  kableExtra::kable_paper("hover", full_width = F)
```

## Validade

```{r data_rules_valid_da_all}

## df com o resultado das aplicações das regras
df_rules_valid_da_all <- data |> 
  dplyr::select(
    Ano   = ANO, 
    ibge7 = IBGE7, 
    dplyr::starts_with("DA_")
  ) |> 
  dplyr::mutate(
    # Missing
    VI_NA_DA_POPT       = dplyr::if_else(!is.na(DA_POPT), F, NA),
    VI_NA_DA_POPTA      = dplyr::if_else(!is.na(DA_POPTA), F, NA),
    VI_NA_DA_POPP0      = dplyr::if_else(!is.na(DA_POPP0), F, NA),
    VI_NA_DA_POPP1A4    = dplyr::if_else(!is.na(DA_POPP1A4), F, NA),
    VI_NA_DA_POPP4      = dplyr::if_else(!is.na(DA_POPP4), F, NA),
    VI_NA_DA_POPP5      = dplyr::if_else(!is.na(DA_POPP5), F, NA),
    VI_NA_DA_POPP4E5    = dplyr::if_else(!is.na(DA_POPP4E5), F, NA),
    VI_NA_DA_POPP5A9    = dplyr::if_else(!is.na(DA_POPP5A9), F, NA),
    VI_NA_DA_POPP6A14   = dplyr::if_else(!is.na(DA_POPP6A14), F, NA),
    VI_NA_DA_POPP10A14  = dplyr::if_else(!is.na(DA_POPP10A14), F, NA),
    VI_NA_DA_POPP15     = dplyr::if_else(!is.na(DA_POPP15), F, NA),
    VI_NA_DA_POPP15A17  = dplyr::if_else(!is.na(DA_POPP15A17), F, NA),
    VI_NA_DA_POPP15A19  = dplyr::if_else(!is.na(DA_POPP15A19), F, NA),
    VI_NA_DA_POPP15M    = dplyr::if_else(!is.na(DA_POPP15M), F, NA),
    VI_NA_DA_POPP16A19  = dplyr::if_else(!is.na(DA_POPP16A19), F, NA),
    VI_NA_DA_POPP16A64  = dplyr::if_else(!is.na(DA_POPP16A64), F, NA),
    VI_NA_DA_POPP18M    = dplyr::if_else(!is.na(DA_POPP18M), F, NA),
    VI_NA_DA_POPP20A24  = dplyr::if_else(!is.na(DA_POPP20A24), F, NA),
    VI_NA_DA_POPP25A29  = dplyr::if_else(!is.na(DA_POPP25A29), F, NA),
    VI_NA_DA_POPP30A34  = dplyr::if_else(!is.na(DA_POPP30A34), F, NA),
    VI_NA_DA_POPP35A39  = dplyr::if_else(!is.na(DA_POPP35A39), F, NA),
    VI_NA_DA_POPP40A44  = dplyr::if_else(!is.na(DA_POPP40A44), F, NA),
    VI_NA_DA_POPP45A49  = dplyr::if_else(!is.na(DA_POPP45A49), F, NA),
    VI_NA_DA_POPP50A54  = dplyr::if_else(!is.na(DA_POPP50A54), F, NA),
    VI_NA_DA_POPP55A59  = dplyr::if_else(!is.na(DA_POPP55A59), F, NA),
    VI_NA_DA_POPP60A64  = dplyr::if_else(!is.na(DA_POPP60A64), F, NA),
    VI_NA_DA_POPP65A69  = dplyr::if_else(!is.na(DA_POPP65A69), F, NA),
    VI_NA_DA_POPP70A74  = dplyr::if_else(!is.na(DA_POPP70A74), F, NA),
    VI_NA_DA_POPP75A79  = dplyr::if_else(!is.na(DA_POPP75A79), F, NA),
    VI_NA_DA_POPP80M    = dplyr::if_else(!is.na(DA_POPP80M), F, NA),
    VI_NA_DA_DENSP      = dplyr::if_else(!is.na(DA_DENSP), F, NA),
    VI_NA_DA_PROPP4E5   = dplyr::if_else(!is.na(DA_PROPP4E5), F, NA),
    VI_NA_DA_PROPP0A5   = dplyr::if_else(!is.na(DA_PROPP0A5), F, NA),
    VI_NA_DA_PROPP6A17  = dplyr::if_else(!is.na(DA_PROPP6A17), F, NA),
    VI_NA_DA_RDEPP      = dplyr::if_else(!is.na(DA_RDEPP), F, NA),
    VI_NA_DA_PROPP15N   = dplyr::if_else(!is.na(DA_PROPP15N), F, NA),
    VI_NA_DA_PROPP65M   = dplyr::if_else(!is.na(DA_PROPP65M), F, NA),
    VI_NA_DA_INDENVE    = dplyr::if_else(!is.na(DA_INDENVE), F, NA),
    VI_NA_DA_POPPURB    = dplyr::if_else(!is.na(DA_POPPURB), F, NA),
    VI_NA_DA_TFT        = dplyr::if_else(!is.na(DA_TFT), F, NA),
    VI_NA_DA_TMI        = dplyr::if_else(!is.na(DA_TMI), F, NA),
    VI_NA_DA_ESPVIDA    = dplyr::if_else(!is.na(DA_ESPVIDA), F, NA),
    VI_NA_DA_TBM        = dplyr::if_else(!is.na(DA_TBM), F, NA),
    VI_NA_DA_TBN        = dplyr::if_else(!is.na(DA_TBN), F, NA),
    VI_NA_DA_TCV        = dplyr::if_else(!is.na(DA_TCV), F, NA),
    VI_NA_DA_TLM        = dplyr::if_else(!is.na(DA_TLM), F, NA),
    VI_NA_DA_TCD        = dplyr::if_else(!is.na(DA_TCD), F, NA),
    VI_NA_DA_EMIGRA     = dplyr::if_else(!is.na(DA_EMIGRA), F, NA),
    VI_NA_DA_IMIGRA     = dplyr::if_else(!is.na(DA_IMIGRA), F, NA),
    VI_NA_DA_HOMEM0A4   = dplyr::if_else(!is.na(DA_HOMEM0A4), F, NA),
    VI_NA_DA_HOMEM5A9   = dplyr::if_else(!is.na(DA_HOMEM5A9), F, NA),
    VI_NA_DA_HOMEM10A14 = dplyr::if_else(!is.na(DA_HOMEM10A14), F, NA),
    VI_NA_DA_HOMEM15A19 = dplyr::if_else(!is.na(DA_HOMEM15A19), F, NA),
    VI_NA_DA_HOMEM20A24 = dplyr::if_else(!is.na(DA_HOMEM20A24), F, NA),
    VI_NA_DA_HOMEM25A29 = dplyr::if_else(!is.na(DA_HOMEM25A29), F, NA),
    VI_NA_DA_HOMEM30A34 = dplyr::if_else(!is.na(DA_HOMEM30A34), F, NA),
    VI_NA_DA_HOMEM35A39 = dplyr::if_else(!is.na(DA_HOMEM35A39), F, NA),
    VI_NA_DA_HOMEM40A44 = dplyr::if_else(!is.na(DA_HOMEM40A44), F, NA),
    VI_NA_DA_HOMEM45A49 = dplyr::if_else(!is.na(DA_HOMEM45A49), F, NA),
    VI_NA_DA_HOMEM50A54 = dplyr::if_else(!is.na(DA_HOMEM50A54), F, NA),
    VI_NA_DA_HOMEM55A59 = dplyr::if_else(!is.na(DA_HOMEM55A59), F, NA),
    VI_NA_DA_HOMEM60A64 = dplyr::if_else(!is.na(DA_HOMEM60A64), F, NA),
    VI_NA_DA_HOMEM65A69 = dplyr::if_else(!is.na(DA_HOMEM65A69), F, NA),
    VI_NA_DA_HOMEM70A74 = dplyr::if_else(!is.na(DA_HOMEM70A74), F, NA),
    VI_NA_DA_HOMEM75A79 = dplyr::if_else(!is.na(DA_HOMEM75A79), F, NA),
    VI_NA_DA_HOMEM80    = dplyr::if_else(!is.na(DA_HOMEM80), F, NA),
    VI_NA_DA_MULH0A4    = dplyr::if_else(!is.na(DA_MULH0A4), F, NA),
    VI_NA_DA_MULH5A9    = dplyr::if_else(!is.na(DA_MULH5A9), F, NA),
    VI_NA_DA_MULH10A14  = dplyr::if_else(!is.na(DA_MULH10A14), F, NA),
    VI_NA_DA_MULH15A19  = dplyr::if_else(!is.na(DA_MULH15A19), F, NA),
    VI_NA_DA_MULH20A24  = dplyr::if_else(!is.na(DA_MULH20A24), F, NA),
    VI_NA_DA_MULH25A29  = dplyr::if_else(!is.na(DA_MULH25A29), F, NA),
    VI_NA_DA_MULH30A34  = dplyr::if_else(!is.na(DA_MULH30A34), F, NA),
    VI_NA_DA_MULH35A39  = dplyr::if_else(!is.na(DA_MULH35A39), F, NA),
    VI_NA_DA_MULH40A44  = dplyr::if_else(!is.na(DA_MULH40A44), F, NA),
    VI_NA_DA_MULH45A49  = dplyr::if_else(!is.na(DA_MULH45A49), F, NA),
    VI_NA_DA_MULH50A54  = dplyr::if_else(!is.na(DA_MULH50A54), F, NA),
    VI_NA_DA_MULH55A59  = dplyr::if_else(!is.na(DA_MULH55A59), F, NA),
    VI_NA_DA_MULH60A64  = dplyr::if_else(!is.na(DA_MULH60A64), F, NA),
    VI_NA_DA_MULH65A69  = dplyr::if_else(!is.na(DA_MULH65A69), F, NA),
    VI_NA_DA_MULH70A74  = dplyr::if_else(!is.na(DA_MULH70A74), F, NA),
    VI_NA_DA_MULH75A79  = dplyr::if_else(!is.na(DA_MULH75A79), F, NA),
    VI_NA_DA_MULHER80   = dplyr::if_else(!is.na(DA_MULHER80), F, NA),
    VI_NA_DA_HOMEMTOT   = dplyr::if_else(!is.na(DA_HOMEMTOT), F, NA),
    VI_NA_DA_MULHERTOT  = dplyr::if_else(!is.na(DA_MULHERTOT), F, NA),
    # Others
    VI_DA_POPT       = dplyr::if_else(DA_POPT >= 0, F, T),
    VI_DA_POPTA      = dplyr::if_else(DA_POPTA >= 0, F, T),
    VI_DA_POPP0      = dplyr::if_else(DA_POPP0 >= 0, F, T),
    VI_DA_POPP1A4    = dplyr::if_else(DA_POPP1A4 >= 0, F, T),
    VI_DA_POPP4      = dplyr::if_else(DA_POPP4 >= 0, F, T),
    VI_DA_POPP5      = dplyr::if_else(DA_POPP5 >= 0, F, T),
    VI_DA_POPP4E5    = dplyr::if_else(DA_POPP4E5 >= 0, F, T),
    VI_DA_POPP5A9    = dplyr::if_else(DA_POPP5A9 >= 0, F, T),
    VI_DA_POPP6A14   = dplyr::if_else(DA_POPP6A14 >= 0, F, T),
    VI_DA_POPP10A14  = dplyr::if_else(DA_POPP10A14 >= 0, F, T),
    VI_DA_POPP15     = dplyr::if_else(DA_POPP15 >= 0, F, T),
    VI_DA_POPP15A17  = dplyr::if_else(DA_POPP15A17 >= 0, F, T),
    VI_DA_POPP15A19  = dplyr::if_else(DA_POPP15A19 >= 0, F, T),
    VI_DA_POPP15M    = dplyr::if_else(DA_POPP15M >= 0, F, T),
    VI_DA_POPP16A19  = dplyr::if_else(DA_POPP16A19 >= 0, F, T),
    VI_DA_POPP16A64  = dplyr::if_else(DA_POPP16A64 >= 0, F, T),
    VI_DA_POPP18M    = dplyr::if_else(DA_POPP18M >= 0, F, T),
    VI_DA_POPP20A24  = dplyr::if_else(DA_POPP20A24 >= 0, F, T),
    VI_DA_POPP25A29  = dplyr::if_else(DA_POPP25A29 >= 0, F, T),
    VI_DA_POPP30A34  = dplyr::if_else(DA_POPP30A34 >= 0, F, T),
    VI_DA_POPP35A39  = dplyr::if_else(DA_POPP35A39 >= 0, F, T),
    VI_DA_POPP40A44  = dplyr::if_else(DA_POPP40A44 >= 0, F, T),
    VI_DA_POPP45A49  = dplyr::if_else(DA_POPP45A49 >= 0, F, T),
    VI_DA_POPP50A54  = dplyr::if_else(DA_POPP50A54 >= 0, F, T),
    VI_DA_POPP55A59  = dplyr::if_else(DA_POPP55A59 >= 0, F, T),
    VI_DA_POPP60A64  = dplyr::if_else(DA_POPP60A64 >= 0, F, T),
    VI_DA_POPP65A69  = dplyr::if_else(DA_POPP65A69 >= 0, F, T),
    VI_DA_POPP70A74  = dplyr::if_else(DA_POPP70A74 >= 0, F, T),
    VI_DA_POPP75A79  = dplyr::if_else(DA_POPP75A79 >= 0, F, T),
    VI_DA_POPP80M    = dplyr::if_else(DA_POPP80M >= 0, F, T),
    VI_DA_DENSP      = dplyr::if_else(DA_DENSP >= 0, F, T),
    VI_DA_PROPP4E5   = dplyr::if_else(dplyr::between(DA_PROPP4E5, 0, 100), F, T),
    VI_DA_PROPP0A5   = dplyr::if_else(dplyr::between(DA_PROPP0A5, 0, 100), F, T),
    VI_DA_PROPP6A17  = dplyr::if_else(dplyr::between(DA_PROPP6A17, 0, 100), F, T),
    VI_DA_RDEPP      = dplyr::if_else(dplyr::between(DA_RDEPP, 0, 100), F, T),
    VI_DA_PROPP15N   = dplyr::if_else(dplyr::between(DA_PROPP15N, 0, 100), F, T),
    VI_DA_PROPP65M   = dplyr::if_else(dplyr::between(DA_PROPP65M, 0, 100), F, T),
    VI_DA_INDENVE    = dplyr::if_else(dplyr::between(DA_INDENVE, 0, 100), F, T),
    VI_DA_POPPURB    = dplyr::if_else(dplyr::between(DA_POPPURB, 0, 100), F, T),
    VI_DA_TFT        = dplyr::if_else(DA_TFT >= 0, F, T),
    VI_DA_TMI        = dplyr::if_else(dplyr::between(DA_TMI, 0, 1000), F, T),
    VI_DA_ESPVIDA    = dplyr::if_else(DA_ESPVIDA >= 0, F, T),
    VI_DA_TBM        = dplyr::if_else(dplyr::between(DA_TBM, 0, 1000), F, T),
    VI_DA_TBN        = dplyr::if_else(dplyr::between(DA_TBN, 0, 1000), F, T),
    VI_DA_TCV        = dplyr::if_else(DA_TCV >= 0, F, T),
    VI_DA_TLM        = dplyr::if_else(dplyr::between(DA_TLM, 0, 1000), F, T),
    VI_DA_TCD        = dplyr::if_else(DA_TCD >= 0, F, T),
    VI_DA_EMIGRA     = dplyr::if_else(DA_EMIGRA >= 0, F, T),
    VI_DA_IMIGRA     = dplyr::if_else(DA_IMIGRA >= 0, F, T),
    VI_DA_HOMEM0A4   = dplyr::if_else(DA_HOMEM0A4 >= 0, F, T),
    VI_DA_HOMEM5A9   = dplyr::if_else(DA_HOMEM5A9 >= 0, F, T),
    VI_DA_HOMEM10A14 = dplyr::if_else(DA_HOMEM10A14 >= 0, F, T),
    VI_DA_HOMEM15A19 = dplyr::if_else(DA_HOMEM15A19 >= 0, F, T),
    VI_DA_HOMEM20A24 = dplyr::if_else(DA_HOMEM20A24 >= 0, F, T),
    VI_DA_HOMEM25A29 = dplyr::if_else(DA_HOMEM25A29 >= 0, F, T),
    VI_DA_HOMEM30A34 = dplyr::if_else(DA_HOMEM30A34 >= 0, F, T),
    VI_DA_HOMEM35A39 = dplyr::if_else(DA_HOMEM35A39 >= 0, F, T),
    VI_DA_HOMEM40A44 = dplyr::if_else(DA_HOMEM40A44 >= 0, F, T),
    VI_DA_HOMEM45A49 = dplyr::if_else(DA_HOMEM45A49 >= 0, F, T),
    VI_DA_HOMEM50A54 = dplyr::if_else(DA_HOMEM50A54 >= 0, F, T),
    VI_DA_HOMEM55A59 = dplyr::if_else(DA_HOMEM55A59 >= 0, F, T),
    VI_DA_HOMEM60A64 = dplyr::if_else(DA_HOMEM60A64 >= 0, F, T),
    VI_DA_HOMEM65A69 = dplyr::if_else(DA_HOMEM65A69 >= 0, F, T),
    VI_DA_HOMEM70A74 = dplyr::if_else(DA_HOMEM70A74 >= 0, F, T),
    VI_DA_HOMEM75A79 = dplyr::if_else(DA_HOMEM75A79 >= 0, F, T),
    VI_DA_HOMEM80    = dplyr::if_else(DA_HOMEM80 >= 0, F, T),
    VI_DA_MULH0A4    = dplyr::if_else(DA_MULH0A4 >= 0, F, T),
    VI_DA_MULH5A9    = dplyr::if_else(DA_MULH5A9 >= 0, F, T),
    VI_DA_MULH10A14  = dplyr::if_else(DA_MULH10A14 >= 0, F, T),
    VI_DA_MULH15A19  = dplyr::if_else(DA_MULH15A19 >= 0, F, T),
    VI_DA_MULH20A24  = dplyr::if_else(DA_MULH20A24 >= 0, F, T),
    VI_DA_MULH25A29  = dplyr::if_else(DA_MULH25A29 >= 0, F, T),
    VI_DA_MULH30A34  = dplyr::if_else(DA_MULH30A34 >= 0, F, T),
    VI_DA_MULH35A39  = dplyr::if_else(DA_MULH35A39 >= 0, F, T),
    VI_DA_MULH40A44  = dplyr::if_else(DA_MULH40A44 >= 0, F, T),
    VI_DA_MULH45A49  = dplyr::if_else(DA_MULH45A49 >= 0, F, T),
    VI_DA_MULH50A54  = dplyr::if_else(DA_MULH50A54 >= 0, F, T),
    VI_DA_MULH55A59  = dplyr::if_else(DA_MULH55A59 >= 0, F, T),
    VI_DA_MULH60A64  = dplyr::if_else(DA_MULH60A64 >= 0, F, T),
    VI_DA_MULH65A69  = dplyr::if_else(DA_MULH65A69 >= 0, F, T),
    VI_DA_MULH70A74  = dplyr::if_else(DA_MULH70A74 >= 0, F, T),
    VI_DA_MULH75A79  = dplyr::if_else(DA_MULH75A79 >= 0, F, T),
    VI_DA_MULHER80   = dplyr::if_else(DA_MULHER80 >= 0, F, T),
    VI_DA_HOMEMTOT   = dplyr::if_else(DA_HOMEMTOT >= 0, F, T),
    VI_DA_MULHERTOT  = dplyr::if_else(DA_MULHERTOT >= 0, F, T)
  )
```

```{r data_wrangling_valid_da_all}

## Transformação dos resultados
df_sumario_valid_da <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano, 
    ibge7, 
    dplyr::starts_with("VI_")
  ) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_valid_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

### Todos os indicadores - Valores ausentes

```{r table_valid_da_na_all}

df_sumario |>
  dplyr::select(Ano, Regra, Total, contains("Ausente")) |>
  dplyr::filter(
    Ano == max(Ano) & 
    stringr::str_detect(Regra, "_NA_")
  ) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

### Todos os indicadores - Demais regras

```{r table_valid_da_all}
#| column: screen-inset-right

df_sumario |>
  dplyr::filter(
    Ano == max(Ano) & 
    stringr::str_detect(Regra, "_NA_", negate = T)
  ) |>
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  dplyr::left_join(desc_regra_valid_var, by = dplyr::join_by(Regra)) |> # Introdução coluna descrição
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

<!-- ## Consistência -->

```{r data_rules_consist_da_all}

## df com o resultado das aplicações das regras
# df_rules_consist_hs_all <- data |> 
#   dplyr::select(
#     Ano   = ANO, 
#     ibge7 = IBGE7,
#     HS_POLITICA,
#     HS_PLANOSAN,
#     HS_CONSELHO,
#     HS_GESTAO
#   ) |> 
#   dplyr::mutate(
#     CI_GESTAO_munic = dplyr::if_else(rowSums(dplyr::across(c(HS_POLITICA, HS_PLANOSAN, HS_CONSELHO)), na.rm = T) == (HS_GESTAO), F, T)
# )
```

```{r data_wrangling_consist_da_all}

## Tranformação dos resultados
# df_sumario_consist_hs <- df_rules_consist_hs_all |> 
#   dplyr::select(
#     !c(
#         HS_POLITICA, 
#         HS_PLANOSAN, 
#         HS_CONSELHO, 
#         HS_GESTAO
#       )
#   ) |> 
#   tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")
# 
# ## df com um sumário dos resultados
# df_sumario <- df_sumario_consist_hs |> 
#   dplyr::group_by(Ano, Regra) |> 
#   dplyr::summarise(
#     Total        = dplyr::n(),
#     Validada     = sum(!resultado, na.rm = T),
#     Suspeita     = sum(resultado, na.rm = T),
#     Ausente      = sum(is.na(resultado)),
#     `% Validada` = round(Validada / Total * 100, 2),
#     `% Suspeita` = round(Suspeita / Total * 100, 2),
#     `% Ausente`  = round(Ausente / Total * 100, 2)
#   ) |> 
#   dplyr::ungroup()
```

<!-- ### Todos os indicadores -->

```{r table_consist_da_all}
# 
# df_sumario |> 
#   dplyr::filter(Ano == max(Ano)) |>
#   dplyr::mutate(Ano = as.character(Ano)) |>
#   dplyr::left_join(desc_regra_consist_var, by = dplyr::join_by(Regra)) |> # Introdução coluna descrição
#   kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
#   kableExtra::kable_paper("hover", full_width = F)
```

## Distribuição

### DA_POPT

```{r rules_dist_da_popt}

## df com o resultado das aplicações das regras

df_rules_dist_da_popt <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPT" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPT"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPT) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPT_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPT), F, T), # Longitudinal (município)
    
    DF_DA_POPT_out_munic     = dplyr::if_else(!outlier_function(DA_POPT), F, T), # Longitudinal (município)
    
    DF_DA_POPT_min_munic     = dplyr::if_else(DA_POPT >= (min(dplyr::lag(DA_POPT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPT_max_munic     = dplyr::if_else(DA_POPT <= (max(dplyr::lag(DA_POPT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPT_min_k_munic   = dplyr::if_else(DA_POPT >= (min(dplyr::lag(DA_POPT), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPT_max_k_munic   = dplyr::if_else(DA_POPT <= (k * max(dplyr::lag(DA_POPT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPT_med_mov_munic = dplyr::if_else(DA_POPT <= (k * zoo::rollmedian(DA_POPT, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPT_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPT), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popt}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popt |> 
  dplyr::select(!DA_POPT) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popt}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popt}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPTA

```{r rules_dist_da_popta}

## df com o resultado das aplicações das regras
df_rules_dist_da_popta <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPTA" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPTA"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPTA) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPTA_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPTA), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_out_munic     = dplyr::if_else(!outlier_function(DA_POPTA), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_min_munic     = dplyr::if_else(DA_POPTA >= (min(dplyr::lag(DA_POPTA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_max_munic     = dplyr::if_else(DA_POPTA <= (max(dplyr::lag(DA_POPTA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_min_k_munic   = dplyr::if_else(DA_POPTA >= (min(dplyr::lag(DA_POPTA), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_max_k_munic   = dplyr::if_else(DA_POPTA <= (k * max(dplyr::lag(DA_POPTA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_med_mov_munic = dplyr::if_else(DA_POPTA <= (k * zoo::rollmedian(DA_POPTA, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPTA_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPTA), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popta}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popta |> 
  dplyr::select(!DA_POPTA) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popta}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popta}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP0

```{r rules_dist_da_popp0}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp0 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP0" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP0"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP0) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP0_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP0), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_out_munic     = dplyr::if_else(!outlier_function(DA_POPP0), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_min_munic     = dplyr::if_else(DA_POPP0 >= (min(dplyr::lag(DA_POPP0), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_max_munic     = dplyr::if_else(DA_POPP0 <= (max(dplyr::lag(DA_POPP0), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_min_k_munic   = dplyr::if_else(DA_POPP0 >= (min(dplyr::lag(DA_POPP0), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_max_k_munic   = dplyr::if_else(DA_POPP0 <= (k * max(dplyr::lag(DA_POPP0), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_med_mov_munic = dplyr::if_else(DA_POPP0 <= (k * zoo::rollmedian(DA_POPP0, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP0_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP0), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp0}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp0 |> 
  dplyr::select(!DA_POPP0) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp0}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp0}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP1A4

```{r rules_dist_da_popp1a4}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp1a4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP1A4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP1A4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP1A4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP1A4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP1A4), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_out_munic     = dplyr::if_else(!outlier_function(DA_POPP1A4), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_min_munic     = dplyr::if_else(DA_POPP1A4 >= (min(dplyr::lag(DA_POPP1A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_max_munic     = dplyr::if_else(DA_POPP1A4 <= (max(dplyr::lag(DA_POPP1A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_min_k_munic   = dplyr::if_else(DA_POPP1A4 >= (min(dplyr::lag(DA_POPP1A4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_max_k_munic   = dplyr::if_else(DA_POPP1A4 <= (k * max(dplyr::lag(DA_POPP1A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_med_mov_munic = dplyr::if_else(DA_POPP1A4 <= (k * zoo::rollmedian(DA_POPP1A4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP1A4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP1A4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp1a4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp1a4 |> 
  dplyr::select(!DA_POPP1A4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp1a4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp1a4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP4

```{r rules_dist_da_popp4}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP4), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_out_munic     = dplyr::if_else(!outlier_function(DA_POPP4), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_min_munic     = dplyr::if_else(DA_POPP4 >= (min(dplyr::lag(DA_POPP4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_max_munic     = dplyr::if_else(DA_POPP4 <= (max(dplyr::lag(DA_POPP4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_min_k_munic   = dplyr::if_else(DA_POPP4 >= (min(dplyr::lag(DA_POPP4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_max_k_munic   = dplyr::if_else(DA_POPP4 <= (k * max(dplyr::lag(DA_POPP4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_med_mov_munic = dplyr::if_else(DA_POPP4 <= (k * zoo::rollmedian(DA_POPP4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp4 |> 
  dplyr::select(!DA_POPP4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP5

```{r rules_dist_da_popp5}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP5), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_out_munic     = dplyr::if_else(!outlier_function(DA_POPP5), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_min_munic     = dplyr::if_else(DA_POPP5 >= (min(dplyr::lag(DA_POPP5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_max_munic     = dplyr::if_else(DA_POPP5 <= (max(dplyr::lag(DA_POPP5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_min_k_munic   = dplyr::if_else(DA_POPP5 >= (min(dplyr::lag(DA_POPP5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_max_k_munic   = dplyr::if_else(DA_POPP5 <= (k * max(dplyr::lag(DA_POPP5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_med_mov_munic = dplyr::if_else(DA_POPP5 <= (k * zoo::rollmedian(DA_POPP5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp5 |> 
  dplyr::select(!DA_POPP5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP4E5

```{r rules_dist_da_popp4e5}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp4e5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP4E5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP4E5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP4E5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP4E5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_out_munic     = dplyr::if_else(!outlier_function(DA_POPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_min_munic     = dplyr::if_else(DA_POPP4E5 >= (min(dplyr::lag(DA_POPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_max_munic     = dplyr::if_else(DA_POPP4E5 <= (max(dplyr::lag(DA_POPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_min_k_munic   = dplyr::if_else(DA_POPP4E5 >= (min(dplyr::lag(DA_POPP4E5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_max_k_munic   = dplyr::if_else(DA_POPP4E5 <= (k * max(dplyr::lag(DA_POPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_med_mov_munic = dplyr::if_else(DA_POPP4E5 <= (k * zoo::rollmedian(DA_POPP4E5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP4E5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP4E5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp4e5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp4e5 |> 
  dplyr::select(!DA_POPP4E5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp4e5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp4e5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP5A9

```{r rules_dist_da_popp5a9}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp5a9 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP5A9" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP5A9"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP5A9) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP5A9_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP5A9), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_out_munic     = dplyr::if_else(!outlier_function(DA_POPP5A9), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_min_munic     = dplyr::if_else(DA_POPP5A9 >= (min(dplyr::lag(DA_POPP5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_max_munic     = dplyr::if_else(DA_POPP5A9 <= (max(dplyr::lag(DA_POPP5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_min_k_munic   = dplyr::if_else(DA_POPP5A9 >= (min(dplyr::lag(DA_POPP5A9), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_max_k_munic   = dplyr::if_else(DA_POPP5A9 <= (k * max(dplyr::lag(DA_POPP5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_med_mov_munic = dplyr::if_else(DA_POPP5A9 <= (k * zoo::rollmedian(DA_POPP5A9, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP5A9_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP5A9), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp5a9}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp5a9 |> 
  dplyr::select(!DA_POPP5A9) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp5a9}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp5a9}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP6A14

```{r rules_dist_da_popp6a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp6a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP6A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP6A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP6A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP6A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP6A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_out_munic     = dplyr::if_else(!outlier_function(DA_POPP6A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_min_munic     = dplyr::if_else(DA_POPP6A14 >= (min(dplyr::lag(DA_POPP6A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_max_munic     = dplyr::if_else(DA_POPP6A14 <= (max(dplyr::lag(DA_POPP6A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_min_k_munic   = dplyr::if_else(DA_POPP6A14 >= (min(dplyr::lag(DA_POPP6A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_max_k_munic   = dplyr::if_else(DA_POPP6A14 <= (k * max(dplyr::lag(DA_POPP6A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_med_mov_munic = dplyr::if_else(DA_POPP6A14 <= (k * zoo::rollmedian(DA_POPP6A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP6A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP6A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp6a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp6a14 |> 
  dplyr::select(!DA_POPP6A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp6a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp6a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP10A14

```{r rules_dist_da_popp10a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp10a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP10A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP10A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP10A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP10A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP10A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_out_munic     = dplyr::if_else(!outlier_function(DA_POPP10A14), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_min_munic     = dplyr::if_else(DA_POPP10A14 >= (min(dplyr::lag(DA_POPP10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_max_munic     = dplyr::if_else(DA_POPP10A14 <= (max(dplyr::lag(DA_POPP10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_min_k_munic   = dplyr::if_else(DA_POPP10A14 >= (min(dplyr::lag(DA_POPP10A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_max_k_munic   = dplyr::if_else(DA_POPP10A14 <= (k * max(dplyr::lag(DA_POPP10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_med_mov_munic = dplyr::if_else(DA_POPP10A14 <= (k * zoo::rollmedian(DA_POPP10A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP10A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP10A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp10a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp10a14 |> 
  dplyr::select(!DA_POPP10A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp10a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp10a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP15

```{r rules_dist_da_popp15}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_min_munic     = dplyr::if_else(DA_POPP15 >= (min(dplyr::lag(DA_POPP15), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_max_munic     = dplyr::if_else(DA_POPP15 <= (max(dplyr::lag(DA_POPP15), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_min_k_munic   = dplyr::if_else(DA_POPP15 >= (min(dplyr::lag(DA_POPP15), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_max_k_munic   = dplyr::if_else(DA_POPP15 <= (k * max(dplyr::lag(DA_POPP15), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_med_mov_munic = dplyr::if_else(DA_POPP15 <= (k * zoo::rollmedian(DA_POPP15, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15 |> 
  dplyr::select(!DA_POPP15) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP15A17

```{r rules_dist_da_popp15a17}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15a17 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15A17" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15A17"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15A17) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15A17_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15A17), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15A17), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_min_munic     = dplyr::if_else(DA_POPP15A17 >= (min(dplyr::lag(DA_POPP15A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_max_munic     = dplyr::if_else(DA_POPP15A17 <= (max(dplyr::lag(DA_POPP15A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_min_k_munic   = dplyr::if_else(DA_POPP15A17 >= (min(dplyr::lag(DA_POPP15A17), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_max_k_munic   = dplyr::if_else(DA_POPP15A17 <= (k * max(dplyr::lag(DA_POPP15A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_med_mov_munic = dplyr::if_else(DA_POPP15A17 <= (k * zoo::rollmedian(DA_POPP15A17, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A17_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15A17), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15a17}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15a17 |> 
  dplyr::select(!DA_POPP15A17) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15a17}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15a17}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP15A19

```{r rules_dist_da_popp15a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_min_munic     = dplyr::if_else(DA_POPP15A19 >= (min(dplyr::lag(DA_POPP15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_max_munic     = dplyr::if_else(DA_POPP15A19 <= (max(dplyr::lag(DA_POPP15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_min_k_munic   = dplyr::if_else(DA_POPP15A19 >= (min(dplyr::lag(DA_POPP15A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_max_k_munic   = dplyr::if_else(DA_POPP15A19 <= (k * max(dplyr::lag(DA_POPP15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_med_mov_munic = dplyr::if_else(DA_POPP15A19 <= (k * zoo::rollmedian(DA_POPP15A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15a19 |> 
  dplyr::select(!DA_POPP15A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP15M

```{r rules_dist_da_popp15m}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp15m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP15M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP15M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP15M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP15M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP15M), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_out_munic     = dplyr::if_else(!outlier_function(DA_POPP15M), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_min_munic     = dplyr::if_else(DA_POPP15M >= (min(dplyr::lag(DA_POPP15M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_max_munic     = dplyr::if_else(DA_POPP15M <= (max(dplyr::lag(DA_POPP15M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_min_k_munic   = dplyr::if_else(DA_POPP15M >= (min(dplyr::lag(DA_POPP15M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_max_k_munic   = dplyr::if_else(DA_POPP15M <= (k * max(dplyr::lag(DA_POPP15M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_med_mov_munic = dplyr::if_else(DA_POPP15M <= (k * zoo::rollmedian(DA_POPP15M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP15M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP15M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp15m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp15m |> 
  dplyr::select(!DA_POPP15M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp15m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp15m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP16A19

```{r rules_dist_da_popp16a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp16a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP16A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP16A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP16A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP16A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP16A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_out_munic     = dplyr::if_else(!outlier_function(DA_POPP16A19), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_min_munic     = dplyr::if_else(DA_POPP16A19 >= (min(dplyr::lag(DA_POPP16A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_max_munic     = dplyr::if_else(DA_POPP16A19 <= (max(dplyr::lag(DA_POPP16A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_min_k_munic   = dplyr::if_else(DA_POPP16A19 >= (min(dplyr::lag(DA_POPP16A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_max_k_munic   = dplyr::if_else(DA_POPP16A19 <= (k * max(dplyr::lag(DA_POPP16A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_med_mov_munic = dplyr::if_else(DA_POPP16A19 <= (k * zoo::rollmedian(DA_POPP16A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP16A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp16a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp16a19 |> 
  dplyr::select(!DA_POPP16A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp16a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp16a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP16A64

```{r rules_dist_da_popp16a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp16a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP16A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP16A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP16A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP16A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP16A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_out_munic     = dplyr::if_else(!outlier_function(DA_POPP16A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_min_munic     = dplyr::if_else(DA_POPP16A64 >= (min(dplyr::lag(DA_POPP16A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_max_munic     = dplyr::if_else(DA_POPP16A64 <= (max(dplyr::lag(DA_POPP16A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_min_k_munic   = dplyr::if_else(DA_POPP16A64 >= (min(dplyr::lag(DA_POPP16A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_max_k_munic   = dplyr::if_else(DA_POPP16A64 <= (k * max(dplyr::lag(DA_POPP16A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_med_mov_munic = dplyr::if_else(DA_POPP16A64 <= (k * zoo::rollmedian(DA_POPP16A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP16A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP16A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp16a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp16a64 |> 
  dplyr::select(!DA_POPP16A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp16a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp16a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP18M

```{r rules_dist_da_popp18m}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp18m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP18M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP18M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP18M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP18M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP18M), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_out_munic     = dplyr::if_else(!outlier_function(DA_POPP18M), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_min_munic     = dplyr::if_else(DA_POPP18M >= (min(dplyr::lag(DA_POPP18M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_max_munic     = dplyr::if_else(DA_POPP18M <= (max(dplyr::lag(DA_POPP18M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_min_k_munic   = dplyr::if_else(DA_POPP18M >= (min(dplyr::lag(DA_POPP18M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_max_k_munic   = dplyr::if_else(DA_POPP18M <= (k * max(dplyr::lag(DA_POPP18M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_med_mov_munic = dplyr::if_else(DA_POPP18M <= (k * zoo::rollmedian(DA_POPP18M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP18M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP18M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp18m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp18m |> 
  dplyr::select(!DA_POPP18M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp18m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp18m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP20A24

```{r rules_dist_da_popp20a24}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp20a24 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP20A24" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP20A24"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP20A24) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP20A24_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP20A24), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_out_munic     = dplyr::if_else(!outlier_function(DA_POPP20A24), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_min_munic     = dplyr::if_else(DA_POPP20A24 >= (min(dplyr::lag(DA_POPP20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_max_munic     = dplyr::if_else(DA_POPP20A24 <= (max(dplyr::lag(DA_POPP20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_min_k_munic   = dplyr::if_else(DA_POPP20A24 >= (min(dplyr::lag(DA_POPP20A24), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_max_k_munic   = dplyr::if_else(DA_POPP20A24 <= (k * max(dplyr::lag(DA_POPP20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_med_mov_munic = dplyr::if_else(DA_POPP20A24 <= (k * zoo::rollmedian(DA_POPP20A24, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP20A24_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP20A24), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp20a24}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp20a24 |> 
  dplyr::select(!DA_POPP20A24) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp20a24}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp20a24}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP25A29

```{r rules_dist_da_popp25a29}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp25a29 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP25A29" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP25A29"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP25A29) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP25A29_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP25A29), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_out_munic     = dplyr::if_else(!outlier_function(DA_POPP25A29), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_min_munic     = dplyr::if_else(DA_POPP25A29 >= (min(dplyr::lag(DA_POPP25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_max_munic     = dplyr::if_else(DA_POPP25A29 <= (max(dplyr::lag(DA_POPP25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_min_k_munic   = dplyr::if_else(DA_POPP25A29 >= (min(dplyr::lag(DA_POPP25A29), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_max_k_munic   = dplyr::if_else(DA_POPP25A29 <= (k * max(dplyr::lag(DA_POPP25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_med_mov_munic = dplyr::if_else(DA_POPP25A29 <= (k * zoo::rollmedian(DA_POPP25A29, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP25A29_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP25A29), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp25a29}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp25a29 |> 
  dplyr::select(!DA_POPP25A29) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp25a29}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp25a29}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP30A34

```{r rules_dist_da_popp30a34}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp30a34 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP30A34" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP30A34"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP30A34) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP30A34_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP30A34), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_out_munic     = dplyr::if_else(!outlier_function(DA_POPP30A34), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_min_munic     = dplyr::if_else(DA_POPP30A34 >= (min(dplyr::lag(DA_POPP30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_max_munic     = dplyr::if_else(DA_POPP30A34 <= (max(dplyr::lag(DA_POPP30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_min_k_munic   = dplyr::if_else(DA_POPP30A34 >= (min(dplyr::lag(DA_POPP30A34), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_max_k_munic   = dplyr::if_else(DA_POPP30A34 <= (k * max(dplyr::lag(DA_POPP30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_med_mov_munic = dplyr::if_else(DA_POPP30A34 <= (k * zoo::rollmedian(DA_POPP30A34, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP30A34_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP30A34), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp30a34}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp30a34 |> 
  dplyr::select(!DA_POPP30A34) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp30a34}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp30a34}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP35A39

```{r rules_dist_da_popp35a39}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp35a39 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP35A39" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP35A39"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP35A39) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP35A39_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP35A39), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_out_munic     = dplyr::if_else(!outlier_function(DA_POPP35A39), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_min_munic     = dplyr::if_else(DA_POPP35A39 >= (min(dplyr::lag(DA_POPP35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_max_munic     = dplyr::if_else(DA_POPP35A39 <= (max(dplyr::lag(DA_POPP35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_min_k_munic   = dplyr::if_else(DA_POPP35A39 >= (min(dplyr::lag(DA_POPP35A39), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_max_k_munic   = dplyr::if_else(DA_POPP35A39 <= (k * max(dplyr::lag(DA_POPP35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_med_mov_munic = dplyr::if_else(DA_POPP35A39 <= (k * zoo::rollmedian(DA_POPP35A39, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP35A39_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP35A39), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp35a39}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp35a39 |> 
  dplyr::select(!DA_POPP35A39) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp35a39}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp35a39}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP40A44

```{r rules_dist_da_popp40a44}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp40a44 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP40A44" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP40A44"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP40A44) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP40A44_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP40A44), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_out_munic     = dplyr::if_else(!outlier_function(DA_POPP40A44), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_min_munic     = dplyr::if_else(DA_POPP40A44 >= (min(dplyr::lag(DA_POPP40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_max_munic     = dplyr::if_else(DA_POPP40A44 <= (max(dplyr::lag(DA_POPP40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_min_k_munic   = dplyr::if_else(DA_POPP40A44 >= (min(dplyr::lag(DA_POPP40A44), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_max_k_munic   = dplyr::if_else(DA_POPP40A44 <= (k * max(dplyr::lag(DA_POPP40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_med_mov_munic = dplyr::if_else(DA_POPP40A44 <= (k * zoo::rollmedian(DA_POPP40A44, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP40A44_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP40A44), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp40a44}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp40a44 |> 
  dplyr::select(!DA_POPP40A44) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp40a44}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp40a44}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP45A49

```{r rules_dist_da_popp45a49}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp45a49 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP45A49" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP45A49"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP45A49) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP45A49_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP45A49), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_out_munic     = dplyr::if_else(!outlier_function(DA_POPP45A49), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_min_munic     = dplyr::if_else(DA_POPP45A49 >= (min(dplyr::lag(DA_POPP45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_max_munic     = dplyr::if_else(DA_POPP45A49 <= (max(dplyr::lag(DA_POPP45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_min_k_munic   = dplyr::if_else(DA_POPP45A49 >= (min(dplyr::lag(DA_POPP45A49), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_max_k_munic   = dplyr::if_else(DA_POPP45A49 <= (k * max(dplyr::lag(DA_POPP45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_med_mov_munic = dplyr::if_else(DA_POPP45A49 <= (k * zoo::rollmedian(DA_POPP45A49, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP45A49_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP45A49), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp45a49}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp45a49 |> 
  dplyr::select(!DA_POPP45A49) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp45a49}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp45a49}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP50A54

```{r rules_dist_da_popp50a54}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp50a54 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP50A54" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP50A54"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP50A54) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP50A54_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP50A54), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_out_munic     = dplyr::if_else(!outlier_function(DA_POPP50A54), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_min_munic     = dplyr::if_else(DA_POPP50A54 >= (min(dplyr::lag(DA_POPP50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_max_munic     = dplyr::if_else(DA_POPP50A54 <= (max(dplyr::lag(DA_POPP50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_min_k_munic   = dplyr::if_else(DA_POPP50A54 >= (min(dplyr::lag(DA_POPP50A54), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_max_k_munic   = dplyr::if_else(DA_POPP50A54 <= (k * max(dplyr::lag(DA_POPP50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_med_mov_munic = dplyr::if_else(DA_POPP50A54 <= (k * zoo::rollmedian(DA_POPP50A54, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP50A54_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP50A54), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp50a54}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp50a54 |> 
  dplyr::select(!DA_POPP50A54) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp50a54}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp50a54}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP55A59

```{r rules_dist_da_popp55a59}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp55a59 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP55A59" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP55A59"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP55A59) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP55A59_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP55A59), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_out_munic     = dplyr::if_else(!outlier_function(DA_POPP55A59), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_min_munic     = dplyr::if_else(DA_POPP55A59 >= (min(dplyr::lag(DA_POPP55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_max_munic     = dplyr::if_else(DA_POPP55A59 <= (max(dplyr::lag(DA_POPP55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_min_k_munic   = dplyr::if_else(DA_POPP55A59 >= (min(dplyr::lag(DA_POPP55A59), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_max_k_munic   = dplyr::if_else(DA_POPP55A59 <= (k * max(dplyr::lag(DA_POPP55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_med_mov_munic = dplyr::if_else(DA_POPP55A59 <= (k * zoo::rollmedian(DA_POPP55A59, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP55A59_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP55A59), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp55a59}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp55a59 |> 
  dplyr::select(!DA_POPP55A59) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp55a59}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp55a59}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP60A64

```{r rules_dist_da_popp60a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp60a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP60A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP60A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP60A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP60A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP60A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_out_munic     = dplyr::if_else(!outlier_function(DA_POPP60A64), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_min_munic     = dplyr::if_else(DA_POPP60A64 >= (min(dplyr::lag(DA_POPP60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_max_munic     = dplyr::if_else(DA_POPP60A64 <= (max(dplyr::lag(DA_POPP60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_min_k_munic   = dplyr::if_else(DA_POPP60A64 >= (min(dplyr::lag(DA_POPP60A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_max_k_munic   = dplyr::if_else(DA_POPP60A64 <= (k * max(dplyr::lag(DA_POPP60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_med_mov_munic = dplyr::if_else(DA_POPP60A64 <= (k * zoo::rollmedian(DA_POPP60A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP60A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP60A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp60a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp60a64 |> 
  dplyr::select(!DA_POPP60A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp60a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp60a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP65A69

```{r rules_dist_da_popp65a69}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp65a69 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP65A69" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP65A69"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP65A69) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP65A69_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP65A69), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_out_munic     = dplyr::if_else(!outlier_function(DA_POPP65A69), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_min_munic     = dplyr::if_else(DA_POPP65A69 >= (min(dplyr::lag(DA_POPP65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_max_munic     = dplyr::if_else(DA_POPP65A69 <= (max(dplyr::lag(DA_POPP65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_min_k_munic   = dplyr::if_else(DA_POPP65A69 >= (min(dplyr::lag(DA_POPP65A69), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_max_k_munic   = dplyr::if_else(DA_POPP65A69 <= (k * max(dplyr::lag(DA_POPP65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_med_mov_munic = dplyr::if_else(DA_POPP65A69 <= (k * zoo::rollmedian(DA_POPP65A69, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP65A69_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP65A69), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp65a69}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp65a69 |> 
  dplyr::select(!DA_POPP65A69) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp65a69}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp65a69}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP70A74

```{r rules_dist_da_popp70a74}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp70a74 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP70A74" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP70A74"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP70A74) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP70A74_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP70A74), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_out_munic     = dplyr::if_else(!outlier_function(DA_POPP70A74), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_min_munic     = dplyr::if_else(DA_POPP70A74 >= (min(dplyr::lag(DA_POPP70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_max_munic     = dplyr::if_else(DA_POPP70A74 <= (max(dplyr::lag(DA_POPP70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_min_k_munic   = dplyr::if_else(DA_POPP70A74 >= (min(dplyr::lag(DA_POPP70A74), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_max_k_munic   = dplyr::if_else(DA_POPP70A74 <= (k * max(dplyr::lag(DA_POPP70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_med_mov_munic = dplyr::if_else(DA_POPP70A74 <= (k * zoo::rollmedian(DA_POPP70A74, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP70A74_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP70A74), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp70a74}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp70a74 |> 
  dplyr::select(!DA_POPP70A74) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp70a74}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp70a74}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP75A79

```{r rules_dist_da_popp75a79}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp75a79 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP75A79" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP75A79"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP75A79) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP75A79_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP75A79), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_out_munic     = dplyr::if_else(!outlier_function(DA_POPP75A79), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_min_munic     = dplyr::if_else(DA_POPP75A79 >= (min(dplyr::lag(DA_POPP75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_max_munic     = dplyr::if_else(DA_POPP75A79 <= (max(dplyr::lag(DA_POPP75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_min_k_munic   = dplyr::if_else(DA_POPP75A79 >= (min(dplyr::lag(DA_POPP75A79), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_max_k_munic   = dplyr::if_else(DA_POPP75A79 <= (k * max(dplyr::lag(DA_POPP75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_med_mov_munic = dplyr::if_else(DA_POPP75A79 <= (k * zoo::rollmedian(DA_POPP75A79, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP75A79_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP75A79), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp75a79}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp75a79 |> 
  dplyr::select(!DA_POPP75A79) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp75a79}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp75a79}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPP80M

```{r rules_dist_da_popp80m}

## df com o resultado das aplicações das regras
df_rules_dist_da_popp80m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPP80M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPP80M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPP80M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPP80M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPP80M), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_out_munic     = dplyr::if_else(!outlier_function(DA_POPP80M), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_min_munic     = dplyr::if_else(DA_POPP80M >= (min(dplyr::lag(DA_POPP80M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_max_munic     = dplyr::if_else(DA_POPP80M <= (max(dplyr::lag(DA_POPP80M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_min_k_munic   = dplyr::if_else(DA_POPP80M >= (min(dplyr::lag(DA_POPP80M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_max_k_munic   = dplyr::if_else(DA_POPP80M <= (k * max(dplyr::lag(DA_POPP80M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_med_mov_munic = dplyr::if_else(DA_POPP80M <= (k * zoo::rollmedian(DA_POPP80M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPP80M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPP80M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_popp80m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_popp80m |> 
  dplyr::select(!DA_POPP80M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_popp80m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_popp80m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_DENSP

```{r rules_dist_da_densp}

## df com o resultado das aplicações das regras
df_rules_dist_da_densp <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_DENSP" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_DENSP"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_DENSP) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_DENSP_hampel_munic  = dplyr::if_else(!hampel_filter(DA_DENSP), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_out_munic     = dplyr::if_else(!outlier_function(DA_DENSP), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_min_munic     = dplyr::if_else(DA_DENSP >= (min(dplyr::lag(DA_DENSP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_max_munic     = dplyr::if_else(DA_DENSP <= (max(dplyr::lag(DA_DENSP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_min_k_munic   = dplyr::if_else(DA_DENSP >= (min(dplyr::lag(DA_DENSP), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_max_k_munic   = dplyr::if_else(DA_DENSP <= (k * max(dplyr::lag(DA_DENSP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_med_mov_munic = dplyr::if_else(DA_DENSP <= (k * zoo::rollmedian(DA_DENSP, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_DENSP_dif_munic     = dplyr::if_else(!compare_first_dif(DA_DENSP), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_densp}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_densp |> 
  dplyr::select(!DA_DENSP) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_densp}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_densp}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_PROPP4E5

```{r rules_dist_da_propp4e5}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp4e5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP4E5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP4E5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP4E5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP4E5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP4E5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_min_munic     = dplyr::if_else(DA_PROPP4E5 >= (min(dplyr::lag(DA_PROPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_max_munic     = dplyr::if_else(DA_PROPP4E5 <= (max(dplyr::lag(DA_PROPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_min_k_munic   = dplyr::if_else(DA_PROPP4E5 >= (min(dplyr::lag(DA_PROPP4E5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_max_k_munic   = dplyr::if_else(DA_PROPP4E5 <= (k * max(dplyr::lag(DA_PROPP4E5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_med_mov_munic = dplyr::if_else(DA_PROPP4E5 <= (k * zoo::rollmedian(DA_PROPP4E5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP4E5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP4E5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp4e5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp4e5 |> 
  dplyr::select(!DA_PROPP4E5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp4e5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp4e5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_PROPP0A5

```{r rules_dist_da_propp0a5}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp0a5 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP0A5" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP0A5"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP0A5) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP0A5_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP0A5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP0A5), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_min_munic     = dplyr::if_else(DA_PROPP0A5 >= (min(dplyr::lag(DA_PROPP0A5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_max_munic     = dplyr::if_else(DA_PROPP0A5 <= (max(dplyr::lag(DA_PROPP0A5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_min_k_munic   = dplyr::if_else(DA_PROPP0A5 >= (min(dplyr::lag(DA_PROPP0A5), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_max_k_munic   = dplyr::if_else(DA_PROPP0A5 <= (k * max(dplyr::lag(DA_PROPP0A5), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_med_mov_munic = dplyr::if_else(DA_PROPP0A5 <= (k * zoo::rollmedian(DA_PROPP0A5, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP0A5_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP0A5), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp0a5}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp0a5 |> 
  dplyr::select(!DA_PROPP0A5) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp0a5}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp0a5}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_PROPP6A17

```{r rules_dist_da_propp6a17}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp6a17 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP6A17" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP6A17"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP6A17) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP6A17_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP6A17), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP6A17), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_min_munic     = dplyr::if_else(DA_PROPP6A17 >= (min(dplyr::lag(DA_PROPP6A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_max_munic     = dplyr::if_else(DA_PROPP6A17 <= (max(dplyr::lag(DA_PROPP6A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_min_k_munic   = dplyr::if_else(DA_PROPP6A17 >= (min(dplyr::lag(DA_PROPP6A17), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_max_k_munic   = dplyr::if_else(DA_PROPP6A17 <= (k * max(dplyr::lag(DA_PROPP6A17), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_med_mov_munic = dplyr::if_else(DA_PROPP6A17 <= (k * zoo::rollmedian(DA_PROPP6A17, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP6A17_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP6A17), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp6a17}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp6a17 |> 
  dplyr::select(!DA_PROPP6A17) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp6a17}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp6a17}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_RDEPP

```{r rules_dist_da_rdepp}

## df com o resultado das aplicações das regras
df_rules_dist_da_rdepp <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_RDEPP" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_RDEPP"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_RDEPP) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_RDEPP_hampel_munic  = dplyr::if_else(!hampel_filter(DA_RDEPP), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_out_munic     = dplyr::if_else(!outlier_function(DA_RDEPP), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_min_munic     = dplyr::if_else(DA_RDEPP >= (min(dplyr::lag(DA_RDEPP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_max_munic     = dplyr::if_else(DA_RDEPP <= (max(dplyr::lag(DA_RDEPP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_min_k_munic   = dplyr::if_else(DA_RDEPP >= (min(dplyr::lag(DA_RDEPP), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_max_k_munic   = dplyr::if_else(DA_RDEPP <= (k * max(dplyr::lag(DA_RDEPP), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_med_mov_munic = dplyr::if_else(DA_RDEPP <= (k * zoo::rollmedian(DA_RDEPP, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_RDEPP_dif_munic     = dplyr::if_else(!compare_first_dif(DA_RDEPP), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_rdepp}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_rdepp |> 
  dplyr::select(!DA_RDEPP) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_rdepp}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_rdepp}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_PROPP15N

```{r rules_dist_da_propp15n}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp15n <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP15N" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP15N"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP15N) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP15N_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP15N), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP15N), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_min_munic     = dplyr::if_else(DA_PROPP15N >= (min(dplyr::lag(DA_PROPP15N), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_max_munic     = dplyr::if_else(DA_PROPP15N <= (max(dplyr::lag(DA_PROPP15N), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_min_k_munic   = dplyr::if_else(DA_PROPP15N >= (min(dplyr::lag(DA_PROPP15N), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_max_k_munic   = dplyr::if_else(DA_PROPP15N <= (k * max(dplyr::lag(DA_PROPP15N), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_med_mov_munic = dplyr::if_else(DA_PROPP15N <= (k * zoo::rollmedian(DA_PROPP15N, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP15N_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP15N), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp15n}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp15n |> 
  dplyr::select(!DA_PROPP15N) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp15n}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp15n}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_PROPP65M

```{r rules_dist_da_propp65m}

## df com o resultado das aplicações das regras
df_rules_dist_da_propp65m <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_PROPP65M" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_PROPP65M"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_PROPP65M) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_PROPP65M_hampel_munic  = dplyr::if_else(!hampel_filter(DA_PROPP65M), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_out_munic     = dplyr::if_else(!outlier_function(DA_PROPP65M), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_min_munic     = dplyr::if_else(DA_PROPP65M >= (min(dplyr::lag(DA_PROPP65M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_max_munic     = dplyr::if_else(DA_PROPP65M <= (max(dplyr::lag(DA_PROPP65M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_min_k_munic   = dplyr::if_else(DA_PROPP65M >= (min(dplyr::lag(DA_PROPP65M), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_max_k_munic   = dplyr::if_else(DA_PROPP65M <= (k * max(dplyr::lag(DA_PROPP65M), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_med_mov_munic = dplyr::if_else(DA_PROPP65M <= (k * zoo::rollmedian(DA_PROPP65M, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_PROPP65M_dif_munic     = dplyr::if_else(!compare_first_dif(DA_PROPP65M), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_propp65m}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_propp65m |> 
  dplyr::select(!DA_PROPP65M) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_propp65m}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_propp65m}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_INDENVE

```{r rules_dist_da_indenve}

## df com o resultado das aplicações das regras
df_rules_dist_da_indenve <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_INDENVE" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_INDENVE"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_INDENVE) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_INDENVE_hampel_munic  = dplyr::if_else(!hampel_filter(DA_INDENVE), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_out_munic     = dplyr::if_else(!outlier_function(DA_INDENVE), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_min_munic     = dplyr::if_else(DA_INDENVE >= (min(dplyr::lag(DA_INDENVE), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_max_munic     = dplyr::if_else(DA_INDENVE <= (max(dplyr::lag(DA_INDENVE), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_min_k_munic   = dplyr::if_else(DA_INDENVE >= (min(dplyr::lag(DA_INDENVE), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_max_k_munic   = dplyr::if_else(DA_INDENVE <= (k * max(dplyr::lag(DA_INDENVE), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_med_mov_munic = dplyr::if_else(DA_INDENVE <= (k * zoo::rollmedian(DA_INDENVE, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_INDENVE_dif_munic     = dplyr::if_else(!compare_first_dif(DA_INDENVE), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_indenve}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_indenve |> 
  dplyr::select(!DA_INDENVE) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_indenve}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_indenve}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_POPPURB

```{r rules_dist_da_poppurb}

## df com o resultado das aplicações das regras
df_rules_dist_da_poppurb <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_POPPURB" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_POPPURB"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_POPPURB) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_POPPURB_hampel_munic  = dplyr::if_else(!hampel_filter(DA_POPPURB), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_out_munic     = dplyr::if_else(!outlier_function(DA_POPPURB), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_min_munic     = dplyr::if_else(DA_POPPURB >= (min(dplyr::lag(DA_POPPURB), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_max_munic     = dplyr::if_else(DA_POPPURB <= (max(dplyr::lag(DA_POPPURB), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_min_k_munic   = dplyr::if_else(DA_POPPURB >= (min(dplyr::lag(DA_POPPURB), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_max_k_munic   = dplyr::if_else(DA_POPPURB <= (k * max(dplyr::lag(DA_POPPURB), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_med_mov_munic = dplyr::if_else(DA_POPPURB <= (k * zoo::rollmedian(DA_POPPURB, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_POPPURB_dif_munic     = dplyr::if_else(!compare_first_dif(DA_POPPURB), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_poppurb}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_poppurb |> 
  dplyr::select(!DA_POPPURB) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_poppurb}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_poppurb}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TFT

```{r rules_dist_da_tft}

## df com o resultado das aplicações das regras
df_rules_dist_da_tft <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TFT" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TFT"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TFT) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TFT_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TFT), F, T), # Longitudinal (município)
    
    DF_DA_TFT_out_munic     = dplyr::if_else(!outlier_function(DA_TFT), F, T), # Longitudinal (município)
    
    DF_DA_TFT_min_munic     = dplyr::if_else(DA_TFT >= (min(dplyr::lag(DA_TFT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TFT_max_munic     = dplyr::if_else(DA_TFT <= (max(dplyr::lag(DA_TFT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TFT_min_k_munic   = dplyr::if_else(DA_TFT >= (min(dplyr::lag(DA_TFT), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TFT_max_k_munic   = dplyr::if_else(DA_TFT <= (k * max(dplyr::lag(DA_TFT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TFT_med_mov_munic = dplyr::if_else(DA_TFT <= (k * zoo::rollmedian(DA_TFT, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TFT_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TFT), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tft}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tft |> 
  dplyr::select(!DA_TFT) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tft}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tft}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TMI

```{r rules_dist_da_tmi}

## df com o resultado das aplicações das regras
df_rules_dist_da_tmi <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TMI" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TMI"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TMI) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TMI_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TMI), F, T), # Longitudinal (município)
    
    DF_DA_TMI_out_munic     = dplyr::if_else(!outlier_function(DA_TMI), F, T), # Longitudinal (município)
    
    DF_DA_TMI_min_munic     = dplyr::if_else(DA_TMI >= (min(dplyr::lag(DA_TMI), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TMI_max_munic     = dplyr::if_else(DA_TMI <= (max(dplyr::lag(DA_TMI), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TMI_min_k_munic   = dplyr::if_else(DA_TMI >= (min(dplyr::lag(DA_TMI), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TMI_max_k_munic   = dplyr::if_else(DA_TMI <= (k * max(dplyr::lag(DA_TMI), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TMI_med_mov_munic = dplyr::if_else(DA_TMI <= (k * zoo::rollmedian(DA_TMI, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TMI_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TMI), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tmi}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tmi |> 
  dplyr::select(!DA_TMI) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tmi}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tmi}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_ESPVIDA

```{r rules_dist_da_espvida}

## df com o resultado das aplicações das regras
df_rules_dist_da_espvida <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_ESPVIDA" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_ESPVIDA"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_ESPVIDA) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_ESPVIDA_hampel_munic  = dplyr::if_else(!hampel_filter(DA_ESPVIDA), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_out_munic     = dplyr::if_else(!outlier_function(DA_ESPVIDA), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_min_munic     = dplyr::if_else(DA_ESPVIDA >= (min(dplyr::lag(DA_ESPVIDA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_max_munic     = dplyr::if_else(DA_ESPVIDA <= (max(dplyr::lag(DA_ESPVIDA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_min_k_munic   = dplyr::if_else(DA_ESPVIDA >= (min(dplyr::lag(DA_ESPVIDA), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_max_k_munic   = dplyr::if_else(DA_ESPVIDA <= (k * max(dplyr::lag(DA_ESPVIDA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_med_mov_munic = dplyr::if_else(DA_ESPVIDA <= (k * zoo::rollmedian(DA_ESPVIDA, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_ESPVIDA_dif_munic     = dplyr::if_else(!compare_first_dif(DA_ESPVIDA), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_espvida}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_espvida |> 
  dplyr::select(!DA_ESPVIDA) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_espvida}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_espvida}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TBM

```{r rules_dist_DA_TBM}

## df com o resultado das aplicações das regras
df_rules_dist_da_tbm <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TBM" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TBM"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TBM) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TBM_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TBM), F, T), # Longitudinal (município)
    
    DF_DA_TBM_out_munic     = dplyr::if_else(!outlier_function(DA_TBM), F, T), # Longitudinal (município)
    
    DF_DA_TBM_min_munic     = dplyr::if_else(DA_TBM >= (min(dplyr::lag(DA_TBM), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TBM_max_munic     = dplyr::if_else(DA_TBM <= (max(dplyr::lag(DA_TBM), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TBM_min_k_munic   = dplyr::if_else(DA_TBM >= (min(dplyr::lag(DA_TBM), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TBM_max_k_munic   = dplyr::if_else(DA_TBM <= (k * max(dplyr::lag(DA_TBM), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TBM_med_mov_munic = dplyr::if_else(DA_TBM <= (k * zoo::rollmedian(DA_TBM, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TBM_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TBM), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tbm}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tbm |> 
  dplyr::select(!DA_TBM) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tbm}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tbm}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TBN

```{r rules_dist_da_tbn}

## df com o resultado das aplicações das regras
df_rules_dist_da_tbn <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TBN" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TBN"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TBN) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TBN_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TBN), F, T), # Longitudinal (município)
    
    DF_DA_TBN_out_munic     = dplyr::if_else(!outlier_function(DA_TBN), F, T), # Longitudinal (município)
    
    DF_DA_TBN_min_munic     = dplyr::if_else(DA_TBN >= (min(dplyr::lag(DA_TBN), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TBN_max_munic     = dplyr::if_else(DA_TBN <= (max(dplyr::lag(DA_TBN), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TBN_min_k_munic   = dplyr::if_else(DA_TBN >= (min(dplyr::lag(DA_TBN), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TBN_max_k_munic   = dplyr::if_else(DA_TBN <= (k * max(dplyr::lag(DA_TBN), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TBN_med_mov_munic = dplyr::if_else(DA_TBN <= (k * zoo::rollmedian(DA_TBN, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TBN_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TBN), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tbn}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tbn |> 
  dplyr::select(!DA_TBN) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tbn}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tbn}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TCV

```{r rules_dist_da_tcv}

## df com o resultado das aplicações das regras
df_rules_dist_da_tcv <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TCV" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TCV"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TCV) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TCV_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TCV), F, T), # Longitudinal (município)
    
    DF_DA_TCV_out_munic     = dplyr::if_else(!outlier_function(DA_TCV), F, T), # Longitudinal (município)
    
    DF_DA_TCV_min_munic     = dplyr::if_else(DA_TCV >= (min(dplyr::lag(DA_TCV), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TCV_max_munic     = dplyr::if_else(DA_TCV <= (max(dplyr::lag(DA_TCV), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TCV_min_k_munic   = dplyr::if_else(DA_TCV >= (min(dplyr::lag(DA_TCV), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TCV_max_k_munic   = dplyr::if_else(DA_TCV <= (k * max(dplyr::lag(DA_TCV), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TCV_med_mov_munic = dplyr::if_else(DA_TCV <= (k * zoo::rollmedian(DA_TCV, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TCV_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TCV), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tcv}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tcv |> 
  dplyr::select(!DA_TCV) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tcv}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tcv}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TLM

```{r rules_dist_da_tlm}

## df com o resultado das aplicações das regras
df_rules_dist_da_tlm <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TLM" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TLM"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TLM) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TLM_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TLM), F, T), # Longitudinal (município)
    
    DF_DA_TLM_out_munic     = dplyr::if_else(!outlier_function(DA_TLM), F, T), # Longitudinal (município)
    
    DF_DA_TLM_min_munic     = dplyr::if_else(DA_TLM >= (min(dplyr::lag(DA_TLM), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TLM_max_munic     = dplyr::if_else(DA_TLM <= (max(dplyr::lag(DA_TLM), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TLM_min_k_munic   = dplyr::if_else(DA_TLM >= (min(dplyr::lag(DA_TLM), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TLM_max_k_munic   = dplyr::if_else(DA_TLM <= (k * max(dplyr::lag(DA_TLM), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TLM_med_mov_munic = dplyr::if_else(DA_TLM <= (k * zoo::rollmedian(DA_TLM, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TLM_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TLM), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tlm}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tlm |> 
  dplyr::select(!DA_TLM) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tlm}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tlm}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_TCD

```{r rules_dist_da_tcd}

## df com o resultado das aplicações das regras
df_rules_dist_da_tcd <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_TCD" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_TCD"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_TCD) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_TCD_hampel_munic  = dplyr::if_else(!hampel_filter(DA_TCD), F, T), # Longitudinal (município)
    
    DF_DA_TCD_out_munic     = dplyr::if_else(!outlier_function(DA_TCD), F, T), # Longitudinal (município)
    
    DF_DA_TCD_min_munic     = dplyr::if_else(DA_TCD >= (min(dplyr::lag(DA_TCD), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TCD_max_munic     = dplyr::if_else(DA_TCD <= (max(dplyr::lag(DA_TCD), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TCD_min_k_munic   = dplyr::if_else(DA_TCD >= (min(dplyr::lag(DA_TCD), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_TCD_max_k_munic   = dplyr::if_else(DA_TCD <= (k * max(dplyr::lag(DA_TCD), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_TCD_med_mov_munic = dplyr::if_else(DA_TCD <= (k * zoo::rollmedian(DA_TCD, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_TCD_dif_munic     = dplyr::if_else(!compare_first_dif(DA_TCD), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_tcd}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_tcd |> 
  dplyr::select(!DA_TCD) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_tcd}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_tcd}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_EMIGRA

```{r rules_dist_da_emigra}

## df com o resultado das aplicações das regras
df_rules_dist_da_emigra <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_EMIGRA" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_EMIGRA"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_EMIGRA) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_EMIGRA_hampel_munic  = dplyr::if_else(!hampel_filter(DA_EMIGRA), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_out_munic     = dplyr::if_else(!outlier_function(DA_EMIGRA), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_min_munic     = dplyr::if_else(DA_EMIGRA >= (min(dplyr::lag(DA_EMIGRA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_max_munic     = dplyr::if_else(DA_EMIGRA <= (max(dplyr::lag(DA_EMIGRA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_min_k_munic   = dplyr::if_else(DA_EMIGRA >= (min(dplyr::lag(DA_EMIGRA), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_max_k_munic   = dplyr::if_else(DA_EMIGRA <= (k * max(dplyr::lag(DA_EMIGRA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_med_mov_munic = dplyr::if_else(DA_EMIGRA <= (k * zoo::rollmedian(DA_EMIGRA, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_EMIGRA_dif_munic     = dplyr::if_else(!compare_first_dif(DA_EMIGRA), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_emigra}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_emigra |> 
  dplyr::select(!DA_EMIGRA) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_emigra}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_emigra}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_IMIGRA

```{r rules_dist_da_imigra}

## df com o resultado das aplicações das regras
df_rules_dist_da_imigra <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_IMIGRA" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_IMIGRA"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_IMIGRA) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_IMIGRA_hampel_munic  = dplyr::if_else(!hampel_filter(DA_IMIGRA), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_out_munic     = dplyr::if_else(!outlier_function(DA_IMIGRA), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_min_munic     = dplyr::if_else(DA_IMIGRA >= (min(dplyr::lag(DA_IMIGRA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_max_munic     = dplyr::if_else(DA_IMIGRA <= (max(dplyr::lag(DA_IMIGRA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_min_k_munic   = dplyr::if_else(DA_IMIGRA >= (min(dplyr::lag(DA_IMIGRA), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_max_k_munic   = dplyr::if_else(DA_IMIGRA <= (k * max(dplyr::lag(DA_IMIGRA), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_med_mov_munic = dplyr::if_else(DA_IMIGRA <= (k * zoo::rollmedian(DA_IMIGRA, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_IMIGRA_dif_munic     = dplyr::if_else(!compare_first_dif(DA_IMIGRA), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_imigra}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_imigra |> 
  dplyr::select(!DA_IMIGRA) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_imigra}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_imigra}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM0A4

```{r rules_dist_da_homem0a4}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem0a4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM0A4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM0A4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM0A4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM0A4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM0A4), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM0A4), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_min_munic     = dplyr::if_else(DA_HOMEM0A4 >= (min(dplyr::lag(DA_HOMEM0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_max_munic     = dplyr::if_else(DA_HOMEM0A4 <= (max(dplyr::lag(DA_HOMEM0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_min_k_munic   = dplyr::if_else(DA_HOMEM0A4 >= (min(dplyr::lag(DA_HOMEM0A4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_max_k_munic   = dplyr::if_else(DA_HOMEM0A4 <= (k * max(dplyr::lag(DA_HOMEM0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_med_mov_munic = dplyr::if_else(DA_HOMEM0A4 <= (k * zoo::rollmedian(DA_HOMEM0A4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM0A4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM0A4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem0a4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem0a4 |> 
  dplyr::select(!DA_HOMEM0A4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem0a4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem0a4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM5A9

```{r rules_dist_da_homem5a9}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem5a9 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM5A9" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM5A9"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM5A9) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM5A9_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM5A9), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM5A9), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_min_munic     = dplyr::if_else(DA_HOMEM5A9 >= (min(dplyr::lag(DA_HOMEM5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_max_munic     = dplyr::if_else(DA_HOMEM5A9 <= (max(dplyr::lag(DA_HOMEM5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_min_k_munic   = dplyr::if_else(DA_HOMEM5A9 >= (min(dplyr::lag(DA_HOMEM5A9), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_max_k_munic   = dplyr::if_else(DA_HOMEM5A9 <= (k * max(dplyr::lag(DA_HOMEM5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_med_mov_munic = dplyr::if_else(DA_HOMEM5A9 <= (k * zoo::rollmedian(DA_HOMEM5A9, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM5A9_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM5A9), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem5a9}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem5a9 |> 
  dplyr::select(!DA_HOMEM5A9) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem5a9}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem5a9}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM10A14

```{r rules_dist_da_homem10a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem10a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM10A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM10A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM10A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM10A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM10A14), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM10A14), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_min_munic     = dplyr::if_else(DA_HOMEM10A14 >= (min(dplyr::lag(DA_HOMEM10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_max_munic     = dplyr::if_else(DA_HOMEM10A14 <= (max(dplyr::lag(DA_HOMEM10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_min_k_munic   = dplyr::if_else(DA_HOMEM10A14 >= (min(dplyr::lag(DA_HOMEM10A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_max_k_munic   = dplyr::if_else(DA_HOMEM10A14 <= (k * max(dplyr::lag(DA_HOMEM10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_med_mov_munic = dplyr::if_else(DA_HOMEM10A14 <= (k * zoo::rollmedian(DA_HOMEM10A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM10A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM10A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem10a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem10a14 |> 
  dplyr::select(!DA_HOMEM10A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem10a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem10a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM15A19

```{r rules_dist_da_homem15a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem15a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM15A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM15A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM15A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM15A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM15A19), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM15A19), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_min_munic     = dplyr::if_else(DA_HOMEM15A19 >= (min(dplyr::lag(DA_HOMEM15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_max_munic     = dplyr::if_else(DA_HOMEM15A19 <= (max(dplyr::lag(DA_HOMEM15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_min_k_munic   = dplyr::if_else(DA_HOMEM15A19 >= (min(dplyr::lag(DA_HOMEM15A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_max_k_munic   = dplyr::if_else(DA_HOMEM15A19 <= (k * max(dplyr::lag(DA_HOMEM15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_med_mov_munic = dplyr::if_else(DA_HOMEM15A19 <= (k * zoo::rollmedian(DA_HOMEM15A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM15A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM15A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem15a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem15a19 |> 
  dplyr::select(!DA_HOMEM15A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem15a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem15a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM20A24

```{r rules_dist_da_homem20a24}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem20a24 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM20A24" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM20A24"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM20A24) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM20A24_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM20A24), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM20A24), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_min_munic     = dplyr::if_else(DA_HOMEM20A24 >= (min(dplyr::lag(DA_HOMEM20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_max_munic     = dplyr::if_else(DA_HOMEM20A24 <= (max(dplyr::lag(DA_HOMEM20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_min_k_munic   = dplyr::if_else(DA_HOMEM20A24 >= (min(dplyr::lag(DA_HOMEM20A24), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_max_k_munic   = dplyr::if_else(DA_HOMEM20A24 <= (k * max(dplyr::lag(DA_HOMEM20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_med_mov_munic = dplyr::if_else(DA_HOMEM20A24 <= (k * zoo::rollmedian(DA_HOMEM20A24, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM20A24_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM20A24), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem20a24}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem20a24 |> 
  dplyr::select(!DA_HOMEM20A24) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem20a24}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem20a24}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM25A29

```{r rules_dist_da_homem25a29}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem25a29 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM25A29" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM25A29"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM25A29) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM25A29_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM25A29), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM25A29), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_min_munic     = dplyr::if_else(DA_HOMEM25A29 >= (min(dplyr::lag(DA_HOMEM25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_max_munic     = dplyr::if_else(DA_HOMEM25A29 <= (max(dplyr::lag(DA_HOMEM25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_min_k_munic   = dplyr::if_else(DA_HOMEM25A29 >= (min(dplyr::lag(DA_HOMEM25A29), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_max_k_munic   = dplyr::if_else(DA_HOMEM25A29 <= (k * max(dplyr::lag(DA_HOMEM25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_med_mov_munic = dplyr::if_else(DA_HOMEM25A29 <= (k * zoo::rollmedian(DA_HOMEM25A29, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM25A29_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM25A29), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem25a29}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem25a29 |> 
  dplyr::select(!DA_HOMEM25A29) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem25a29}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem25a29}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM30A34

```{r rules_dist_da_homem30a34}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem30a34 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM30A34" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM30A34"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM30A34) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM30A34_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM30A34), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM30A34), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_min_munic     = dplyr::if_else(DA_HOMEM30A34 >= (min(dplyr::lag(DA_HOMEM30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_max_munic     = dplyr::if_else(DA_HOMEM30A34 <= (max(dplyr::lag(DA_HOMEM30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_min_k_munic   = dplyr::if_else(DA_HOMEM30A34 >= (min(dplyr::lag(DA_HOMEM30A34), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_max_k_munic   = dplyr::if_else(DA_HOMEM30A34 <= (k * max(dplyr::lag(DA_HOMEM30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_med_mov_munic = dplyr::if_else(DA_HOMEM30A34 <= (k * zoo::rollmedian(DA_HOMEM30A34, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM30A34_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM30A34), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem30a34}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem30a34 |> 
  dplyr::select(!DA_HOMEM30A34) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem30a34}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem30a34}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM35A39

```{r rules_dist_da_homem35a39}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem35a39 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM35A39" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM35A39"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM35A39) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM35A39_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM35A39), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM35A39), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_min_munic     = dplyr::if_else(DA_HOMEM35A39 >= (min(dplyr::lag(DA_HOMEM35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_max_munic     = dplyr::if_else(DA_HOMEM35A39 <= (max(dplyr::lag(DA_HOMEM35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_min_k_munic   = dplyr::if_else(DA_HOMEM35A39 >= (min(dplyr::lag(DA_HOMEM35A39), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_max_k_munic   = dplyr::if_else(DA_HOMEM35A39 <= (k * max(dplyr::lag(DA_HOMEM35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_med_mov_munic = dplyr::if_else(DA_HOMEM35A39 <= (k * zoo::rollmedian(DA_HOMEM35A39, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM35A39_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM35A39), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem35a39}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem35a39 |> 
  dplyr::select(!DA_HOMEM35A39) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem35a39}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem35a39}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM40A44

```{r rules_dist_da_homem40a44}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem40a44 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM40A44" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM40A44"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM40A44) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM40A44_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM40A44), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM40A44), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_min_munic     = dplyr::if_else(DA_HOMEM40A44 >= (min(dplyr::lag(DA_HOMEM40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_max_munic     = dplyr::if_else(DA_HOMEM40A44 <= (max(dplyr::lag(DA_HOMEM40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_min_k_munic   = dplyr::if_else(DA_HOMEM40A44 >= (min(dplyr::lag(DA_HOMEM40A44), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_max_k_munic   = dplyr::if_else(DA_HOMEM40A44 <= (k * max(dplyr::lag(DA_HOMEM40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_med_mov_munic = dplyr::if_else(DA_HOMEM40A44 <= (k * zoo::rollmedian(DA_HOMEM40A44, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM40A44_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM40A44), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem40a44}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem40a44 |> 
  dplyr::select(!DA_HOMEM40A44) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem40a44}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem40a44}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM45A49

```{r rules_dist_da_homem45a49}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem45a49 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM45A49" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM45A49"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM45A49) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM45A49_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM45A49), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM45A49), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_min_munic     = dplyr::if_else(DA_HOMEM45A49 >= (min(dplyr::lag(DA_HOMEM45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_max_munic     = dplyr::if_else(DA_HOMEM45A49 <= (max(dplyr::lag(DA_HOMEM45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_min_k_munic   = dplyr::if_else(DA_HOMEM45A49 >= (min(dplyr::lag(DA_HOMEM45A49), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_max_k_munic   = dplyr::if_else(DA_HOMEM45A49 <= (k * max(dplyr::lag(DA_HOMEM45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_med_mov_munic = dplyr::if_else(DA_HOMEM45A49 <= (k * zoo::rollmedian(DA_HOMEM45A49, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM45A49_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM45A49), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem45a49}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem45a49 |> 
  dplyr::select(!DA_HOMEM45A49) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem45a49}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem45a49}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM50A54

```{r rules_dist_da_homem50a54}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem50a54 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM50A54" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM50A54"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM50A54) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM50A54_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM50A54), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM50A54), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_min_munic     = dplyr::if_else(DA_HOMEM50A54  >= (min(dplyr::lag(DA_HOMEM50A54 ), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_max_munic     = dplyr::if_else(DA_HOMEM50A54  <= (max(dplyr::lag(DA_HOMEM50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_min_k_munic   = dplyr::if_else(DA_HOMEM50A54  >= (min(dplyr::lag(DA_HOMEM50A54), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_max_k_munic   = dplyr::if_else(DA_HOMEM50A54  <= (k * max(dplyr::lag(DA_HOMEM50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_med_mov_munic = dplyr::if_else(DA_HOMEM50A54  <= (k * zoo::rollmedian(DA_HOMEM50A54 , k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM50A54_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM50A54), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem50a54}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem50a54 |> 
  dplyr::select(!DA_HOMEM50A54 ) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem50a54}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem50a54}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM55A59

```{r rules_dist_da_homem55a59}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem55a59 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM55A59" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM55A59"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM55A59) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM55A59_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM55A59), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM55A59), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_min_munic     = dplyr::if_else(DA_HOMEM55A59 >= (min(dplyr::lag(DA_HOMEM55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_max_munic     = dplyr::if_else(DA_HOMEM55A59 <= (max(dplyr::lag(DA_HOMEM55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_min_k_munic   = dplyr::if_else(DA_HOMEM55A59 >= (min(dplyr::lag(DA_HOMEM55A59), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_max_k_munic   = dplyr::if_else(DA_HOMEM55A59 <= (k * max(dplyr::lag(DA_HOMEM55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_med_mov_munic = dplyr::if_else(DA_HOMEM55A59 <= (k * zoo::rollmedian(DA_HOMEM55A59, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM55A59_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM55A59), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem55a59}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem55a59 |> 
  dplyr::select(!DA_HOMEM55A59) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem55a59}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem55a59}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM60A64

```{r rules_dist_da_homem60a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem60a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM60A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM60A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM60A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM60A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM60A64), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM60A64), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_min_munic     = dplyr::if_else(DA_HOMEM60A64 >= (min(dplyr::lag(DA_HOMEM60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_max_munic     = dplyr::if_else(DA_HOMEM60A64 <= (max(dplyr::lag(DA_HOMEM60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_min_k_munic   = dplyr::if_else(DA_HOMEM60A64 >= (min(dplyr::lag(DA_HOMEM60A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_max_k_munic   = dplyr::if_else(DA_HOMEM60A64 <= (k * max(dplyr::lag(DA_HOMEM60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_med_mov_munic = dplyr::if_else(DA_HOMEM60A64 <= (k * zoo::rollmedian(DA_HOMEM60A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM60A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM60A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem60a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem60a64 |> 
  dplyr::select(!DA_HOMEM60A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem60a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem60a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM65A69

```{r rules_dist_da_homem65a69}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem65a69 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM65A69" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM65A69"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM65A69) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM65A69_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM65A69), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM65A69), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_min_munic     = dplyr::if_else(DA_HOMEM65A69 >= (min(dplyr::lag(DA_HOMEM65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_max_munic     = dplyr::if_else(DA_HOMEM65A69 <= (max(dplyr::lag(DA_HOMEM65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_min_k_munic   = dplyr::if_else(DA_HOMEM65A69 >= (min(dplyr::lag(DA_HOMEM65A69), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_max_k_munic   = dplyr::if_else(DA_HOMEM65A69 <= (k * max(dplyr::lag(DA_HOMEM65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_med_mov_munic = dplyr::if_else(DA_HOMEM65A69 <= (k * zoo::rollmedian(DA_HOMEM65A69, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM65A69_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM65A69), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem65a69}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem65a69 |> 
  dplyr::select(!DA_HOMEM65A69) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem65a69}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem65a69}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM70A74

```{r rules_dist_da_homem70a74}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem70a74 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM70A74" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM70A74"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM70A74) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM70A74_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM70A74), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM70A74), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_min_munic     = dplyr::if_else(DA_HOMEM70A74 >= (min(dplyr::lag(DA_HOMEM70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_max_munic     = dplyr::if_else(DA_HOMEM70A74 <= (max(dplyr::lag(DA_HOMEM70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_min_k_munic   = dplyr::if_else(DA_HOMEM70A74 >= (min(dplyr::lag(DA_HOMEM70A74), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_max_k_munic   = dplyr::if_else(DA_HOMEM70A74 <= (k * max(dplyr::lag(DA_HOMEM70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_med_mov_munic = dplyr::if_else(DA_HOMEM70A74 <= (k * zoo::rollmedian(DA_HOMEM70A74, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM70A74_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM70A74), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem70a74}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem70a74 |> 
  dplyr::select(!DA_HOMEM70A74) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem70a74}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem70a74}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM75A79

```{r rules_dist_da_homem75a79}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem75a79 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM75A79" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM75A79"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM75A79) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM75A79_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM75A79), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM75A79), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_min_munic     = dplyr::if_else(DA_HOMEM75A79 >= (min(dplyr::lag(DA_HOMEM75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_max_munic     = dplyr::if_else(DA_HOMEM75A79 <= (max(dplyr::lag(DA_HOMEM75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_min_k_munic   = dplyr::if_else(DA_HOMEM75A79 >= (min(dplyr::lag(DA_HOMEM75A79), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_max_k_munic   = dplyr::if_else(DA_HOMEM75A79 <= (k * max(dplyr::lag(DA_HOMEM75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_med_mov_munic = dplyr::if_else(DA_HOMEM75A79 <= (k * zoo::rollmedian(DA_HOMEM75A79, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM75A79_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM75A79), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem75a79}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem75a79 |> 
  dplyr::select(!DA_HOMEM75A79) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem75a79}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem75a79}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEM80

```{r rules_dist_da_homem80}

## df com o resultado das aplicações das regras
df_rules_dist_da_homem80 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEM80" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEM80"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEM80) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEM80_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEM80), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEM80), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_min_munic     = dplyr::if_else(DA_HOMEM80 >= (min(dplyr::lag(DA_HOMEM80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_max_munic     = dplyr::if_else(DA_HOMEM80 <= (max(dplyr::lag(DA_HOMEM80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_min_k_munic   = dplyr::if_else(DA_HOMEM80 >= (min(dplyr::lag(DA_HOMEM80), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_max_k_munic   = dplyr::if_else(DA_HOMEM80 <= (k * max(dplyr::lag(DA_HOMEM80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_med_mov_munic = dplyr::if_else(DA_HOMEM80 <= (k * zoo::rollmedian(DA_HOMEM80, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEM80_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEM80), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homem80}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homem80 |> 
  dplyr::select(!DA_HOMEM80) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homem80}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homem80}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH0A4

```{r rules_dist_da_mulh0a4}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh0a4 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH0A4" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH0A4"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH0A4) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH0A4_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH0A4), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_out_munic     = dplyr::if_else(!outlier_function(DA_MULH0A4), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_min_munic     = dplyr::if_else(DA_MULH0A4 >= (min(dplyr::lag(DA_MULH0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_max_munic     = dplyr::if_else(DA_MULH0A4 <= (max(dplyr::lag(DA_MULH0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_min_k_munic   = dplyr::if_else(DA_MULH0A4 >= (min(dplyr::lag(DA_MULH0A4), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_max_k_munic   = dplyr::if_else(DA_MULH0A4 <= (k * max(dplyr::lag(DA_MULH0A4), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_med_mov_munic = dplyr::if_else(DA_MULH0A4 <= (k * zoo::rollmedian(DA_MULH0A4, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH0A4_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH0A4), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh0a4}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh0a4 |> 
  dplyr::select(!DA_MULH0A4) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh0a4}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh0a4}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH5A9

```{r rules_dist_da_mulh5a9}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh5a9 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH5A9" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH5A9"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH5A9) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH5A9_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH5A9), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_out_munic     = dplyr::if_else(!outlier_function(DA_MULH5A9), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_min_munic     = dplyr::if_else(DA_MULH5A9 >= (min(dplyr::lag(DA_MULH5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_max_munic     = dplyr::if_else(DA_MULH5A9 <= (max(dplyr::lag(DA_MULH5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_min_k_munic   = dplyr::if_else(DA_MULH5A9 >= (min(dplyr::lag(DA_MULH5A9), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_max_k_munic   = dplyr::if_else(DA_MULH5A9 <= (k * max(dplyr::lag(DA_MULH5A9), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_med_mov_munic = dplyr::if_else(DA_MULH5A9 <= (k * zoo::rollmedian(DA_MULH5A9, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH5A9_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH5A9), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh5a9}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh5a9 |> 
  dplyr::select(!DA_MULH5A9) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh5a9}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh5a9}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH10A14

```{r rules_dist_da_mulh10a14}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh10a14 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH10A14" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH10A14"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH10A14) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH10A14_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH10A14), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_out_munic     = dplyr::if_else(!outlier_function(DA_MULH10A14), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_min_munic     = dplyr::if_else(DA_MULH10A14 >= (min(dplyr::lag(DA_MULH10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_max_munic     = dplyr::if_else(DA_MULH10A14 <= (max(dplyr::lag(DA_MULH10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_min_k_munic   = dplyr::if_else(DA_MULH10A14 >= (min(dplyr::lag(DA_MULH10A14), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_max_k_munic   = dplyr::if_else(DA_MULH10A14 <= (k * max(dplyr::lag(DA_MULH10A14), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_med_mov_munic = dplyr::if_else(DA_MULH10A14 <= (k * zoo::rollmedian(DA_MULH10A14, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH10A14_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH10A14), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh10a14}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh10a14 |> 
  dplyr::select(!DA_MULH10A14) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh10a14}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh10a14}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH15A19

```{r rules_dist_da_mulh15a19}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh15a19 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH15A19" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH15A19"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH15A19) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH15A19_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH15A19), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_out_munic     = dplyr::if_else(!outlier_function(DA_MULH15A19), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_min_munic     = dplyr::if_else(DA_MULH15A19 >= (min(dplyr::lag(DA_MULH15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_max_munic     = dplyr::if_else(DA_MULH15A19 <= (max(dplyr::lag(DA_MULH15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_min_k_munic   = dplyr::if_else(DA_MULH15A19 >= (min(dplyr::lag(DA_MULH15A19), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_max_k_munic   = dplyr::if_else(DA_MULH15A19 <= (k * max(dplyr::lag(DA_MULH15A19), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_med_mov_munic = dplyr::if_else(DA_MULH15A19 <= (k * zoo::rollmedian(DA_MULH15A19, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH15A19_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH15A19), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh15a19}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh15a19 |> 
  dplyr::select(!DA_MULH15A19) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh15a19}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh15a19}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH20A24

```{r rules_dist_da_mulh20a24}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh20a24 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH20A24" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH20A24"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH20A24) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH20A24_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH20A24), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_out_munic     = dplyr::if_else(!outlier_function(DA_MULH20A24), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_min_munic     = dplyr::if_else(DA_MULH20A24 >= (min(dplyr::lag(DA_MULH20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_max_munic     = dplyr::if_else(DA_MULH20A24 <= (max(dplyr::lag(DA_MULH20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_min_k_munic   = dplyr::if_else(DA_MULH20A24 >= (min(dplyr::lag(DA_MULH20A24), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_max_k_munic   = dplyr::if_else(DA_MULH20A24 <= (k * max(dplyr::lag(DA_MULH20A24), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_med_mov_munic = dplyr::if_else(DA_MULH20A24 <= (k * zoo::rollmedian(DA_MULH20A24, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH20A24_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH20A24), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh20a24}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh20a24 |> 
  dplyr::select(!DA_MULH20A24) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh20a24}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh20a24}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH25A29

```{r rules_dist_da_mulh25a29}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh25a29 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH25A29" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH25A29"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH25A29) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH25A29_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH25A29), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_out_munic     = dplyr::if_else(!outlier_function(DA_MULH25A29), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_min_munic     = dplyr::if_else(DA_MULH25A29 >= (min(dplyr::lag(DA_MULH25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_max_munic     = dplyr::if_else(DA_MULH25A29 <= (max(dplyr::lag(DA_MULH25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_min_k_munic   = dplyr::if_else(DA_MULH25A29 >= (min(dplyr::lag(DA_MULH25A29), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_max_k_munic   = dplyr::if_else(DA_MULH25A29 <= (k * max(dplyr::lag(DA_MULH25A29), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_med_mov_munic = dplyr::if_else(DA_MULH25A29 <= (k * zoo::rollmedian(DA_MULH25A29, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH25A29_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH25A29), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh25a29}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh25a29 |> 
  dplyr::select(!DA_MULH25A29) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh25a29}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh25a29}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH30A34

```{r rules_dist_da_mulh30a34}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh30a34 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH30A34" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH30A34"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH30A34) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH30A34_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH30A34), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_out_munic     = dplyr::if_else(!outlier_function(DA_MULH30A34), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_min_munic     = dplyr::if_else(DA_MULH30A34 >= (min(dplyr::lag(DA_MULH30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_max_munic     = dplyr::if_else(DA_MULH30A34 <= (max(dplyr::lag(DA_MULH30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_min_k_munic   = dplyr::if_else(DA_MULH30A34 >= (min(dplyr::lag(DA_MULH30A34), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_max_k_munic   = dplyr::if_else(DA_MULH30A34 <= (k * max(dplyr::lag(DA_MULH30A34), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_med_mov_munic = dplyr::if_else(DA_MULH30A34 <= (k * zoo::rollmedian(DA_MULH30A34, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH30A34_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH30A34), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh30a34}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh30a34 |> 
  dplyr::select(!DA_MULH30A34) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh30a34}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh30a34}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH35A39

```{r rules_dist_da_mulh35a39}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh35a39 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH35A39" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH35A39"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH35A39) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH35A39_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH35A39), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_out_munic     = dplyr::if_else(!outlier_function(DA_MULH35A39), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_min_munic     = dplyr::if_else(DA_MULH35A39 >= (min(dplyr::lag(DA_MULH35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_max_munic     = dplyr::if_else(DA_MULH35A39 <= (max(dplyr::lag(DA_MULH35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_min_k_munic   = dplyr::if_else(DA_MULH35A39 >= (min(dplyr::lag(DA_MULH35A39), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_max_k_munic   = dplyr::if_else(DA_MULH35A39 <= (k * max(dplyr::lag(DA_MULH35A39), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_med_mov_munic = dplyr::if_else(DA_MULH35A39 <= (k * zoo::rollmedian(DA_MULH35A39, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH35A39_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH35A39), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh35a39}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh35a39 |> 
  dplyr::select(!DA_MULH35A39) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh35a39}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh35a39}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH40A44

```{r rules_dist_da_mulh40a44}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh40a44 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH40A44" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH40A44"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH40A44) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH40A44_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH40A44), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_out_munic     = dplyr::if_else(!outlier_function(DA_MULH40A44), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_min_munic     = dplyr::if_else(DA_MULH40A44 >= (min(dplyr::lag(DA_MULH40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_max_munic     = dplyr::if_else(DA_MULH40A44 <= (max(dplyr::lag(DA_MULH40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_min_k_munic   = dplyr::if_else(DA_MULH40A44 >= (min(dplyr::lag(DA_MULH40A44), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_max_k_munic   = dplyr::if_else(DA_MULH40A44 <= (k * max(dplyr::lag(DA_MULH40A44), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_med_mov_munic = dplyr::if_else(DA_MULH40A44 <= (k * zoo::rollmedian(DA_MULH40A44, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH40A44_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH40A44), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh40a44}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh40a44 |> 
  dplyr::select(!DA_MULH40A44) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh40a44}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh40a44}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH45A49

```{r rules_dist_da_mulh45a49}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh45a49 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH45A49" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH45A49"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH45A49) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH45A49_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH45A49), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_out_munic     = dplyr::if_else(!outlier_function(DA_MULH45A49), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_min_munic     = dplyr::if_else(DA_MULH45A49 >= (min(dplyr::lag(DA_MULH45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_max_munic     = dplyr::if_else(DA_MULH45A49 <= (max(dplyr::lag(DA_MULH45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_min_k_munic   = dplyr::if_else(DA_MULH45A49 >= (min(dplyr::lag(DA_MULH45A49), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_max_k_munic   = dplyr::if_else(DA_MULH45A49 <= (k * max(dplyr::lag(DA_MULH45A49), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_med_mov_munic = dplyr::if_else(DA_MULH45A49 <= (k * zoo::rollmedian(DA_MULH45A49, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH45A49_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH45A49), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh45a49}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh45a49 |> 
  dplyr::select(!DA_MULH45A49) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh45a49}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh45a49}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH50A54

```{r rules_dist_da_mulh50a54}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh50a54 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH50A54" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH50A54"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH50A54) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH50A54_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH50A54), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_out_munic     = dplyr::if_else(!outlier_function(DA_MULH50A54), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_min_munic     = dplyr::if_else(DA_MULH50A54 >= (min(dplyr::lag(DA_MULH50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_max_munic     = dplyr::if_else(DA_MULH50A54 <= (max(dplyr::lag(DA_MULH50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_min_k_munic   = dplyr::if_else(DA_MULH50A54 >= (min(dplyr::lag(DA_MULH50A54), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_max_k_munic   = dplyr::if_else(DA_MULH50A54 <= (k * max(dplyr::lag(DA_MULH50A54), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_med_mov_munic = dplyr::if_else(DA_MULH50A54 <= (k * zoo::rollmedian(DA_MULH50A54, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH50A54_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH50A54), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh50a54}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh50a54 |> 
  dplyr::select(!DA_MULH50A54) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh50a54}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh50a54}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH55A59

```{r rules_dist_da_mulh55a59}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh55a59 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH55A59" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH55A59"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH55A59) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH55A59_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH55A59), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_out_munic     = dplyr::if_else(!outlier_function(DA_MULH55A59), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_min_munic     = dplyr::if_else(DA_MULH55A59 >= (min(dplyr::lag(DA_MULH55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_max_munic     = dplyr::if_else(DA_MULH55A59 <= (max(dplyr::lag(DA_MULH55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_min_k_munic   = dplyr::if_else(DA_MULH55A59 >= (min(dplyr::lag(DA_MULH55A59), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_max_k_munic   = dplyr::if_else(DA_MULH55A59 <= (k * max(dplyr::lag(DA_MULH55A59), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_med_mov_munic = dplyr::if_else(DA_MULH55A59 <= (k * zoo::rollmedian(DA_MULH55A59, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH55A59_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH55A59), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh55a59}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh55a59 |> 
  dplyr::select(!DA_MULH55A59) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh55a59}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh55a59}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH60A64

```{r rules_dist_da_mulh60a64}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh60a64 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH60A64" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH60A64"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH60A64) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH60A64_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH60A64), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_out_munic     = dplyr::if_else(!outlier_function(DA_MULH60A64), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_min_munic     = dplyr::if_else(DA_MULH60A64 >= (min(dplyr::lag(DA_MULH60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_max_munic     = dplyr::if_else(DA_MULH60A64 <= (max(dplyr::lag(DA_MULH60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_min_k_munic   = dplyr::if_else(DA_MULH60A64 >= (min(dplyr::lag(DA_MULH60A64), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_max_k_munic   = dplyr::if_else(DA_MULH60A64 <= (k * max(dplyr::lag(DA_MULH60A64), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_med_mov_munic = dplyr::if_else(DA_MULH60A64 <= (k * zoo::rollmedian(DA_MULH60A64, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH60A64_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH60A64), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh60a64}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh60a64 |> 
  dplyr::select(!DA_MULH60A64) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh60a64}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh60a64}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH65A69

```{r rules_dist_da_mulh65a69}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh65a69 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH65A69" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH65A69"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH65A69) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH65A69_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH65A69), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_out_munic     = dplyr::if_else(!outlier_function(DA_MULH65A69), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_min_munic     = dplyr::if_else(DA_MULH65A69 >= (min(dplyr::lag(DA_MULH65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_max_munic     = dplyr::if_else(DA_MULH65A69 <= (max(dplyr::lag(DA_MULH65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_min_k_munic   = dplyr::if_else(DA_MULH65A69 >= (min(dplyr::lag(DA_MULH65A69), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_max_k_munic   = dplyr::if_else(DA_MULH65A69 <= (k * max(dplyr::lag(DA_MULH65A69), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_med_mov_munic = dplyr::if_else(DA_MULH65A69 <= (k * zoo::rollmedian(DA_MULH65A69, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH65A69_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH65A69), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh65a69}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh65a69 |> 
  dplyr::select(!DA_MULH65A69) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh65a69}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh65a69}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH70A74

```{r rules_dist_da_mulh70a74}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh70a74 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH70A74" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH70A74"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH70A74) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH70A74_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH70A74), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_out_munic     = dplyr::if_else(!outlier_function(DA_MULH70A74), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_min_munic     = dplyr::if_else(DA_MULH70A74 >= (min(dplyr::lag(DA_MULH70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_max_munic     = dplyr::if_else(DA_MULH70A74 <= (max(dplyr::lag(DA_MULH70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_min_k_munic   = dplyr::if_else(DA_MULH70A74 >= (min(dplyr::lag(DA_MULH70A74), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_max_k_munic   = dplyr::if_else(DA_MULH70A74 <= (k * max(dplyr::lag(DA_MULH70A74), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_med_mov_munic = dplyr::if_else(DA_MULH70A74 <= (k * zoo::rollmedian(DA_MULH70A74, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH70A74_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH70A74), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh70a74}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh70a74 |> 
  dplyr::select(!DA_MULH70A74) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh70a74}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh70a74}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULH75A79

```{r rules_dist_da_mulh75a79}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulh75a79 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULH75A79" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULH75A79"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULH75A79) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULH75A79_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULH75A79), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_out_munic     = dplyr::if_else(!outlier_function(DA_MULH75A79), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_min_munic     = dplyr::if_else(DA_MULH75A79 >= (min(dplyr::lag(DA_MULH75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_max_munic     = dplyr::if_else(DA_MULH75A79 <= (max(dplyr::lag(DA_MULH75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_min_k_munic   = dplyr::if_else(DA_MULH75A79 >= (min(dplyr::lag(DA_MULH75A79), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_max_k_munic   = dplyr::if_else(DA_MULH75A79 <= (k * max(dplyr::lag(DA_MULH75A79), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_med_mov_munic = dplyr::if_else(DA_MULH75A79 <= (k * zoo::rollmedian(DA_MULH75A79, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULH75A79_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULH75A79), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulh75a79}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulh75a79 |> 
  dplyr::select(!DA_MULH75A79) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulh75a79}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulh75a79}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULHER80

```{r rules_dist_da_mulher80}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulher80 <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULHER80" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULHER80"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULHER80) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULHER80_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULHER80), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_out_munic     = dplyr::if_else(!outlier_function(DA_MULHER80), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_min_munic     = dplyr::if_else(DA_MULHER80 >= (min(dplyr::lag(DA_MULHER80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_max_munic     = dplyr::if_else(DA_MULHER80 <= (max(dplyr::lag(DA_MULHER80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_min_k_munic   = dplyr::if_else(DA_MULHER80 >= (min(dplyr::lag(DA_MULHER80), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_max_k_munic   = dplyr::if_else(DA_MULHER80 <= (k * max(dplyr::lag(DA_MULHER80), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_med_mov_munic = dplyr::if_else(DA_MULHER80 <= (k * zoo::rollmedian(DA_MULHER80, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULHER80_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULHER80), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulher80}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulher80 |> 
  dplyr::select(!DA_MULHER80) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulher80}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulher80}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_HOMEMTOT

```{r rules_dist_da_homemtot}

## df com o resultado das aplicações das regras
df_rules_dist_da_homemtot <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_HOMEMTOT" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_HOMEMTOT"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_HOMEMTOT) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_HOMEMTOT_hampel_munic  = dplyr::if_else(!hampel_filter(DA_HOMEMTOT), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_out_munic     = dplyr::if_else(!outlier_function(DA_HOMEMTOT), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_min_munic     = dplyr::if_else(DA_HOMEMTOT >= (min(dplyr::lag(DA_HOMEMTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_max_munic     = dplyr::if_else(DA_HOMEMTOT <= (max(dplyr::lag(DA_HOMEMTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_min_k_munic   = dplyr::if_else(DA_HOMEMTOT >= (min(dplyr::lag(DA_HOMEMTOT), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_max_k_munic   = dplyr::if_else(DA_HOMEMTOT <= (k * max(dplyr::lag(DA_HOMEMTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_med_mov_munic = dplyr::if_else(DA_HOMEMTOT <= (k * zoo::rollmedian(DA_HOMEMTOT, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_HOMEMTOT_dif_munic     = dplyr::if_else(!compare_first_dif(DA_HOMEMTOT), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_homemtot}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_homemtot |> 
  dplyr::select(!DA_HOMEMTOT) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_homemtot}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_homemtot}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

### DA_MULHERTOT

```{r rules_dist_da_mulhertot}

## df com o resultado das aplicações das regras
df_rules_dist_da_mulhertot <- data |> 
  dplyr::filter( # Filtro condicional para variáveis que estão em "ano_base_alter"
    dplyr::case_when(
      "DA_MULHERTOT" %in% names(ano_base_alter) ~ ANO >= ano_base_alter["DA_MULHERTOT"],
      TRUE ~ ANO >= min(ANO, na.rm = T)
    )
  ) |> 
  dplyr::select(Ano = ANO, ibge7 = IBGE7, DA_MULHERTOT) |> 
  dplyr::group_by(ibge7) |> 
  dplyr::mutate(
    DF_DA_MULHERTOT_hampel_munic  = dplyr::if_else(!hampel_filter(DA_MULHERTOT), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_out_munic     = dplyr::if_else(!outlier_function(DA_MULHERTOT), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_min_munic     = dplyr::if_else(DA_MULHERTOT >= (min(dplyr::lag(DA_MULHERTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_max_munic     = dplyr::if_else(DA_MULHERTOT <= (max(dplyr::lag(DA_MULHERTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_min_k_munic   = dplyr::if_else(DA_MULHERTOT >= (min(dplyr::lag(DA_MULHERTOT), na.rm = T) / k), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_max_k_munic   = dplyr::if_else(DA_MULHERTOT <= (k * max(dplyr::lag(DA_MULHERTOT), na.rm = T)), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_med_mov_munic = dplyr::if_else(DA_MULHERTOT <= (k * zoo::rollmedian(DA_MULHERTOT, k = 3, fill = NA, align = "right")), F, T), # Longitudinal (município)
    
    DF_DA_MULHERTOT_dif_munic     = dplyr::if_else(!compare_first_dif(DA_MULHERTOT), F, T) # Longitudinal (município)
  )
```

```{r data_wrangling_dist_da_mulhertot}

## Transformação dos resultados
df_sumario_dist_da <- df_rules_dist_da_mulhertot |> 
  dplyr::select(!DA_MULHERTOT) |> 
  tidyr::pivot_longer(cols = !c(Ano, ibge7), names_to = "Regra", values_to = "resultado")

## df com um sumário dos resultados
df_sumario <- df_sumario_dist_da |> 
  dplyr::group_by(Ano, Regra) |> 
  dplyr::summarise(
    Total        = dplyr::n(),
    Validada     = sum(!resultado, na.rm = T),
    Suspeita     = sum(resultado, na.rm = T),
    Ausente      = sum(is.na(resultado)),
    `% Validada` = round(Validada / Total * 100, 2),
    `% Suspeita` = round(Suspeita / Total * 100, 2),
    `% Ausente`  = round(Ausente / Total * 100, 2)
  ) |> 
  dplyr::ungroup()
```

```{r table_dist_da_mulhertot}
#| column: screen-inset-right

df_sumario |> 
  dplyr::filter(Ano == max(Ano)) |>
  dplyr::mutate(Ano = as.character(Ano)) |>
  kableExtra::kbl(format.args = list(big.mark = ".", decimal.mark = ",")) |> 
  kableExtra::kable_paper("hover", full_width = F)
```

```{r chart_dist_da_mulhertot}
#| column: screen-inset-right
#| layout-ncol: 2
#| out-width: 100%

chart_heatmap(df_sumario)
chart_vbar(df_sumario)
```

# Análise descritiva

As tabelas a seguir apresentam um resumo descritivo dos indicadores analisados, fornecendo uma visão abrangente das características dos dados. Os cálculos foram realizados em função do ano. As informações inclusas abrangem:

-   **Quantidade de Valores (N):** Indica o número total de observações presentes no conjunto de dados para cada indicador.

-   **Valor Mínimo:** Representa o menor valor observado para o indicador.

-   **Valor da Média:** Indica a média aritmética dos valores do indicador, fornecendo uma medida central da tendência dos dados.

-   **Valor da Mediana:** Representa o valor que divide o conjunto de dados ordenados em duas metades de igual tamanho, sendo útil para lidar com casos com *outliers*.

-   **Valor Máximo:** Indica o maior valor observado para o indicador.

-   **Desvio Padrão (D.P.):** Mede a dispersão dos dados em relação à média, quantificando a variabilidade presente no conjunto.

-   **Coeficiente de Variação (C.V.):** Expressa a razão entre o desvio padrão e a média, em porcentagem, fornecendo uma medida relativa da dispersão dos dados em relação à média.

-   **Quantidade de Zeros:** Indica o número de observações com valor igual a zero para o indicador.

-   **Quantidade de Dados Ausentes:** Representa o número de observações com valores ausentes para o indicador.

**Observações Importantes:**

-   A análise de *outliers* (valores atípicos) não foi realizada nesta tabela descritiva. Para uma avaliação mais completa da qualidade dos dados, recomenda-se a análise de *outliers* e a verificação de possíveis inconsistências nos valores apresentados anteriormente neste documento.

-   A interpretação das medidas descritivas deve ser feita em conjunto com o conhecimento do contexto dos indicadores e dos objetivos da análise.

Ao analisar esta tabela, é possível obter uma compreensão inicial das características dos dados, identificando padrões, tendências e possíveis discrepâncias. As informações aqui apresentadas servem como base para análises estatísticas mais aprofundadas, auxiliando na tomada de decisões e na formulação de conclusões relevantes.

## Tabelas

```{r show_desc_table, results='asis'}
#| column: screen-inset-right

pander::pandoc.header("Descritiva", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  pander::pandoc.table(
    table_descriptive(variable = var, data = data), 
    decimal.mark = ",", 
    big.mark     = ".", 
    round        = 2,
    split.table  = Inf
  )
  cat("\\pagebreak\n")
}
```

## Gráficos

::: {.callout-note appearance="minimal"}
Observação: os gráficos abaixo são mostrados na escala logarítmica para facilitar a visualização dos dados em certos casos. Para conferir os valores reais, consultar as tabelas descritivas.
:::

```{r show_boxplot_chart, results='asis'}
#| out-width: 100%
#| fig-format: svg

pander::pandoc.header("Gráfico de caixa (boxplot)", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  print(chart_boxplot(variable = var, data = data))
  cat("\\pagebreak\n")
}
```

```{r show_hist_chart, results='asis'}
#| out-width: 100%
#| fig-format: svg

pander::pandoc.header("Histograma", level = 3)

# Loop para mostrar os resultados por variável
for(var in var_numeric){
  pander::pandoc.header(var, level = 4)
  print(chart_histogram(variable = var, data = data))
  cat("\\pagebreak\n")
}
```

```{r excel_create_wb}

## Criar pasta de trabalho
pt <- openxlsx::createWorkbook()
```

```{r df_build_viol_valid}

# Criar base com as observações que violaram uma ou mais regras de validade

## Validade
df_rules_valid_da_popt <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPT")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popta <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPTA")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp0 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP0")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp1a4 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP1A4")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp4 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP4")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp5 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP5")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp4e5 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP4E5")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp5a9 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP5A9")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp6a14 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP6A14")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp10a14 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP10A14")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp15 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP15")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp15a17 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP15A17")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp15a19 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP15A19")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp15m <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP15M")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp16a19 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP16A19")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp16a64 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP16A64")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp18m <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP18M")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp20a24 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP20A24")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp25a29 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP25A29")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp30a34 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP30A34")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp35a39 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP35A39")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp40a44 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP40A44")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp45a49 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP45A49")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp50a54 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP50A54")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp55a59 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP55A59")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp60a64 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP60A64")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp65a69 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP65A69")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp70a74 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP70A74")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp75a79 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP75A79")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_popp80m <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPP80M")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_densp <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_DENSP")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_propp4e5 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_PROPP4E5")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_propp0a5 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_PROPP0A5")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_propp6a17 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_PROPP6A17")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_rdepp <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_RDEPP")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_propp15n <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_PROPP15N")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_propp65m <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_PROPP65M")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_indenve <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_INDENVE")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_poppurb <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_POPPURB")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tft <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TFT")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tmi <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TMI")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_espvida <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_ESPVIDA")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tbm <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TBM")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tbn <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TBN")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tcv <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TCV")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tlm <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TLM")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_tcd <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_TCD")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_emigra <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_EMIGRA")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_imigra <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_IMIGRA")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem0a4 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM0A4")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem5a9 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM5A9")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem10a14 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM10A14")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem15a19 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM15A19")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem20a24 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM20A24")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem25a29 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM25A29")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem30a34 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM30A34")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem35a39 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM35A39")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem40a44 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM40A44")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem45a49 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM45A49")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem50a54 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM50A54")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem55a59 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM55A59")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem60a64 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM60A64")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem65a69 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM65A69")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem70a74 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM70A74")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem75a79 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM75A79")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homem80 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEM80")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh0a4 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH0A4")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh5a9 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH5A9")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh10a14 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH10A14")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh15a19 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH15A19")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh20a24 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH20A24")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh25a29 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH25A29")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh30a34 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH30A34")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh35a39 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH35A39")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh40a44 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH40A44")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh45a49 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH45A49")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh50a54 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH50A54")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh55a59 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH55A59")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh60a64 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH60A64")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh65a69 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH65A69")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh70a74 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH70A74")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulh75a79 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULH75A79")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulher80 <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULHER80")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_homemtot <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_HOMEMTOT")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_valid_da_mulhertot <- df_rules_valid_da_all |> 
  dplyr::select(
    Ano,
    ibge7,
    dplyr::ends_with("DA_MULHERTOT")
  ) |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)
```

```{r df_export_viol_valid}

## Lista com os dfs por indicador
lista_df <- list(
  "da_popt"       = df_rules_valid_da_popt,
  "da_popta"      = df_rules_valid_da_popta,
  "da_popp0"      = df_rules_valid_da_popp0,
  "da_popp1a4"    = df_rules_valid_da_popp1a4,
  "da_popp4"      = df_rules_valid_da_popp4,
  "da_popp5"      = df_rules_valid_da_popp5,
  "da_popp4e5"    = df_rules_valid_da_popp4e5,
  "da_popp5a9"    = df_rules_valid_da_popp5a9,
  "da_popp6a14"   = df_rules_valid_da_popp6a14,
  "da_popp10a14"  = df_rules_valid_da_popp10a14,
  "da_popp15"     = df_rules_valid_da_popp15,
  "da_popp15a17"  = df_rules_valid_da_popp15a17,
  "da_popp15a19"  = df_rules_valid_da_popp15a19,
  "da_popp15m"    = df_rules_valid_da_popp15m,
  "da_popp16a19"  = df_rules_valid_da_popp16a19,
  "da_popp16a64"  = df_rules_valid_da_popp16a64,
  "da_popp18m"    = df_rules_valid_da_popp18m,
  "da_popp20a24"  = df_rules_valid_da_popp20a24,
  "da_popp25a29"  = df_rules_valid_da_popp25a29,
  "da_popp30a34"  = df_rules_valid_da_popp30a34,
  "da_popp35a39"  = df_rules_valid_da_popp35a39,
  "da_popp40a44"  = df_rules_valid_da_popp40a44,
  "da_popp45a49"  = df_rules_valid_da_popp45a49,
  "da_popp50a54"  = df_rules_valid_da_popp50a54,
  "da_popp55a59"  = df_rules_valid_da_popp55a59,
  "da_popp60a64"  = df_rules_valid_da_popp60a64,
  "da_popp65a69"  = df_rules_valid_da_popp65a69,
  "da_popp70a74"  = df_rules_valid_da_popp70a74,
  "da_popp75a79"  = df_rules_valid_da_popp75a79,
  "da_popp80m"    = df_rules_valid_da_popp80m,
  "da_densp"      = df_rules_valid_da_densp,
  "da_propp4e5"   = df_rules_valid_da_propp4e5,
  "da_propp0a5"   = df_rules_valid_da_propp0a5,
  "da_propp6a17"  = df_rules_valid_da_propp6a17,
  "da_rdepp"      = df_rules_valid_da_rdepp,
  "da_propp15n"   = df_rules_valid_da_propp15n,
  "da_propp65m"   = df_rules_valid_da_propp65m,
  "da_indenve"    = df_rules_valid_da_indenve,
  "da_poppurb"    = df_rules_valid_da_poppurb,
  "da_tft"        = df_rules_valid_da_tft,
  "da_tmi"        = df_rules_valid_da_tmi,
  "da_espvida"    = df_rules_valid_da_espvida,
  "da_tbm"        = df_rules_valid_da_tbm,
  "da_tbn"        = df_rules_valid_da_tbn,
  "da_tcv"        = df_rules_valid_da_tcv,
  "da_tlm"        = df_rules_valid_da_tlm,
  "da_tcd"        = df_rules_valid_da_tcd,
  "da_emigra"     = df_rules_valid_da_emigra,
  "da_imigra"     = df_rules_valid_da_imigra,
  "da_homem0a4"   = df_rules_valid_da_homem0a4,
  "da_homem5a9"   = df_rules_valid_da_homem5a9,
  "da_homem10a14" = df_rules_valid_da_homem10a14,
  "da_homem15a19" = df_rules_valid_da_homem15a19,
  "da_homem20a24" = df_rules_valid_da_homem20a24,
  "da_homem25a29" = df_rules_valid_da_homem25a29,
  "da_homem30a34" = df_rules_valid_da_homem30a34,
  "da_homem35a39" = df_rules_valid_da_homem35a39,
  "da_homem40a44" = df_rules_valid_da_homem40a44,
  "da_homem45a49" = df_rules_valid_da_homem45a49,
  "da_homem50a54" = df_rules_valid_da_homem50a54,
  "da_homem55a59" = df_rules_valid_da_homem55a59,
  "da_homem60a64" = df_rules_valid_da_homem60a64,
  "da_homem65a69" = df_rules_valid_da_homem65a69,
  "da_homem70a74" = df_rules_valid_da_homem70a74,
  "da_homem75a79" = df_rules_valid_da_homem75a79,
  "da_homem80"    = df_rules_valid_da_homem80,
  "da_mulh0a4"    = df_rules_valid_da_mulh0a4,
  "da_mulh5a9"    = df_rules_valid_da_mulh5a9,
  "da_mulh10a14"  = df_rules_valid_da_mulh10a14,
  "da_mulh15a19"  = df_rules_valid_da_mulh15a19,
  "da_mulh20a24"  = df_rules_valid_da_mulh20a24,
  "da_mulh25a29"  = df_rules_valid_da_mulh25a29,
  "da_mulh30a34"  = df_rules_valid_da_mulh30a34,
  "da_mulh35a39"  = df_rules_valid_da_mulh35a39,
  "da_mulh40a44"  = df_rules_valid_da_mulh40a44,
  "da_mulh45a49"  = df_rules_valid_da_mulh45a49,
  "da_mulh50a54"  = df_rules_valid_da_mulh50a54,
  "da_mulh55a59"  = df_rules_valid_da_mulh55a59,
  "da_mulh60a64"  = df_rules_valid_da_mulh60a64,
  "da_mulh65a69"  = df_rules_valid_da_mulh65a69,
  "da_mulh70a74"  = df_rules_valid_da_mulh70a74,
  "da_mulh75a79"  = df_rules_valid_da_mulh75a79,
  "da_mulher80"   = df_rules_valid_da_mulher80,
  "da_homemtot"   = df_rules_valid_da_homemtot,
  "da_mulhertot"  = df_rules_valid_da_mulhertot
)

## Add dados à pasta de trabalho
for(i in names(lista_df)){
  nome <- stringr::str_remove(i, "df_rules_valid_")
  openxlsx::addWorksheet(pt, paste0("valid - ", nome))
  openxlsx::writeData(pt, paste0("valid - ", nome), lista_df[[i]])
}
```

```{r df_build_viol_consist}

# Criar base com as observacões que violaram uma ou mais regras de consistência

## Consistência
# df_rules_consist_hs_gestao_total <- df_rules_consist_hs_all |> 
#   tidyr::pivot_longer(
#     cols      = !c(Ano, ibge7, dplyr::starts_with("HS_")), 
#     names_to  = "regra", 
#     values_to = "obs_suspeita"
#   ) |> 
#   dplyr::filter(obs_suspeita) |> 
#   dplyr::rename_with(tolower) |> 
#   dplyr::arrange(ano, ibge7)
```

```{r df_export_viol_consist}

## Lista com os dfs por indicador
# lista_df <- list(
#   "hs_gestao_total"  = df_rules_consist_hs_gestao_total
# )

## Add dados à pasta de trabalho
# for(i in names(lista_df)){
#   nome <- stringr::str_remove(i, "df_rules_consist_")
#   openxlsx::addWorksheet(pt, paste0("consist - ", nome))
#   openxlsx::writeData(pt, paste0("consist - ", nome), lista_df[[i]])
# }
```

```{r df_build_viol_dist}

# Criar base com as observações que violaram uma ou mais regras de distribuição

## Distribuição
df_rules_dist_da_popt <- df_rules_dist_da_popt |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popta <- df_rules_dist_da_popta |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp0 <- df_rules_dist_da_popp0 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp1a4 <- df_rules_dist_da_popp1a4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp4 <- df_rules_dist_da_popp4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp5 <- df_rules_dist_da_popp5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp4e5 <- df_rules_dist_da_popp4e5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp5a9 <- df_rules_dist_da_popp5a9 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp6a14 <- df_rules_dist_da_popp6a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp10a14 <- df_rules_dist_da_popp10a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15 <- df_rules_dist_da_popp15 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15a17 <- df_rules_dist_da_popp15a17 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15a19 <- df_rules_dist_da_popp15a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp15m <- df_rules_dist_da_popp15m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp16a19 <- df_rules_dist_da_popp16a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp16a64 <- df_rules_dist_da_popp16a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp18m <- df_rules_dist_da_popp18m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp20a24 <- df_rules_dist_da_popp20a24 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp25a29 <- df_rules_dist_da_popp25a29 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp30a34 <- df_rules_dist_da_popp30a34 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp35a39 <- df_rules_dist_da_popp35a39 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp40a44 <- df_rules_dist_da_popp40a44 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp45a49 <- df_rules_dist_da_popp45a49 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp50a54 <- df_rules_dist_da_popp50a54 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp55a59 <- df_rules_dist_da_popp55a59 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp60a64 <- df_rules_dist_da_popp60a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp65a69 <- df_rules_dist_da_popp65a69 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp70a74 <- df_rules_dist_da_popp70a74 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp75a79 <- df_rules_dist_da_popp75a79 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_popp80m <- df_rules_dist_da_popp80m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_densp <- df_rules_dist_da_densp |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp4e5 <- df_rules_dist_da_propp4e5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp0a5 <- df_rules_dist_da_propp0a5 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp6a17 <- df_rules_dist_da_propp6a17 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_rdepp <- df_rules_dist_da_rdepp |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp15n <- df_rules_dist_da_propp15n |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_propp65m <- df_rules_dist_da_propp65m |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_indenve <- df_rules_dist_da_indenve |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_poppurb <- df_rules_dist_da_poppurb |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tft <- df_rules_dist_da_tft |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tmi <- df_rules_dist_da_tmi |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_espvida <- df_rules_dist_da_espvida |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tbm <- df_rules_dist_da_tbm |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tbn <- df_rules_dist_da_tbn |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tcv <- df_rules_dist_da_tcv |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tlm <- df_rules_dist_da_tlm |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_tcd <- df_rules_dist_da_tcd |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_emigra <- df_rules_dist_da_emigra |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_imigra <- df_rules_dist_da_imigra |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem0a4 <- df_rules_dist_da_homem0a4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem5a9 <- df_rules_dist_da_homem5a9 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem10a14 <- df_rules_dist_da_homem10a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem15a19 <- df_rules_dist_da_homem15a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem20a24 <- df_rules_dist_da_homem20a24 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem25a29 <- df_rules_dist_da_homem25a29 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem30a34 <- df_rules_dist_da_homem30a34 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem35a39 <- df_rules_dist_da_homem35a39 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem40a44 <- df_rules_dist_da_homem40a44 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem45a49 <- df_rules_dist_da_homem45a49 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem50a54 <- df_rules_dist_da_homem50a54 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem55a59 <- df_rules_dist_da_homem55a59 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem60a64 <- df_rules_dist_da_homem60a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem65a69 <- df_rules_dist_da_homem65a69 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem70a74 <- df_rules_dist_da_homem70a74 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem75a79 <- df_rules_dist_da_homem75a79 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homem80 <- df_rules_dist_da_homem80 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh0a4 <- df_rules_dist_da_mulh0a4 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh5a9 <- df_rules_dist_da_mulh5a9 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh10a14 <- df_rules_dist_da_mulh10a14 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh15a19 <- df_rules_dist_da_mulh15a19 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh20a24 <- df_rules_dist_da_mulh20a24 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh25a29 <- df_rules_dist_da_mulh25a29 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh30a34 <- df_rules_dist_da_mulh30a34 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh35a39 <- df_rules_dist_da_mulh35a39 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh40a44 <- df_rules_dist_da_mulh40a44 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh45a49 <- df_rules_dist_da_mulh45a49 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh50a54 <- df_rules_dist_da_mulh50a54 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh55a59 <- df_rules_dist_da_mulh55a59 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh60a64 <- df_rules_dist_da_mulh60a64 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh65a69 <- df_rules_dist_da_mulh65a69 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh70a74 <- df_rules_dist_da_mulh70a74 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulh75a79 <- df_rules_dist_da_mulh75a79 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulher80 <- df_rules_dist_da_mulher80 |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_homemtot <- df_rules_dist_da_homemtot |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)

df_rules_dist_da_mulhertot <- df_rules_dist_da_mulhertot |> 
  tidyr::pivot_longer(
    cols      = !c(Ano, ibge7, dplyr::starts_with("DA_")), 
    names_to  = "regra", 
    values_to = "obs_suspeita"
  ) |> 
  dplyr::filter(obs_suspeita) |> 
  dplyr::rename_with(tolower) |> 
  dplyr::arrange(ano, ibge7)
```

```{r df_export_viol_dist}

lista_df <- list(
  "da_popt"       = df_rules_dist_da_popt,
  "da_popta"      = df_rules_dist_da_popta,
  "da_popp0"      = df_rules_dist_da_popp0,
  "da_popp1a4"    = df_rules_dist_da_popp1a4,
  "da_popp4"      = df_rules_dist_da_popp4,
  "da_popp5"      = df_rules_dist_da_popp5,
  "da_popp4e5"    = df_rules_dist_da_popp4e5,
  "da_popp5a9"    = df_rules_dist_da_popp5a9,
  "da_popp6a14"   = df_rules_dist_da_popp6a14,
  "da_popp10a14"  = df_rules_dist_da_popp10a14,
  "da_popp15"     = df_rules_dist_da_popp15,
  "da_popp15a17"  = df_rules_dist_da_popp15a17,
  "da_popp15a19"  = df_rules_dist_da_popp15a19,
  "da_popp15m"    = df_rules_dist_da_popp15m,
  "da_popp16a19"  = df_rules_dist_da_popp16a19,
  "da_popp16a64"  = df_rules_dist_da_popp16a64,
  "da_popp18m"    = df_rules_dist_da_popp18m,
  "da_popp20a24"  = df_rules_dist_da_popp20a24,
  "da_popp25a29"  = df_rules_dist_da_popp25a29,
  "da_popp30a34"  = df_rules_dist_da_popp30a34,
  "da_popp35a39"  = df_rules_dist_da_popp35a39,
  "da_popp40a44"  = df_rules_dist_da_popp40a44,
  "da_popp45a49"  = df_rules_dist_da_popp45a49,
  "da_popp50a54"  = df_rules_dist_da_popp50a54,
  "da_popp55a59"  = df_rules_dist_da_popp55a59,
  "da_popp60a64"  = df_rules_dist_da_popp60a64,
  "da_popp65a69"  = df_rules_dist_da_popp65a69,
  "da_popp70a74"  = df_rules_dist_da_popp70a74,
  "da_popp75a79"  = df_rules_dist_da_popp75a79,
  "da_popp80m"    = df_rules_dist_da_popp80m,
  "da_densp"      = df_rules_dist_da_densp,
  "da_propp4e5"   = df_rules_dist_da_propp4e5,
  "da_propp0a5"   = df_rules_dist_da_propp0a5,
  "da_propp6a17"  = df_rules_dist_da_propp6a17,
  "da_rdepp"      = df_rules_dist_da_rdepp,
  "da_propp15n"   = df_rules_dist_da_propp15n,
  "da_propp65m"   = df_rules_dist_da_propp65m,
  "da_indenve"    = df_rules_dist_da_indenve,
  "da_poppurb"    = df_rules_dist_da_poppurb,
  "da_tft"        = df_rules_dist_da_tft,
  "da_tmi"        = df_rules_dist_da_tmi,
  "da_espvida"    = df_rules_dist_da_espvida,
  "da_tbm"        = df_rules_dist_da_tbm,
  "da_tbn"        = df_rules_dist_da_tbn,
  "da_tcv"        = df_rules_dist_da_tcv,
  "da_tlm"        = df_rules_dist_da_tlm,
  "da_tcd"        = df_rules_dist_da_tcd,
  "da_emigra"     = df_rules_dist_da_emigra,
  "da_imigra"     = df_rules_dist_da_imigra,
  "da_homem0a4"   = df_rules_dist_da_homem0a4,
  "da_homem5a9"   = df_rules_dist_da_homem5a9,
  "da_homem10a14" = df_rules_dist_da_homem10a14,
  "da_homem15a19" = df_rules_dist_da_homem15a19,
  "da_homem20a24" = df_rules_dist_da_homem20a24,
  "da_homem25a29" = df_rules_dist_da_homem25a29,
  "da_homem30a34" = df_rules_dist_da_homem30a34,
  "da_homem35a39" = df_rules_dist_da_homem35a39,
  "da_homem40a44" = df_rules_dist_da_homem40a44,
  "da_homem45a49" = df_rules_dist_da_homem45a49,
  "da_homem50a54" = df_rules_dist_da_homem50a54,
  "da_homem55a59" = df_rules_dist_da_homem55a59,
  "da_homem60a64" = df_rules_dist_da_homem60a64,
  "da_homem65a69" = df_rules_dist_da_homem65a69,
  "da_homem70a74" = df_rules_dist_da_homem70a74,
  "da_homem75a79" = df_rules_dist_da_homem75a79,
  "da_homem80"    = df_rules_dist_da_homem80,
  "da_mulh0a4"    = df_rules_dist_da_mulh0a4,
  "da_mulh5a9"    = df_rules_dist_da_mulh5a9,
  "da_mulh10a14"  = df_rules_dist_da_mulh10a14,
  "da_mulh15a19"  = df_rules_dist_da_mulh15a19,
  "da_mulh20a24"  = df_rules_dist_da_mulh20a24,
  "da_mulh25a29"  = df_rules_dist_da_mulh25a29,
  "da_mulh30a34"  = df_rules_dist_da_mulh30a34,
  "da_mulh35a39"  = df_rules_dist_da_mulh35a39,
  "da_mulh40a44"  = df_rules_dist_da_mulh40a44,
  "da_mulh45a49"  = df_rules_dist_da_mulh45a49,
  "da_mulh50a54"  = df_rules_dist_da_mulh50a54,
  "da_mulh55a59"  = df_rules_dist_da_mulh55a59,
  "da_mulh60a64"  = df_rules_dist_da_mulh60a64,
  "da_mulh65a69"  = df_rules_dist_da_mulh65a69,
  "da_mulh70a74"  = df_rules_dist_da_mulh70a74,
  "da_mulh75a79"  = df_rules_dist_da_mulh75a79,
  "da_mulher80"   = df_rules_dist_da_mulher80,
  "da_homemtot"   = df_rules_dist_da_homemtot,
  "da_mulhertot"  = df_rules_dist_da_mulhertot
)

for(i in names(lista_df)){
  nome <- stringr::str_remove(i, "df_rules_dist_")
  openxlsx::addWorksheet(pt, paste0("distrib - ", nome))
  openxlsx::writeData(pt, paste0("distrib - ", nome), lista_df[[i]])
}
```

```{r excel_save_wb}

openxlsx::saveWorkbook(pt, "fjpdados_demografia_violacoes.xlsx", overwrite = T)
```

```{r clean_env, results='hide'}

rm(list = ls())
gc()
```
